{"ast":null,"code":"import { __awaiter, __extends, __generator } from \"tslib\";\nimport { Settings } from \"../util/Entity\";\nimport { Container } from \"./Container\";\nimport { ListData } from \"../util/Data\";\nimport * as $array from \"../util/Array\";\nimport * as $object from \"../util/Object\";\n/**\r\n * A base element that holds data bit (data item) for any [[Component]].\r\n */\n\nvar DataItem =\n/** @class */\nfunction (_super) {\n  __extends(DataItem, _super);\n\n  function DataItem(component, dataContext, settings) {\n    var _this = _super.call(this, settings) || this;\n    /**\r\n     * A data item's owener [[Component]].\r\n     */\n\n\n    Object.defineProperty(_this, \"component\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    /**\r\n     * A reference to actual item in source data this item is based on.\r\n     */\n\n    Object.defineProperty(_this, \"dataContext\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    /**\r\n     * @todo requires description\r\n     */\n\n    Object.defineProperty(_this, \"bullets\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    /**\r\n     * A set of \"open\" values.\r\n     */\n\n    Object.defineProperty(_this, \"open\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    /**\r\n     * A set of \"close\" values.\r\n     */\n\n    Object.defineProperty(_this, \"close\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    _this.dataContext = dataContext;\n    _this.component = component;\n    _this._settings.visible = true;\n\n    _this._checkDirty();\n\n    return _this;\n  }\n  /**\r\n   * @ignore\r\n   */\n\n\n  Object.defineProperty(DataItem.prototype, \"markDirty\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      this.component.markDirtyValues(this);\n    }\n  });\n  Object.defineProperty(DataItem.prototype, \"_startAnimation\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      this.component._root._addAnimation(this);\n    }\n  });\n  Object.defineProperty(DataItem.prototype, \"_animationTime\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return this.component._root.animationTime;\n    }\n  });\n  Object.defineProperty(DataItem.prototype, \"_dispose\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      if (this.component) {\n        this.component.disposeDataItem(this);\n      }\n\n      _super.prototype._dispose.call(this);\n    }\n  });\n  /**\r\n   * Shows a data item that's currently hidden.\r\n   */\n\n  Object.defineProperty(DataItem.prototype, \"show\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (duration) {\n      this.setRaw(\"visible\", true);\n\n      if (this.component) {\n        this.component.showDataItem(this, duration);\n      }\n    }\n  });\n  /**\r\n   * Hides a data item that's currently visible.\r\n   */\n\n  Object.defineProperty(DataItem.prototype, \"hide\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (duration) {\n      this.setRaw(\"visible\", false);\n\n      if (this.component) {\n        this.component.hideDataItem(this, duration);\n      }\n    }\n  });\n  Object.defineProperty(DataItem.prototype, \"isHidden\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return !this.get(\"visible\");\n    }\n  });\n  return DataItem;\n}(Settings);\n\nexport { DataItem };\n/**\r\n * A base class for elements that make use of data.\r\n */\n\nvar Component =\n/** @class */\nfunction (_super) {\n  __extends(Component, _super);\n\n  function Component() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    Object.defineProperty(_this, \"_data\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: new ListData()\n    });\n    Object.defineProperty(_this, \"_dataItems\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: []\n    });\n    Object.defineProperty(_this, \"_mainDataItems\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: _this._dataItems\n    });\n    Object.defineProperty(_this, \"valueFields\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: []\n    });\n    Object.defineProperty(_this, \"fields\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: [\"id\"]\n    });\n    Object.defineProperty(_this, \"_valueFields\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_this, \"_valueFieldsF\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_this, \"_fields\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_this, \"_fieldsF\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_this, \"_valuesDirty\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: false\n    });\n    Object.defineProperty(_this, \"_dataChanged\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: false\n    });\n    Object.defineProperty(_this, \"_dataGrouped\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: false\n    });\n    /**\r\n     * Indicates if the component has already been initialized.\r\n     */\n\n    Object.defineProperty(_this, \"inited\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: false\n    });\n    return _this;\n  }\n\n  Object.defineProperty(Component.prototype, \"data\", {\n    /**\r\n     * @return  Data\r\n     */\n    get: function () {\n      return this._data;\n    },\n\n    /**\r\n     * Component's data.\r\n     *\r\n     * @see {@link https://www.amcharts.com/docs/v5/concepts/data/} for more info\r\n     */\n    set: function (data) {\n      data.incrementRef();\n\n      this._data.decrementRef();\n\n      this._data = data;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Component.prototype, \"_dispose\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      _super.prototype._dispose.call(this);\n\n      this._data.decrementRef();\n    }\n  });\n  Object.defineProperty(Component.prototype, \"_onDataClear\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {}\n  });\n  Object.defineProperty(Component.prototype, \"_afterNew\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var _this = this;\n\n      _super.prototype._afterNew.call(this);\n\n      this._data.incrementRef();\n\n      this._updateFields();\n\n      this._disposers.push(this.data.events.onAll(function (change) {\n        var dataItems = _this._mainDataItems;\n\n        _this.markDirtyValues();\n\n        _this._markDirtyGroup();\n\n        _this._dataChanged = true;\n\n        if (change.type === \"clear\") {\n          $array.each(dataItems, function (dataItem) {\n            dataItem.dispose();\n          });\n          dataItems.length = 0;\n\n          _this._onDataClear();\n        } else if (change.type === \"push\") {\n          var dataItem = new DataItem(_this, change.newValue, _this._makeDataItem(change.newValue));\n          dataItems.push(dataItem);\n\n          _this.processDataItem(dataItem);\n        } else if (change.type === \"setIndex\") {\n          var dataItem_1 = dataItems[change.index];\n\n          var properties_1 = _this._makeDataItem(change.newValue);\n\n          $object.keys(properties_1).forEach(function (key) {\n            dataItem_1.animate({\n              key: key,\n              to: properties_1[key],\n              duration: _this.get(\"interpolationDuration\", 0),\n              easing: _this.get(\"interpolationEasing\")\n            });\n          });\n          dataItem_1.dataContext = change.newValue;\n        } else if (change.type === \"insertIndex\") {\n          var dataItem = new DataItem(_this, change.newValue, _this._makeDataItem(change.newValue));\n          dataItems.splice(change.index, 0, dataItem);\n\n          _this.processDataItem(dataItem);\n        } else if (change.type === \"removeIndex\") {\n          var dataItem = dataItems[change.index];\n          dataItem.dispose();\n          dataItems.splice(change.index, 1);\n        } else if (change.type === \"moveIndex\") {\n          var dataItem = dataItems[change.oldIndex];\n          dataItems.splice(change.oldIndex, 1);\n          dataItems.splice(change.newIndex, 0, dataItem);\n        } else {\n          throw new Error(\"Unknown IStreamEvent type\");\n        }\n\n        _this._afterDataChange();\n      }));\n    }\n  });\n  Object.defineProperty(Component.prototype, \"_updateFields\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var _this = this;\n\n      if (this.valueFields) {\n        this._valueFields = [];\n        this._valueFieldsF = {};\n        $array.each(this.valueFields, function (key) {\n          var field = _this.get(key + \"Field\");\n\n          if (field) {\n            _this._valueFields.push(key);\n\n            _this._valueFieldsF[key] = {\n              fieldKey: key + \"Field\",\n              workingKey: key + \"Working\"\n            };\n          }\n        });\n      }\n\n      if (this.fields) {\n        this._fields = [];\n        this._fieldsF = {};\n        $array.each(this.fields, function (key) {\n          var field = _this.get(key + \"Field\");\n\n          if (field) {\n            _this._fields.push(key);\n\n            _this._fieldsF[key] = key + \"Field\";\n          }\n        });\n      }\n    }\n  });\n  Object.defineProperty(Component.prototype, \"dataItems\", {\n    /**\r\n     * A list of component's data items.\r\n     *\r\n     * @return  Data items\r\n     */\n    get: function () {\n      return this._dataItems;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Component.prototype, \"processDataItem\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (_dataItem) {}\n  });\n  Object.defineProperty(Component.prototype, \"_makeDataItem\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (data) {\n      var _this = this; //const output: this[\"_dataItemSettings\"] = {};\n\n\n      var output = {}; // temporary to solve error\n\n      if (this._valueFields) {\n        $array.each(this._valueFields, function (key) {\n          var field = _this.get(_this._valueFieldsF[key].fieldKey);\n\n          output[key] = data[field];\n          output[_this._valueFieldsF[key].workingKey] = output[key];\n        });\n      }\n\n      if (this._fields) {\n        $array.each(this._fields, function (key) {\n          var field = _this.get(_this._fieldsF[key]);\n\n          output[key] = data[field];\n        });\n      }\n\n      return output;\n    }\n  });\n  /**\r\n   * @ignore\r\n   */\n\n  Object.defineProperty(Component.prototype, \"makeDataItem\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (data) {\n      var dataItem = new DataItem(this, undefined, data);\n      this.processDataItem(dataItem);\n      return dataItem;\n    }\n  });\n  /**\r\n   * @ignore\r\n   */\n\n  Object.defineProperty(Component.prototype, \"pushDataItem\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (data) {\n      var dataItem = this.makeDataItem(data);\n\n      this._mainDataItems.push(dataItem);\n\n      return dataItem;\n    }\n  });\n  /**\r\n   * @ignore\r\n   */\n\n  Object.defineProperty(Component.prototype, \"disposeDataItem\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (_dataItem) {}\n  });\n  /**\r\n   * Shows component's data item.\r\n   *\r\n   * @param   dataItem   Data item\r\n   * @param   _duration  Animation duration in milliseconds\r\n   * @return             Promise\r\n   */\n\n  Object.defineProperty(Component.prototype, \"showDataItem\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (dataItem, _duration) {\n      return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n          dataItem.set(\"visible\", true);\n          return [2\n          /*return*/\n          ];\n        });\n      });\n    }\n  });\n  /**\r\n   * Hides component's data item.\r\n   *\r\n   * @param   dataItem   Data item\r\n   * @param   _duration  Animation duration in milliseconds\r\n   * @return             Promise\r\n   */\n\n  Object.defineProperty(Component.prototype, \"hideDataItem\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (dataItem, _duration) {\n      return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n          dataItem.set(\"visible\", false);\n          return [2\n          /*return*/\n          ];\n        });\n      });\n    }\n  });\n  Object.defineProperty(Component.prototype, \"_clearDirty\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      _super.prototype._clearDirty.call(this);\n\n      this._valuesDirty = false;\n    }\n  });\n  Object.defineProperty(Component.prototype, \"_afterDataChange\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {}\n  });\n  Object.defineProperty(Component.prototype, \"_afterChanged\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      _super.prototype._afterChanged.call(this);\n\n      if (this._dataChanged) {\n        var type = \"datavalidated\";\n\n        if (this.events.isEnabled(type)) {\n          this.events.dispatch(type, {\n            type: type,\n            target: this\n          });\n        }\n\n        this._dataChanged = false;\n      }\n\n      this.inited = true;\n    }\n  });\n  /**\r\n   * Forces a repaint of the element which relies on data.\r\n   *\r\n   * @since 5.0.21\r\n   */\n\n  Object.defineProperty(Component.prototype, \"markDirtyValues\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (_dataItem) {\n      this.markDirty();\n      this._valuesDirty = true;\n    }\n  });\n  Object.defineProperty(Component.prototype, \"_markDirtyGroup\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      this._dataGrouped = false;\n    }\n  });\n  /**\r\n   * @ignore\r\n   */\n\n  Object.defineProperty(Component.prototype, \"markDirtySize\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      this._sizeDirty = true;\n      this.markDirty();\n    }\n  });\n  Object.defineProperty(Component, \"className\", {\n    enumerable: true,\n    configurable: true,\n    writable: true,\n    value: \"Component\"\n  });\n  Object.defineProperty(Component, \"classNames\", {\n    enumerable: true,\n    configurable: true,\n    writable: true,\n    value: Container.classNames.concat([Component.className])\n  });\n  return Component;\n}(Container);\n\nexport { Component };","map":{"version":3,"mappings":"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","names":["Settings","Container","ListData","$array","$object","__extends","component","dataContext","settings","_super","Object","_this","_settings","visible","_checkDirty","markDirtyValues","_root","_addAnimation","animationTime","disposeDataItem","_dispose","call","duration","setRaw","showDataItem","hideDataItem","get","_dataItems","Component","_data","data","incrementRef","decrementRef","_afterNew","_updateFields","_disposers","push","events","onAll","change","dataItems","_mainDataItems","_markDirtyGroup","_dataChanged","type","each","dataItem","dispose","length","_onDataClear","DataItem","newValue","_makeDataItem","processDataItem","dataItem_1","index","properties_1","keys","forEach","key","animate","to","easing","splice","oldIndex","newIndex","Error","_afterDataChange","valueFields","_valueFields","_valueFieldsF","field","fieldKey","workingKey","fields","_fields","_fieldsF","_dataItem","output","undefined","makeDataItem","_duration","set","_clearDirty","_valuesDirty","_afterChanged","isEnabled","dispatch","target","inited","markDirty","_dataGrouped","_sizeDirty","classNames","concat","className"],"sourceRoot":"","sources":["../../../../../src/.internal/core/render/Component.ts"],"sourcesContent":["import { Settings } from \"../util/Entity\";\nimport { Container, IContainerSettings, IContainerPrivate, IContainerEvents } from \"./Container\";\nimport { ListData } from \"../util/Data\";\nimport * as $array from \"../util/Array\";\nimport * as $object from \"../util/Object\";\nimport type * as $ease from \"../util/Ease\";\nimport type { Bullet } from \"./Bullet\";\n\n/**\n * A base element that holds data bit (data item) for any [[Component]].\n */\nexport class DataItem<P extends IComponentDataItem> extends Settings {\n\tdeclare public _settings: P;\n\n\t/**\n\t * A data item's owener [[Component]].\n\t */\n\tpublic component: Component;\n\n\t/**\n\t * A reference to actual item in source data this item is based on.\n\t */\n\tpublic dataContext: unknown;\n\n\t/**\n\t * @todo requires description\n\t */\n\tpublic bullets: Array<Bullet> | undefined;\n\n\t/**\n\t * A set of \"open\" values.\n\t */\n\tpublic open: { [index: string]: any } | undefined;\n\n\t/**\n\t * A set of \"close\" values.\n\t */\n\tpublic close: { [index: string]: any } | undefined;\n\n\tconstructor(component: Component, dataContext: unknown, settings: P) {\n\t\tsuper(settings);\n\n\t\tthis.dataContext = dataContext;\n\t\tthis.component = component;\n\t\tthis._settings.visible = true;\n\t\tthis._checkDirty();\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic markDirty(): void {\n\t\tthis.component.markDirtyValues(this);\n\t}\n\n\tprotected _startAnimation(): void {\n\t\tthis.component._root._addAnimation(this);\n\t}\n\n\tprotected _animationTime(): number | null {\n\t\treturn this.component._root.animationTime;\n\t}\n\n\tprotected _dispose() {\n\t\tif (this.component) {\n\t\t\tthis.component.disposeDataItem(this);\n\t\t}\n\t\tsuper._dispose();\n\t}\n\n\t/**\n\t * Shows a data item that's currently hidden.\n\t */\n\tpublic show(duration?: number) {\n\t\tthis.setRaw(\"visible\", true);\n\t\tif (this.component) {\n\t\t\tthis.component.showDataItem(this, duration);\n\t\t}\n\t}\n\n\t/**\n\t * Hides a data item that's currently visible.\n\t */\n\tpublic hide(duration?: number) {\n\t\tthis.setRaw(\"visible\", false);\n\t\tif (this.component) {\n\t\t\tthis.component.hideDataItem(this, duration);\n\t\t}\n\t}\n\n\tpublic isHidden() {\n\t\treturn !this.get(\"visible\");\n\t}\n}\n\n\nexport interface IComponentDataItem {\n\tvisible?: boolean;\n}\n\nexport interface IComponentSettings extends IContainerSettings {\n\n\t/**\n\t * A duration of the animation from one setting value to another, in\n\t * milliseconds.\n\t *\n\t * @see {@link https://www.amcharts.com/docs/v5/concepts/animations/#Animating_data_values} for more info\n\t */\n\tinterpolationDuration?: number;\n\n\t/**\n\t * Easing function to use for cross setting value animations.\n\t *\n\t * @see {@link https://www.amcharts.com/docs/v5/concepts/animations/#Easing_functions} for more info\n\t */\n\tinterpolationEasing?: $ease.Easing;\n\n}\n\nexport interface IComponentPrivate extends IContainerPrivate {\n}\n\nexport interface IComponentEvents extends IContainerEvents {\n\tdatavalidated: {}\n}\n\n/**\n * A base class for elements that make use of data.\n */\nexport abstract class Component extends Container {\n\tpublic static className: string = \"Component\";\n\tpublic static classNames: Array<string> = Container.classNames.concat([Component.className]);\n\n\tdeclare public _settings: IComponentSettings;\n\tdeclare public _privateSettings: IComponentPrivate;\n\tdeclare public _dataItemSettings: IComponentDataItem;\n\tdeclare public _events: IComponentEvents;\n\n\tprotected _data: ListData<unknown> = new ListData();\n\n\tprotected _dataItems: Array<DataItem<this[\"_dataItemSettings\"]>> = [];\n\n\tpublic _mainDataItems = this._dataItems;\n\n\tprotected valueFields: Array<string> = [];\n\tprotected fields: Array<string> = [\"id\"];\n\n\tprotected _valueFields!: Array<string>;\n\tprotected _valueFieldsF!: { [index: string]: { fieldKey: string, workingKey: string } };\n\n\tprotected _fields!: Array<string>;\n\tprotected _fieldsF!: { [index: string]: string };\n\n\tpublic _valuesDirty: boolean = false;\n\n\tprotected _dataChanged: boolean = false;\n\n\tprotected _dataGrouped = false;\n\n\t/**\n\t * Indicates if the component has already been initialized.\n\t */\n\tpublic inited: boolean = false;\n\n\t/**\n\t * Component's data.\n\t *\n\t * @see {@link https://www.amcharts.com/docs/v5/concepts/data/} for more info\n\t */\n\tpublic set data(data: ListData<unknown>) {\n\t\tdata.incrementRef();\n\t\tthis._data.decrementRef();\n\t\tthis._data = data;\n\t}\n\n\t/**\n\t * @return  Data\n\t */\n\tpublic get data(): ListData<unknown> {\n\t\treturn this._data;\n\t}\n\n\tprotected _dispose() {\n\t\tsuper._dispose();\n\t\tthis._data.decrementRef();\n\t}\n\n\tprotected _onDataClear() {\n\n\t}\n\n\tprotected _afterNew() {\n\t\tsuper._afterNew();\n\n\t\tthis._data.incrementRef();\n\t\tthis._updateFields();\n\n\t\tthis._disposers.push(this.data.events.onAll((change) => {\n\t\t\tconst dataItems = this._mainDataItems;\n\t\t\tthis.markDirtyValues();\n\t\t\tthis._markDirtyGroup();\n\t\t\tthis._dataChanged = true;\n\t\t\tif (change.type === \"clear\") {\n\t\t\t\t$array.each(dataItems, (dataItem) => {\n\t\t\t\t\tdataItem.dispose();\n\t\t\t\t});\n\n\t\t\t\tdataItems.length = 0;\n\t\t\t\tthis._onDataClear();\n\t\t\t} else if (change.type === \"push\") {\n\t\t\t\tconst dataItem = new DataItem(this, change.newValue, this._makeDataItem(change.newValue));\n\t\t\t\tdataItems.push(dataItem);\n\t\t\t\tthis.processDataItem(dataItem);\n\n\t\t\t} else if (change.type === \"setIndex\") {\n\t\t\t\tconst dataItem = dataItems[change.index];\n\t\t\t\tconst properties = this._makeDataItem(change.newValue);\n\n\t\t\t\t$object.keys(properties).forEach((key) => {\n\t\t\t\t\tdataItem.animate({\n\t\t\t\t\t\tkey: key,\n\t\t\t\t\t\tto: properties[key],\n\t\t\t\t\t\tduration: this.get(\"interpolationDuration\", 0),\n\t\t\t\t\t\teasing: this.get(\"interpolationEasing\"),\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tdataItem.dataContext = change.newValue;\n\n\t\t\t} else if (change.type === \"insertIndex\") {\n\t\t\t\tconst dataItem = new DataItem(this, change.newValue, this._makeDataItem(change.newValue));\n\t\t\t\tdataItems.splice(change.index, 0, dataItem);\n\t\t\t\tthis.processDataItem(dataItem);\n\n\t\t\t} else if (change.type === \"removeIndex\") {\n\t\t\t\tconst dataItem = dataItems[change.index];\n\t\t\t\tdataItem.dispose();\n\t\t\t\tdataItems.splice(change.index, 1);\n\n\t\t\t} else if (change.type === \"moveIndex\") {\n\t\t\t\tconst dataItem = dataItems[change.oldIndex];\n\t\t\t\tdataItems.splice(change.oldIndex, 1);\n\t\t\t\tdataItems.splice(change.newIndex, 0, dataItem);\n\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"Unknown IStreamEvent type\");\n\t\t\t}\n\n\t\t\tthis._afterDataChange();\n\t\t}));\n\t}\n\n\tprotected _updateFields() {\n\t\tif (this.valueFields) {\n\t\t\tthis._valueFields = [];\n\t\t\tthis._valueFieldsF = {};\n\n\t\t\t$array.each(this.valueFields as Array<keyof this[\"_settings\"]>, (key) => {\n\t\t\t\tconst field = this.get(<any>(key + \"Field\"));\n\t\t\t\tif (field) {\n\t\t\t\t\tthis._valueFields.push(<any>key);\n\t\t\t\t\tthis._valueFieldsF[key as string] = { fieldKey: key + \"Field\", workingKey: key + \"Working\" };\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.fields) {\n\t\t\tthis._fields = [];\n\t\t\tthis._fieldsF = {};\n\n\t\t\t$array.each(this.fields as Array<keyof this[\"_settings\"]>, (key) => {\n\t\t\t\tconst field = this.get(<any>(key + \"Field\"));\n\t\t\t\tif (field) {\n\t\t\t\t\tthis._fields.push(<any>key);\n\t\t\t\t\tthis._fieldsF[key as string] = key + \"Field\";\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * A list of component's data items.\n\t *\n\t * @return  Data items\n\t */\n\tpublic get dataItems(): Array<DataItem<this[\"_dataItemSettings\"]>> {\n\t\treturn this._dataItems;\n\t}\n\n\tprotected processDataItem(_dataItem: DataItem<this[\"_dataItemSettings\"]>) { }\n\n\n\tpublic _makeDataItem(data: unknown): this[\"_dataItemSettings\"] {\n\t\t//const output: this[\"_dataItemSettings\"] = {};\n\t\tconst output: any = {}; // temporary to solve error\n\t\tif (this._valueFields) {\n\t\t\t$array.each(this._valueFields, (key) => {\n\t\t\t\tconst field = this.get(<any>(this._valueFieldsF[key].fieldKey));\n\t\t\t\toutput[key] = (data as any)[field];\n\n\t\t\t\toutput[this._valueFieldsF[key].workingKey] = output[key];\n\t\t\t});\n\t\t}\n\t\tif (this._fields) {\n\t\t\t$array.each(this._fields, (key) => {\n\t\t\t\tconst field = this.get(<any>(this._fieldsF[key]));\n\t\t\t\toutput[key] = (data as any)[field];\n\t\t\t});\n\t\t}\n\n\t\treturn output;\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic makeDataItem(data: this[\"_dataItemSettings\"]): DataItem<this[\"_dataItemSettings\"]> {\n\t\tlet dataItem = new DataItem(this, undefined, data);\n\t\tthis.processDataItem(dataItem);\n\t\treturn dataItem;\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic pushDataItem(data: this[\"_dataItemSettings\"]): DataItem<this[\"_dataItemSettings\"]> {\n\t\tconst dataItem = this.makeDataItem(data);\n\t\tthis._mainDataItems.push(dataItem);\n\t\treturn dataItem;\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic disposeDataItem(_dataItem: DataItem<this[\"_dataItemSettings\"]>) { }\n\n\t/**\n\t * Shows component's data item.\n\t *\n\t * @param   dataItem   Data item\n\t * @param   _duration  Animation duration in milliseconds\n\t * @return             Promise\n\t */\n\tpublic async showDataItem(dataItem: DataItem<this[\"_dataItemSettings\"]>, _duration?: number): Promise<void> {\n\t\tdataItem.set(\"visible\", true);\n\t}\n\n\t/**\n\t * Hides component's data item.\n\t *\n\t * @param   dataItem   Data item\n\t * @param   _duration  Animation duration in milliseconds\n\t * @return             Promise\n\t */\n\tpublic async hideDataItem(dataItem: DataItem<this[\"_dataItemSettings\"]>, _duration?: number): Promise<void> {\n\t\tdataItem.set(\"visible\", false);\n\t}\n\n\tpublic _clearDirty() {\n\t\tsuper._clearDirty();\n\t\tthis._valuesDirty = false;\n\t}\n\n\tprotected _afterDataChange() {\n\n\t}\n\n\tpublic _afterChanged() {\n\t\tsuper._afterChanged();\n\t\tif (this._dataChanged) {\n\t\t\tconst type = \"datavalidated\";\n\t\t\tif (this.events.isEnabled(type)) {\n\t\t\t\tthis.events.dispatch(type, { type: type, target: this });\n\t\t\t}\n\t\t\tthis._dataChanged = false;\t\t\t\n\t\t}\n\n\t\tthis.inited = true;\n\t}\n\n\t/**\n\t * Forces a repaint of the element which relies on data.\n\t *\n\t * @since 5.0.21\n\t */\n\tpublic markDirtyValues(_dataItem?: DataItem<this[\"_dataItemSettings\"]>) {\n\t\tthis.markDirty();\n\t\tthis._valuesDirty = true;\n\t}\n\n\tpublic _markDirtyGroup() {\n\t\tthis._dataGrouped = false;\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic markDirtySize() {\n\t\tthis._sizeDirty = true;\n\t\tthis.markDirty();\n\t}\n\n}\n"]},"metadata":{},"sourceType":"module"}