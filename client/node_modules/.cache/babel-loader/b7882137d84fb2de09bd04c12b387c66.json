{"ast":null,"code":"import { __awaiter, __extends, __generator } from \"tslib\";\nimport { Entity } from \"../util/Entity\";\nimport { Template } from \"../util/Template\";\nimport { Percent } from \"../util/Percent\";\nimport { EventDispatcher } from \"../util/EventDispatcher\";\nimport { MultiDisposer, CounterDisposer } from \"../util/Disposer\";\nimport { waitForAnimations } from \"../util/Animation\";\nimport * as $utils from \"../util/Utils\";\nimport * as $array from \"../util/Array\";\nimport * as $type from \"../util/Type\";\nimport * as $object from \"../util/Object\";\nimport * as $math from \"../util/Math\"; //import { populateString } from \"../util/PopulateString\";\n\n/**\r\n * An [[EventDispatcher]] for [[Sprite]].\r\n *\r\n * @see {@link https://www.amcharts.com/docs/v5/concepts/events/} for more info\r\n */\n\nvar SpriteEventDispatcher =\n/** @class */\nfunction (_super) {\n  __extends(SpriteEventDispatcher, _super);\n\n  function SpriteEventDispatcher(sprite) {\n    var _this = _super.call(this) || this;\n\n    Object.defineProperty(_this, \"_sprite\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_this, \"_rendererDisposers\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: {}\n    });\n    Object.defineProperty(_this, \"_dispatchParents\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: true\n    });\n    _this._sprite = sprite;\n    return _this;\n  }\n\n  Object.defineProperty(SpriteEventDispatcher.prototype, \"_makePointerEvent\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (key, event) {\n      return {\n        type: key,\n        originalEvent: event.event,\n        point: event.point,\n        simulated: event.simulated,\n        native: event.native,\n        target: this._sprite\n      };\n    }\n  });\n  Object.defineProperty(SpriteEventDispatcher.prototype, \"_onRenderer\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (key, dispatch) {\n      var _this = this; // TODO: is this OK? it'd be good not to require to set this on each individual element\n\n\n      this._sprite.set(\"interactive\", true);\n\n      this._sprite._display.interactive = true;\n      var events = this._rendererDisposers[key];\n\n      if (events === undefined) {\n        var disposer_1 = this._sprite._display.on(key, function (e) {\n          dispatch.call(_this, e);\n        });\n\n        events = this._rendererDisposers[key] = new CounterDisposer(function () {\n          delete _this._rendererDisposers[key];\n          disposer_1.dispose();\n        });\n      }\n\n      return events.increment();\n    }\n  });\n  Object.defineProperty(SpriteEventDispatcher.prototype, \"_on\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (once, type, callback, context, shouldClone, dispatch) {\n      var info = _super.prototype._on.call(this, once, type, callback, context, shouldClone, dispatch);\n\n      var rendererEvent = SpriteEventDispatcher.RENDERER_EVENTS[type];\n\n      if (rendererEvent !== undefined) {\n        info.disposer = new MultiDisposer([info.disposer, this._onRenderer(type, rendererEvent)]);\n      }\n\n      return info;\n    }\n  });\n  /**\r\n   * Will stop any bubbling up of the event to element's parents.\r\n   *\r\n   * Should be called in an event handler, e.g.:\r\n   *\r\n   * ```TypeScript\r\n   * element.events.on(\"pointerdown\", function(ev) {\r\n   *   // Do something here and prevent from \"pointerdown\" bubbling up\r\n   *   // ...\r\n   *   ev.target.events.stopParentDispatch();\r\n   * });\r\n   * ```\r\n   * ```JavaScript\r\n   * element.events.on(\"pointerdown\", function(ev) {\r\n   *   // Do something here and prevent from \"pointerdown\" bubbling up\r\n   *   // ...\r\n   *   ev.target.events.stopParentDispatch();\r\n   * });\r\n   * ```\r\n   */\n\n  Object.defineProperty(SpriteEventDispatcher.prototype, \"stopParentDispatch\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      this._dispatchParents = false;\n    }\n  });\n  /**\r\n   * @ignore\r\n   */\n\n  Object.defineProperty(SpriteEventDispatcher.prototype, \"dispatchParents\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (type, event) {\n      var old = this._dispatchParents;\n      this._dispatchParents = true;\n\n      try {\n        this.dispatch(type, event);\n\n        if (this._dispatchParents && this._sprite.parent) {\n          this._sprite.parent.events.dispatchParents(type, event);\n        }\n      } finally {\n        this._dispatchParents = old;\n      }\n    }\n  });\n  Object.defineProperty(SpriteEventDispatcher, \"RENDERER_EVENTS\", {\n    enumerable: true,\n    configurable: true,\n    writable: true,\n    value: {\n      \"click\": function (event) {\n        if (this.isEnabled(\"click\") && !this._sprite.isDragging() && this._sprite._hasDown() && !this._sprite._hasMoved(this._makePointerEvent(\"click\", event))) {\n          this.dispatch(\"click\", this._makePointerEvent(\"click\", event));\n        }\n      },\n      \"rightclick\": function (event) {\n        if (this.isEnabled(\"rightclick\")) {\n          this.dispatch(\"rightclick\", this._makePointerEvent(\"rightclick\", event));\n        }\n      },\n      \"middleclick\": function (event) {\n        if (this.isEnabled(\"middleclick\")) {\n          this.dispatch(\"middleclick\", this._makePointerEvent(\"middleclick\", event));\n        }\n      },\n      \"dblclick\": function (event) {\n        this.dispatchParents(\"dblclick\", this._makePointerEvent(\"dblclick\", event));\n      },\n      \"pointerover\": function (event) {\n        if (this.isEnabled(\"pointerover\")) {\n          this.dispatch(\"pointerover\", this._makePointerEvent(\"pointerover\", event));\n        }\n      },\n      \"pointerout\": function (event) {\n        if (this.isEnabled(\"pointerout\")) {\n          this.dispatch(\"pointerout\", this._makePointerEvent(\"pointerout\", event));\n        }\n      },\n      \"pointerdown\": function (event) {\n        this.dispatchParents(\"pointerdown\", this._makePointerEvent(\"pointerdown\", event));\n      },\n      \"pointerup\": function (event) {\n        if (this.isEnabled(\"pointerup\")) {\n          this.dispatch(\"pointerup\", this._makePointerEvent(\"pointerup\", event));\n        }\n      },\n      \"globalpointerup\": function (event) {\n        if (this.isEnabled(\"globalpointerup\")) {\n          this.dispatch(\"globalpointerup\", this._makePointerEvent(\"globalpointerup\", event));\n        }\n      },\n      \"globalpointermove\": function (event) {\n        if (this.isEnabled(\"globalpointermove\")) {\n          this.dispatch(\"globalpointermove\", this._makePointerEvent(\"globalpointermove\", event));\n        }\n      },\n      \"wheel\": function (event) {\n        this.dispatchParents(\"wheel\", {\n          type: \"wheel\",\n          target: this._sprite,\n          originalEvent: event.event,\n          point: event.point\n        });\n      }\n    }\n  });\n  return SpriteEventDispatcher;\n}(EventDispatcher);\n/**\r\n * A base class for all visual elements.\r\n *\r\n * @important\r\n */\n\n\nvar Sprite =\n/** @class */\nfunction (_super) {\n  __extends(Sprite, _super);\n\n  function Sprite() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    Object.defineProperty(_this, \"_adjustedLocalBounds\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: {\n        left: 0,\n        right: 0,\n        top: 0,\n        bottom: 0\n      }\n    });\n    Object.defineProperty(_this, \"_localBounds\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: {\n        left: 0,\n        right: 0,\n        top: 0,\n        bottom: 0\n      }\n    });\n    Object.defineProperty(_this, \"_parent\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_this, \"_dataItem\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_this, \"_templateField\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_this, \"_sizeDirty\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: false\n    }); // Will be true only when dragging\n\n    Object.defineProperty(_this, \"_isDragging\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: false\n    }); // The event when the dragging starts\n\n    Object.defineProperty(_this, \"_dragEvent\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    }); // The position when dragging starts\n\n    Object.defineProperty(_this, \"_dragPoint\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_this, \"_isHidden\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: false\n    });\n    Object.defineProperty(_this, \"_isShowing\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: false\n    });\n    Object.defineProperty(_this, \"_isHiding\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: false\n    });\n    Object.defineProperty(_this, \"_isDown\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: false\n    });\n    Object.defineProperty(_this, \"_downPoint\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_this, \"_downPoints\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: {}\n    });\n    Object.defineProperty(_this, \"_toggleDp\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_this, \"_dragDp\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_this, \"_tooltipDp\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_this, \"_hoverDp\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_this, \"_focusDp\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_this, \"_tooltipMoveDp\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_this, \"_tooltipPointerDp\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_this, \"_statesHandled\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: false\n    });\n    return _this;\n  }\n\n  Object.defineProperty(Sprite.prototype, \"_afterNew\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      this.setPrivateRaw(\"visible\", true);\n\n      _super.prototype._afterNew.call(this);\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_markDirtyKey\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (key) {\n      _super.prototype._markDirtyKey.call(this, key);\n\n      if (key == \"x\" || key == \"y\" || key == \"dx\" || key == \"dy\") {\n        this.markDirtyBounds();\n\n        this._addPercentagePositionChildren();\n\n        this.markDirtyPosition();\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_markDirtyPrivateKey\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (key) {\n      _super.prototype._markDirtyPrivateKey.call(this, key);\n\n      if (key == \"x\" || key == \"y\") {\n        this.markDirtyPosition();\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_removeTemplateField\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      if (this._templateField) {\n        this._templateField._removeObjectTemplate(this);\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_createEvents\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return new SpriteEventDispatcher(this);\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_processTemplateField\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var template;\n      var field = this.get(\"templateField\");\n\n      if (field) {\n        var dataItem = this.dataItem;\n\n        if (dataItem) {\n          var context = dataItem.dataContext;\n\n          if (context) {\n            template = context[field];\n\n            if (!(template instanceof Template) && template) {\n              template = Template.new(template);\n            }\n          }\n        }\n      }\n\n      if (this._templateField !== template) {\n        this._removeTemplateField();\n\n        this._templateField = template;\n\n        if (template) {\n          template._setObjectTemplate(this);\n        }\n\n        this._applyTemplates();\n      }\n    }\n  }); // TODO change this to run before the element is added to the parent, so that way\n  //      it doesn't need to apply the themes twice\n\n  Object.defineProperty(Sprite.prototype, \"_setDataItem\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (dataItem) {\n      var oldDataItem = this._dataItem;\n      this._dataItem = dataItem;\n\n      this._processTemplateField();\n\n      var eventType = \"dataitemchanged\";\n\n      if (this.events.isEnabled(eventType)) {\n        this.events.dispatch(eventType, {\n          type: eventType,\n          target: this,\n          oldDataItem: oldDataItem,\n          newDataItem: dataItem\n        });\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"dataItem\", {\n    /**\r\n     * @return DataItem\r\n     */\n    get: function () {\n      if (this._dataItem) {\n        return this._dataItem;\n      } else {\n        var parent_1 = this._parent;\n\n        while (parent_1) {\n          if (parent_1._dataItem) {\n            return parent_1._dataItem;\n          } else {\n            parent_1 = parent_1._parent;\n          }\n        }\n      }\n    },\n\n    /**\r\n     * A [[DataItem]] used for this element.\r\n     *\r\n     * NOTE: data item is being assigned automatically in most cases where it\r\n     * matters. Use this accessor to set data item only if you know what you're\r\n     * doing.\r\n     *\r\n     * @param  value  Data item\r\n     */\n    set: function (value) {\n      this._setDataItem(value);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Sprite.prototype, \"_addPercentageSizeChildren\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var parent = this.parent;\n\n      if (parent) {\n        if (this.get(\"width\") instanceof Percent || this.get(\"height\") instanceof Percent) {\n          $array.pushOne(parent._percentageSizeChildren, this);\n        } else {\n          $array.removeFirst(parent._percentageSizeChildren, this);\n        }\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_addPercentagePositionChildren\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var parent = this.parent;\n\n      if (parent) {\n        if (this.get(\"x\") instanceof Percent || this.get(\"y\") instanceof Percent) {\n          $array.pushOne(parent._percentagePositionChildren, this);\n        } else {\n          $array.removeFirst(parent._percentagePositionChildren, this);\n        }\n      }\n    }\n  });\n  /**\r\n   * @ignore\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"markDirtyPosition\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      this._root._addDirtyPosition(this);\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"updatePivotPoint\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var bounds = this._localBounds;\n\n      if (bounds) {\n        var centerX = this.get(\"centerX\");\n\n        if (centerX != null) {\n          this._display.pivot.x = bounds.left + $utils.relativeToValue(centerX, bounds.right - bounds.left);\n        }\n\n        var centerY = this.get(\"centerY\");\n\n        if (centerY != null) {\n          this._display.pivot.y = bounds.top + $utils.relativeToValue(centerY, bounds.bottom - bounds.top);\n        }\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_beforeChanged\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var _this = this;\n\n      _super.prototype._beforeChanged.call(this); // handling states in beforeChanged, otherwise states is not applied without animated theme\n\n\n      this._handleStates();\n\n      if (this.isDirty(\"tooltip\")) {\n        var previous = this._prevSettings.tooltip;\n\n        if (previous) {\n          previous.dispose();\n        }\n      }\n\n      if (this.isDirty(\"layer\")) {\n        this._display.setLayer(this.get(\"layer\"));\n\n        this.markDirtyLayer();\n      }\n\n      if (this.isDirty(\"tooltipPosition\")) {\n        var tooltipMoveDp = this._tooltipMoveDp;\n\n        if (tooltipMoveDp) {\n          tooltipMoveDp.dispose();\n          this._tooltipMoveDp = undefined;\n        }\n\n        var tooltipPointerDp = this._tooltipPointerDp;\n\n        if (tooltipPointerDp) {\n          tooltipPointerDp.dispose();\n          this._tooltipPointerDp = undefined;\n        }\n\n        if (this.get(\"tooltipPosition\") == \"pointer\") {\n          this._tooltipPointerDp = new MultiDisposer([this.events.on(\"pointerover\", function () {\n            _this._tooltipMoveDp = _this.events.on(\"globalpointermove\", function (e) {\n              _this.showTooltip(e.point);\n            });\n          }), this.events.on(\"pointerout\", function () {\n            var tooltipMoveDp = _this._tooltipMoveDp;\n\n            if (tooltipMoveDp) {\n              tooltipMoveDp.dispose();\n              _this._tooltipMoveDp = undefined;\n            }\n          })]);\n        }\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_handleStates\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      if (!this._statesHandled) {\n        if (this.isDirty(\"active\")) {\n          if (this.get(\"active\")) {\n            this.states.applyAnimate(\"active\");\n            this.set(\"ariaChecked\", true);\n          } else {\n            if (!this.isHidden()) {\n              this.states.applyAnimate(\"default\");\n            }\n\n            this.set(\"ariaChecked\", false);\n          }\n\n          this.markDirtyAccessibility();\n        }\n\n        if (this.isDirty(\"disabled\")) {\n          if (this.get(\"disabled\")) {\n            this.states.applyAnimate(\"disabled\");\n            this.set(\"ariaChecked\", false);\n          } else {\n            if (!this.isHidden()) {\n              this.states.applyAnimate(\"default\");\n            }\n\n            this.set(\"ariaChecked\", true);\n          }\n\n          this.markDirtyAccessibility();\n        }\n\n        this._statesHandled = true;\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_changed\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var _this = this;\n\n      _super.prototype._changed.call(this);\n\n      var display = this._display;\n      var events = this.events;\n\n      if (this.isDirty(\"draggable\")) {\n        var draggable = this.get(\"draggable\");\n\n        if (draggable) {\n          this.set(\"interactive\", true);\n          this._dragDp = new MultiDisposer([events.on(\"pointerdown\", function (ev) {\n            _this.dragStart(ev);\n          }), events.on(\"globalpointermove\", function (ev) {\n            _this.dragMove(ev);\n          }), events.on(\"globalpointerup\", function (ev) {\n            _this.dragStop(ev);\n          })]);\n        } else {\n          if (this._dragDp) {\n            this._dragDp.dispose();\n\n            this._dragDp = undefined;\n          }\n        }\n      }\n\n      if (this.isDirty(\"tooltipText\")) {\n        var tooltipText = this.get(\"tooltipText\");\n\n        if (tooltipText) {\n          this._tooltipDp = new MultiDisposer([events.on(\"pointerover\", function () {\n            _this.showTooltip();\n          }), events.on(\"pointerout\", function () {\n            if (_this.get(\"showTooltipOn\") != \"always\") {\n              _this.hideTooltip();\n            }\n          })]);\n        } else {\n          if (this._tooltipDp) {\n            this._tooltipDp.dispose();\n\n            this._tooltipDp = undefined;\n          }\n        }\n      }\n\n      if (this.isDirty(\"toggleKey\")) {\n        var toggleKey_1 = this.get(\"toggleKey\");\n\n        if (toggleKey_1 && toggleKey_1 != \"none\") {\n          this._toggleDp = events.on(\"click\", function () {\n            if (!_this._isDragging) {\n              _this.set(toggleKey_1, !_this.get(toggleKey_1));\n            }\n          });\n        } else {\n          if (this._toggleDp) {\n            this._toggleDp.dispose();\n\n            this._toggleDp = undefined;\n          }\n        }\n      }\n\n      if (this.isDirty(\"opacity\")) {\n        display.alpha = Math.max(0, this.get(\"opacity\", 1));\n      }\n\n      if (this.isDirty(\"rotation\")) {\n        this.markDirtyBounds();\n        display.angle = this.get(\"rotation\", 0);\n      }\n\n      if (this.isDirty(\"scale\")) {\n        this.markDirtyBounds();\n        display.scale = this.get(\"scale\", 0);\n      }\n\n      if (this.isDirty(\"centerX\") || this.isDirty(\"centerY\")) {\n        this.markDirtyBounds();\n        this.updatePivotPoint();\n      }\n\n      if (this.isDirty(\"visible\") || this.isPrivateDirty(\"visible\") || this.isDirty(\"forceHidden\")) {\n        if (!this.get(\"visible\") || !this.getPrivate(\"visible\") || this.get(\"forceHidden\")) {\n          display.visible = false;\n          this.hideTooltip();\n        } else {\n          display.visible = true;\n        }\n\n        this.markDirtyBounds();\n\n        if (this.get(\"focusable\")) {\n          this.markDirtyAccessibility();\n        }\n      }\n\n      if (this.isDirty(\"width\") || this.isDirty(\"height\")) {\n        this.markDirtyBounds();\n\n        this._addPercentageSizeChildren();\n\n        var parent_2 = this.parent;\n\n        if (parent_2) {\n          if (this.isDirty(\"width\") && this.get(\"width\") instanceof Percent || this.isDirty(\"height\") && this.get(\"height\") instanceof Percent) {\n            parent_2.markDirty();\n            parent_2._prevWidth = 0;\n          }\n        }\n\n        this._sizeDirty = true;\n      }\n\n      if (this.isDirty(\"maxWidth\") || this.isDirty(\"maxHeight\") || this.isPrivateDirty(\"width\") || this.isPrivateDirty(\"height\") || this.isDirty(\"minWidth\") || this.isDirty(\"minHeight\")) {\n        this.markDirtyBounds();\n        this._sizeDirty = true;\n      }\n\n      if (this._sizeDirty) {\n        this._updateSize();\n      }\n\n      if (this.isDirty(\"wheelable\")) {\n        var wheelable = this.get(\"wheelable\");\n\n        if (wheelable) {\n          this.set(\"interactive\", true);\n        }\n\n        display.wheelable = wheelable ? true : false;\n      } // Accessibility\n\n\n      if (this.isDirty(\"tabindexOrder\") || this.isDirty(\"focusableGroup\")) {\n        if (this.get(\"focusable\")) {\n          this._root._registerTabindexOrder(this);\n        } else {\n          this._root._unregisterTabindexOrder(this);\n        }\n      }\n\n      if (this.isDirty(\"filter\")) {\n        //this.markDirtyBounds();\n        display.filter = this.get(\"filter\");\n      }\n\n      if (this.isDirty(\"cursorOverStyle\")) {\n        display.cursorOverStyle = this.get(\"cursorOverStyle\");\n      }\n\n      if (this.isDirty(\"hoverOnFocus\")) {\n        if (this.get(\"hoverOnFocus\")) {\n          this._focusDp = new MultiDisposer([events.on(\"focus\", function () {\n            // TODO: proper hover, not just tooltip\n            _this.showTooltip();\n          }), events.on(\"blur\", function () {\n            // TODO: proper hover, not just tooltip\n            _this.hideTooltip();\n          })]);\n        } else {\n          if (this._focusDp) {\n            this._focusDp.dispose();\n\n            this._focusDp = undefined;\n          }\n        }\n      }\n\n      if (this.isDirty(\"focusable\")) {\n        if (this.get(\"focusable\")) {\n          this._root._registerTabindexOrder(this);\n        } else {\n          this._root._unregisterTabindexOrder(this);\n        }\n\n        this.markDirtyAccessibility();\n      }\n\n      if (this.isDirty(\"role\") || this.isDirty(\"ariaLive\") || this.isDirty(\"ariaChecked\") || this.isDirty(\"ariaHidden\") || this.isDirty(\"ariaOrientation\") || this.isDirty(\"ariaValueNow\") || this.isDirty(\"ariaValueMin\") || this.isDirty(\"ariaValueMax\") || this.isDirty(\"ariaValueText\") || this.isDirty(\"ariaLabel\") || this.isDirty(\"ariaControls\")) {\n        // display.accessibility.ariaLabel = populateString(this, this.get(\"ariaLabel\", \"\"));\n        // @todo make sure ariaLabel gets populated in Root\n        this.markDirtyAccessibility();\n      }\n\n      if (this.isDirty(\"exportable\")) {\n        display.exportable = this.get(\"exportable\");\n      }\n\n      if (this.isDirty(\"interactive\")) {\n        var events_1 = this.events;\n\n        if (this.get(\"interactive\")) {\n          this._hoverDp = new MultiDisposer([events_1.on(\"click\", function (ev) {\n            if ($utils.isTouchEvent(ev.originalEvent)) {\n              if (!_this.getPrivate(\"touchHovering\")) {\n                _this.setTimeout(function () {\n                  _this._handleOver();\n\n                  if (_this.get(\"tooltipText\")) {\n                    _this.showTooltip();\n                  }\n\n                  _this.setPrivateRaw(\"touchHovering\", true);\n\n                  _this.events.dispatch(\"pointerover\", {\n                    type: \"pointerover\",\n                    target: ev.target,\n                    originalEvent: ev.originalEvent,\n                    point: ev.point,\n                    simulated: ev.simulated\n                  });\n                }, 10);\n              }\n            }\n          }), events_1.on(\"globalpointerup\", function (ev) {\n            if ($utils.isTouchEvent(ev.originalEvent)) {\n              if (_this.getPrivate(\"touchHovering\")) {\n                _this._handleOut();\n\n                if (_this.get(\"tooltipText\")) {\n                  _this.hideTooltip();\n                }\n              }\n\n              _this.setPrivateRaw(\"touchHovering\", false);\n\n              _this.events.dispatch(\"pointerout\", {\n                type: \"pointerout\",\n                target: ev.target,\n                originalEvent: ev.originalEvent,\n                point: ev.point,\n                simulated: ev.simulated\n              });\n            }\n\n            if (_this._isDown) {\n              _this._handleUp(ev);\n            } //this._isDown = false;\n\n          }), events_1.on(\"pointerover\", function () {\n            _this._handleOver();\n          }), events_1.on(\"pointerout\", function () {\n            _this._handleOut();\n          }), events_1.on(\"pointerdown\", function (e) {\n            _this._handleDown(e);\n          })]);\n        } else {\n          this._display.interactive = false;\n\n          if (this._hoverDp) {\n            this._hoverDp.dispose();\n\n            this._hoverDp = undefined;\n          }\n        }\n      }\n\n      if (this.isDirty(\"forceInactive\")) {\n        this._display.inactive = this.get(\"forceInactive\", false);\n      }\n\n      if (this.get(\"showTooltipOn\") == \"always\" && this._display.visible) {\n        this.showTooltip();\n      }\n    }\n  });\n  /**\r\n   * @ignore\r\n   * @todo should this be user-accessible?\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"dragStart\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (e) {\n      this._dragEvent = e;\n      this.events.stopParentDispatch();\n    }\n  });\n  /**\r\n   * @ignore\r\n   * @todo should this be user-accessible?\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"dragStop\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (e) {\n      this._dragEvent = undefined;\n      this._dragPoint = undefined;\n      this.events.stopParentDispatch();\n\n      if (this._isDragging) {\n        this._isDragging = false;\n        var type = \"dragstop\";\n\n        if (this.events.isEnabled(type)) {\n          this.events.dispatch(type, {\n            type: type,\n            target: this,\n            originalEvent: e.originalEvent,\n            point: e.point,\n            simulated: e.simulated\n          });\n        }\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_handleOver\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      if (!this.isHidden()) {\n        if (this.get(\"active\") && this.states.lookup(\"hoverActive\")) {\n          this.states.applyAnimate(\"hoverActive\");\n        } else if (this.get(\"disabled\") && this.states.lookup(\"hoverDisabled\")) {\n          this.states.applyAnimate(\"hoverDisabled\");\n        } else {\n          this.states.applyAnimate(\"hover\");\n        }\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_handleOut\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      if (!this.isHidden()) {\n        if (this.get(\"active\") && this.states.lookup(\"active\")) {\n          this.states.applyAnimate(\"active\");\n        } else if (this.get(\"disabled\") && this.states.lookup(\"disabled\")) {\n          this.states.applyAnimate(\"disabled\");\n        } else {\n          if (this.states.lookup(\"hover\") || this.states.lookup(\"hoverActive\")) {\n            this.states.applyAnimate(\"default\");\n          }\n        }\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_handleUp\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (e) {\n      if (!this.isHidden()) {\n        if (this.get(\"active\") && this.states.lookup(\"active\")) {\n          this.states.applyAnimate(\"active\");\n        } else if (this.get(\"disabled\") && this.states.lookup(\"disabled\")) {\n          this.states.applyAnimate(\"disabled\");\n        } else if (this.states.lookup(\"down\")) {\n          if (this.isHover()) {\n            this.states.applyAnimate(\"hover\");\n          } else {\n            this.states.applyAnimate(\"default\");\n          }\n        } // @todo remove this once migrated to _downPoints\n\n\n        this._downPoint = undefined;\n        var pointerId = $utils.getPointerId(e.originalEvent);\n        delete this._downPoints[pointerId];\n\n        if ($object.keys(this._downPoints).length == 0) {\n          this._isDown = false;\n        }\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_hasMoved\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (e) {\n      // @todo remove this once migrated to _downPoints\n      // if (this._downPoint) {\n      // \tconst x = Math.abs(this._downPoint.x - e.point.x);\n      // \tconst y = Math.abs(this._downPoint.y - e.point.y);\n      // \treturn (x > 5) || (y > 5);\n      // }\n      var pointerId = $utils.getPointerId(e.originalEvent);\n      var downPoint = this._downPoints[pointerId];\n\n      if (downPoint) {\n        var x = Math.abs(downPoint.x - e.point.x);\n        var y = Math.abs(downPoint.y - e.point.y);\n        return x > 5 || y > 5;\n      }\n\n      return false;\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_hasDown\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return $object.keys(this._downPoints).length > 0;\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_handleDown\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (e) {\n      var parent = this.parent;\n\n      if (parent && !this.get(\"draggable\")) {\n        parent._handleDown(e);\n      }\n\n      if (this.get(\"interactive\") && !this.isHidden()) {\n        if (this.states.lookup(\"down\")) {\n          this.states.applyAnimate(\"down\");\n        }\n\n        this._downPoint = {\n          x: e.point.x,\n          y: e.point.y\n        }; // @todo remove this once migrated to _downPoints\n\n        this._isDown = true;\n        var pointerId = $utils.getPointerId(e.originalEvent);\n        this._downPoints[pointerId] = {\n          x: e.point.x,\n          y: e.point.y\n        };\n      }\n    }\n  });\n  /**\r\n   * @ignore\r\n   * @todo should this be user-accessible?\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"dragMove\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (e) {\n      var dragEvent = this._dragEvent;\n\n      if (dragEvent) {\n        var angle = 0;\n        var parent_3 = this.parent;\n\n        while (parent_3 != null) {\n          angle += parent_3.get(\"rotation\", 0);\n          parent_3 = parent_3.parent;\n        }\n\n        var x = e.point.x - dragEvent.point.x;\n        var y = e.point.y - dragEvent.point.y;\n        var events = this.events;\n\n        if (dragEvent.simulated && !this._isDragging) {\n          this._isDragging = true;\n          this._dragEvent = e;\n          this._dragPoint = {\n            x: this.x(),\n            y: this.y()\n          };\n          var type = \"dragstart\";\n\n          if (events.isEnabled(type)) {\n            events.dispatch(type, {\n              type: type,\n              target: this,\n              originalEvent: e.originalEvent,\n              point: e.point,\n              simulated: e.simulated\n            });\n          }\n        }\n\n        if (this._isDragging) {\n          var dragPoint = this._dragPoint;\n          this.set(\"x\", dragPoint.x + x * $math.cos(angle) + y * $math.sin(angle));\n          this.set(\"y\", dragPoint.y + y * $math.cos(angle) - x * $math.sin(angle));\n          var type = \"dragged\";\n\n          if (events.isEnabled(type)) {\n            events.dispatch(type, {\n              type: type,\n              target: this,\n              originalEvent: e.originalEvent,\n              point: e.point,\n              simulated: e.simulated\n            });\n          }\n        } else {\n          if (Math.hypot(x, y) > 5) {\n            this._isDragging = true;\n            this._dragEvent = e;\n            this._dragPoint = {\n              x: this.x(),\n              y: this.y()\n            };\n            var type = \"dragstart\";\n\n            if (events.isEnabled(type)) {\n              events.dispatch(type, {\n                type: type,\n                target: this,\n                originalEvent: e.originalEvent,\n                point: e.point,\n                simulated: e.simulated\n              });\n            }\n          }\n        }\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_updateSize\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {}\n  });\n  Object.defineProperty(Sprite.prototype, \"_getBounds\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      this._localBounds = this._display.getLocalBounds();\n    }\n  });\n  /**\r\n   * Returns depth (how deep in the hierachy of the content tree) of this\r\n   * element.\r\n   *\r\n   * @return Depth\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"depth\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var self = this.parent;\n      var depth = 0;\n\n      while (true) {\n        if (self) {\n          ++depth;\n          self = self.parent;\n        } else {\n          return depth;\n        }\n      }\n    }\n  });\n  /**\r\n   * @ignore\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"markDirtySize\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      this._sizeDirty = true;\n      this.markDirty();\n    }\n  });\n  /**\r\n   * @ignore\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"markDirtyBounds\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var display = this._display;\n\n      if (this.get(\"isMeasured\")) {\n        this._root._addDirtyBounds(this);\n\n        display.isMeasured = true;\n        display.invalidateBounds();\n        var parent_4 = this.parent;\n\n        if (parent_4 && this.get(\"position\") != \"absolute\") {\n          if (parent_4.get(\"width\") == null || parent_4.get(\"height\") == null || parent_4.get(\"layout\")) {\n            parent_4.markDirtyBounds();\n          }\n        }\n\n        if (this.get(\"focusable\") && this.isFocus()) {\n          this.markDirtyAccessibility();\n        }\n      }\n    }\n  });\n  /**\r\n   * @ignore\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"markDirtyAccessibility\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      //if (this._root.focused(this)) {\n      this._root._invalidateAccessibility(this); //}\n\n    }\n  });\n  /**\r\n   * @ignore\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"markDirtyLayer\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      //this._display.markDirtyLayer(this.isDirty(\"opacity\") || this.isDirty(\"visible\")); https://codepen.io/team/amcharts/pen/gOWZPmP <- problems\n      this._display.markDirtyLayer(true);\n    }\n  });\n  /**\r\n   * @ignore\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"markDirty\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      _super.prototype.markDirty.call(this);\n\n      this.markDirtyLayer();\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_updateBounds\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var oldBounds = this._adjustedLocalBounds;\n      var newBounds; // if display.visible == false, it still returns bounds\n\n      if (!this.get(\"visible\") || !this.getPrivate(\"visible\") || this.get(\"forceHidden\")) {\n        newBounds = {\n          left: 0,\n          right: 0,\n          top: 0,\n          bottom: 0\n        };\n        this._localBounds = newBounds;\n        this._adjustedLocalBounds = newBounds;\n      } else {\n        this._getBounds();\n\n        this._fixMinBounds(this._localBounds);\n\n        this.updatePivotPoint();\n        this._adjustedLocalBounds = this._display.getAdjustedBounds(this._localBounds);\n        newBounds = this._adjustedLocalBounds;\n      }\n\n      if (!oldBounds || oldBounds.left !== newBounds.left || oldBounds.top !== newBounds.top || oldBounds.right !== newBounds.right || oldBounds.bottom !== newBounds.bottom) {\n        var eventType = \"boundschanged\";\n\n        if (this.events.isEnabled(eventType)) {\n          this.events.dispatch(eventType, {\n            type: eventType,\n            target: this\n          });\n        }\n\n        if (this.parent) {\n          this.parent.markDirty();\n          this.parent.markDirtyBounds();\n        }\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_fixMinBounds\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (bounds) {\n      var minWidth = this.get(\"minWidth\");\n      var minHeight = this.get(\"minHeight\");\n\n      if ($type.isNumber(minWidth)) {\n        if (bounds.right - bounds.left < minWidth) {\n          bounds.right = bounds.left + minWidth;\n        }\n      }\n\n      if ($type.isNumber(minHeight)) {\n        if (bounds.bottom - bounds.top < minHeight) {\n          bounds.bottom = bounds.top + minHeight;\n        }\n      }\n\n      var privateWidth = this.getPrivate(\"width\");\n      var privateHeight = this.getPrivate(\"height\");\n\n      if ($type.isNumber(privateWidth)) {\n        bounds.right = bounds.left + privateWidth;\n      }\n\n      if ($type.isNumber(privateHeight)) {\n        bounds.bottom = bounds.top + privateHeight;\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_removeParent\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (parent) {\n      if (parent) {\n        parent.children.removeValue(this);\n        $array.removeFirst(parent._percentageSizeChildren, this);\n        $array.removeFirst(parent._percentagePositionChildren, this);\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_clearDirty\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      _super.prototype._clearDirty.call(this);\n\n      this._sizeDirty = false;\n      this._statesHandled = false;\n    }\n  });\n  /**\r\n   * Simulate hover over element.\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"hover\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      this.showTooltip();\n\n      this._handleOver();\n    }\n  });\n  /**\r\n   * Simulate unhover over element.\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"unhover\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      this.hideTooltip();\n\n      this._handleOut();\n    }\n  });\n  /**\r\n   * Shows element's [[Tooltip]].\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"showTooltip\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (point) {\n      var tooltip = this.getTooltip();\n      var tooltipText = this.get(\"tooltipText\");\n\n      if (tooltipText && tooltip) {\n        var tooltipPosition = this.get(\"tooltipPosition\");\n        var tooltipTarget = this.getPrivate(\"tooltipTarget\", this);\n\n        if (tooltipPosition == \"fixed\" || !point) {\n          this._display._setMatrix();\n\n          point = this.toGlobal(tooltipTarget._getTooltipPoint());\n        }\n\n        tooltip.set(\"pointTo\", point);\n        tooltip.set(\"tooltipTarget\", tooltipTarget);\n\n        if (!tooltip.get(\"x\")) {\n          tooltip.set(\"x\", point.x);\n        }\n\n        if (!tooltip.get(\"y\")) {\n          tooltip.set(\"y\", point.y);\n        }\n\n        tooltip.label.set(\"text\", tooltipText);\n        var dataItem = this.dataItem;\n\n        if (dataItem) {\n          tooltip.label._setDataItem(dataItem);\n        }\n\n        if (this.get(\"showTooltipOn\") == \"always\" && (point.x < 0 || point.x > this._root.width() || point.y < 0 || point.y > this._root.height())) {\n          this.hideTooltip();\n          return;\n        }\n\n        tooltip.label.text.markDirtyText();\n        var promise = tooltip.show();\n        this.setPrivateRaw(\"showingTooltip\", true);\n        return promise;\n      }\n    }\n  });\n  /**\r\n   * Hides element's [[Tooltip]].\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"hideTooltip\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var tooltip = this.getTooltip();\n\n      if (tooltip) {\n        var promise = tooltip.hide();\n        this.setPrivateRaw(\"showingTooltip\", false);\n        return promise;\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_getTooltipPoint\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var bounds = this._localBounds;\n\n      if (bounds) {\n        var x = 0;\n        var y = 0;\n\n        if (!this.get(\"isMeasured\")) {\n          x = $utils.relativeToValue(this.get(\"tooltipX\", 0), this.width());\n          y = $utils.relativeToValue(this.get(\"tooltipY\", 0), this.height());\n        } else {\n          x = bounds.left + $utils.relativeToValue(this.get(\"tooltipX\", 0), bounds.right - bounds.left);\n          y = bounds.top + $utils.relativeToValue(this.get(\"tooltipY\", 0), bounds.bottom - bounds.top);\n        }\n\n        return {\n          x: x,\n          y: y\n        };\n      }\n\n      return {\n        x: 0,\n        y: 0\n      };\n    }\n  });\n  /**\r\n   * Returns [[Tooltip]] used for this element.\r\n   *\r\n   * @return Tooltip\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"getTooltip\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var tooltip = this.get(\"tooltip\");\n\n      if (!tooltip) {\n        var parent_5 = this.parent;\n\n        if (parent_5) {\n          return parent_5.getTooltip();\n        }\n      } else {\n        return tooltip;\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_updatePosition\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var parent = this.parent;\n      var dx = this.get(\"dx\", 0);\n      var dy = this.get(\"dy\", 0);\n      var x = this.get(\"x\");\n\n      var _x = this.getPrivate(\"x\");\n\n      var xx = 0;\n      var yy = 0;\n      var position = this.get(\"position\");\n\n      if (x instanceof Percent) {\n        if (parent) {\n          x = parent.innerWidth() * x.value + parent.get(\"paddingLeft\", 0);\n        } else {\n          x = 0;\n        }\n      }\n\n      if ($type.isNumber(x)) {\n        xx = x + dx;\n      } else {\n        if (_x != null) {\n          xx = _x;\n        } else if (parent) {\n          if (position == \"relative\") {\n            xx = parent.get(\"paddingLeft\", 0) + dx;\n          }\n        }\n      }\n\n      var y = this.get(\"y\");\n\n      var _y = this.getPrivate(\"y\");\n\n      if (y instanceof Percent) {\n        if (parent) {\n          y = parent.innerHeight() * y.value + parent.get(\"paddingTop\", 0);\n        } else {\n          y = 0;\n        }\n      }\n\n      if ($type.isNumber(y)) {\n        yy = y + dy;\n      } else {\n        if (_y != null) {\n          yy = _y;\n        } else if (parent) {\n          if (position == \"relative\") {\n            yy = parent.get(\"paddingTop\", 0) + dy;\n          }\n        }\n      }\n\n      var display = this._display;\n\n      if (display.x != xx || display.y != yy) {\n        display.invalidateBounds();\n        display.x = xx;\n        display.y = yy;\n        var eventType = \"positionchanged\";\n\n        if (this.events.isEnabled(eventType)) {\n          this.events.dispatch(eventType, {\n            type: eventType,\n            target: this\n          });\n        }\n      } // Update tooltip position together with the Sprite\n\n\n      if (this.getPrivate(\"showingTooltip\")) {\n        this.showTooltip();\n      }\n    }\n  });\n  /**\r\n   * Returns element's actual X position in pixels.\r\n   *\r\n   * @return X (px)\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"x\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var x = this.get(\"x\");\n\n      var _x = this.getPrivate(\"x\");\n\n      var parent = this.parent;\n\n      if (parent) {\n        if (x instanceof Percent) {\n          return $utils.relativeToValue(x, parent.innerWidth()) + parent.get(\"paddingLeft\", 0);\n        } else {\n          if (!$type.isNumber(x)) {\n            if (_x != null) {\n              return _x;\n            } else {\n              return parent.get(\"paddingLeft\", this._display.x);\n            }\n          } else {\n            return x;\n          }\n        }\n      }\n\n      return this._display.x;\n    }\n  });\n  /**\r\n   * Returns element's actual Y position in pixels.\r\n   *\r\n   * @return Y (px)\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"y\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var _y = this.getPrivate(\"y\");\n\n      if (_y != null) {\n        return _y;\n      }\n\n      var y = this.get(\"y\");\n      var parent = this.parent;\n\n      if (parent) {\n        if (y instanceof Percent) {\n          return $utils.relativeToValue(y, parent.innerHeight()) + parent.get(\"paddingTop\", 0);\n        } else {\n          if (!$type.isNumber(y)) {\n            if (_y != null) {\n              return _y;\n            } else {\n              return parent.get(\"paddingTop\", this._display.y);\n            }\n          } else {\n            return y;\n          }\n        }\n      }\n\n      return this._display.y;\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_dispose\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      _super.prototype._dispose.call(this);\n\n      this._display.dispose();\n\n      this._removeTemplateField();\n\n      this._removeParent(this.parent);\n\n      this._root._removeFocusElement(this);\n\n      var tooltip = this.get(\"tooltip\");\n\n      if (tooltip) {\n        tooltip.dispose();\n      }\n\n      this.markDirty();\n    }\n  });\n  /**\r\n   * @ignore\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"adjustedLocalBounds\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      this._fixMinBounds(this._adjustedLocalBounds);\n\n      return this._adjustedLocalBounds;\n    }\n  });\n  /**\r\n   * Returns local coordinates of the element's bounds.\r\n   *\r\n   * @ignore\r\n   * @return Global bounds\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"localBounds\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return this._localBounds;\n    }\n  });\n  /**\r\n   * Returns adjusted local coordinates of the element's bounds.\r\n   *\r\n   * @ignore\r\n   * @return Global bounds\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"bounds\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var bounds = this._adjustedLocalBounds;\n      var x = this.x();\n      var y = this.y();\n      return {\n        left: bounds.left + x,\n        right: bounds.right + x,\n        top: bounds.top + y,\n        bottom: bounds.bottom + y\n      };\n    }\n  });\n  /**\r\n   * Returns global coordinates of the element's bounds.\r\n   *\r\n   * @ignore\r\n   * @return Global bounds\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"globalBounds\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var bounds = this.localBounds();\n      var p0 = this.toGlobal({\n        x: bounds.left,\n        y: bounds.top\n      });\n      var p1 = this.toGlobal({\n        x: bounds.right,\n        y: bounds.top\n      });\n      var p2 = this.toGlobal({\n        x: bounds.right,\n        y: bounds.bottom\n      });\n      var p3 = this.toGlobal({\n        x: bounds.left,\n        y: bounds.bottom\n      });\n      return {\n        left: Math.min(p0.x, p1.x, p2.x, p3.x),\n        top: Math.min(p0.y, p1.y, p2.y, p3.y),\n        right: Math.max(p0.x, p1.x, p2.x, p3.x),\n        bottom: Math.max(p0.y, p1.y, p2.y, p3.y)\n      };\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_onShow\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (_duration) {}\n  });\n  Object.defineProperty(Sprite.prototype, \"_onHide\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (_duration) {}\n  });\n  /**\r\n   * Plays initial reveal animation regardless if element is currently hidden\r\n   * or visible.\r\n   *\r\n   * @param   duration  Duration of the animation in milliseconds\r\n   * @param   delay     Delay showing of the element by X milliseconds\r\n   * @return            Promise\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"appear\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (duration, delay) {\n      return __awaiter(this, void 0, void 0, function () {\n        var _this = this;\n\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              return [4\n              /*yield*/\n              , this.hide(0)];\n\n            case 1:\n              _a.sent();\n\n              if (delay) {\n                return [2\n                /*return*/\n                , new Promise(function (success, _error) {\n                  _this.setTimeout(function () {\n                    success(_this.show(duration));\n                  }, delay);\n                })];\n              } else {\n                return [2\n                /*return*/\n                , this.show(duration)];\n              }\n\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    }\n  });\n  /**\r\n   * Shows currently hidden element and returns a `Promise` which completes\r\n   * when all showing animations are finished.\r\n   *\r\n   * ```TypeScript\r\n   * series.show().then(function(ev) {\r\n   *   console.log(\"Series is now fully visible\");\r\n   * })\r\n   * ```\r\n   * ```JavaScript\r\n   * series.show().then(function(ev) {\r\n   *   console.log(\"Series is now fully visible\");\r\n   * })\r\n   * ```\r\n   *\r\n   * @return Promise\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"show\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (duration) {\n      return __awaiter(this, void 0, void 0, function () {\n        var animations;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (!!this._isShowing) return [3\n              /*break*/\n              , 2];\n              this._isHidden = false;\n              this._isShowing = true;\n              this._isHiding = false;\n\n              if (this.states.lookup(\"default\").get(\"visible\")) {\n                this.set(\"visible\", true);\n              }\n\n              this._onShow(duration);\n\n              animations = this.states.applyAnimate(\"default\", duration);\n              return [4\n              /*yield*/\n              , waitForAnimations(animations)];\n\n            case 1:\n              _a.sent();\n\n              this._isShowing = false;\n              _a.label = 2;\n\n            case 2:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    }\n  });\n  /**\r\n   * Hides the element and returns a `Promise` which completes when all hiding\r\n   * animations are finished.\r\n   *\r\n   * ```TypeScript\r\n   * series.hide().then(function(ev) {\r\n   *   console.log(\"Series finished hiding\");\r\n   * })\r\n   * ```\r\n   * ```JavaScript\r\n   * series.hide().then(function(ev) {\r\n   *   console.log(\"Series finished hiding\");\r\n   * })\r\n   * ```\r\n   *\r\n   * @return Promise\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"hide\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (duration) {\n      return __awaiter(this, void 0, void 0, function () {\n        var state, animations;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (!(!this._isHiding && !this._isHidden)) return [3\n              /*break*/\n              , 2];\n              this._isHiding = true;\n              this._isShowing = false;\n              state = this.states.lookup(\"hidden\");\n\n              if (!state) {\n                state = this.states.create(\"hidden\", {\n                  \"opacity\": 0,\n                  \"visible\": false\n                });\n              }\n\n              this._isHidden = true;\n\n              this._onHide(duration);\n\n              animations = this.states.applyAnimate(\"hidden\", duration);\n              return [4\n              /*yield*/\n              , waitForAnimations(animations)];\n\n            case 1:\n              _a.sent();\n\n              this._isHiding = false;\n              _a.label = 2;\n\n            case 2:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    }\n  });\n  /**\r\n   * Returns `true` if this element is currently hidden.\r\n   *\r\n   * @return Is hidden?\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"isHidden\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return this._isHidden;\n    }\n  });\n  /**\r\n   * Returns `true` if this element is currently animating to a default state.\r\n   *\r\n   * @return Is showing?\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"isShowing\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return this._isShowing;\n    }\n  });\n  /**\r\n   * Returns `true` if this element is currently animating to a hidden state.\r\n   *\r\n   * @return Is hiding?\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"isHiding\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return this._isHiding;\n    }\n  });\n  /**\r\n   * Returns `true` if this element is currently hovered by a pointer.\r\n   *\r\n   * @return Is hovered?\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"isHover\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return this._display.hovering();\n    }\n  });\n  /**\r\n   * Returns `true` if this element does currently have focus.\r\n   *\r\n   * @return Is focused?\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"isFocus\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return this._root.focused(this);\n    }\n  });\n  /**\r\n   * Returns `true` if this element is currently being dragged.\r\n   *\r\n   * @return Is dragged?\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"isDragging\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return this._isDragging;\n    }\n  });\n  /**\r\n   * Returns `false` if if either public or private setting `visible` is set\r\n   * to `false`, or `forceHidden` is set to `true`.\r\n   *\r\n   * @return Visible?\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"isVisible\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      if (this.get(\"visible\") && this.getPrivate(\"visible\") && !this.get(\"forceHidden\")) {\n        return true;\n      }\n\n      return false;\n    }\n  });\n  /**\r\n   * Same as `isVisible()`, except it checks all ascendants, too.\r\n   *\r\n   * @since 5.2.7\r\n   * @return Visible?\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"isVisibleDeep\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return this._parent ? this._parent.isVisibleDeep() && this.isVisible() : this.isVisible();\n    }\n  });\n  /**\r\n   * Returns width of this element in pixels.\r\n   *\r\n   * @return Width (px)\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"width\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var width = this.get(\"width\");\n      var maxWidth = this.get(\"maxWidth\");\n      var minWidth = this.get(\"minWidth\");\n      var privateWidth = this.getPrivate(\"width\");\n      var w = 0;\n\n      if ($type.isNumber(privateWidth)) {\n        w = privateWidth;\n      } else {\n        if (width == null) {\n          if (this._adjustedLocalBounds) {\n            w = this._adjustedLocalBounds.right - this._adjustedLocalBounds.left;\n          }\n        } else {\n          if (width instanceof Percent) {\n            var parent_6 = this.parent;\n\n            if (parent_6) {\n              w = parent_6.innerWidth() * width.value;\n            } else {\n              w = this._root.width() * width.value;\n            }\n          } else if ($type.isNumber(width)) {\n            w = width;\n          }\n        }\n      }\n\n      if ($type.isNumber(minWidth)) {\n        w = Math.max(minWidth, w);\n      }\n\n      if ($type.isNumber(maxWidth)) {\n        w = Math.min(maxWidth, w);\n      }\n\n      return w;\n    }\n  });\n  /**\r\n   * Returns maximum allowed width of this element in pixels.\r\n   *\r\n   * @return Maximum width (px)\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"maxWidth\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var maxWidth = this.get(\"maxWidth\");\n\n      if ($type.isNumber(maxWidth)) {\n        return maxWidth;\n      } else {\n        var width = this.get(\"width\");\n\n        if ($type.isNumber(width)) {\n          return width;\n        }\n      }\n\n      var parent = this.parent;\n\n      if (parent) {\n        return parent.innerWidth();\n      }\n\n      return this._root.width();\n    }\n  });\n  /**\r\n   * Returns maximum allowed height of this element in pixels.\r\n   *\r\n   * @return Maximum height (px)\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"maxHeight\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var maxHeight = this.get(\"maxHeight\");\n\n      if ($type.isNumber(maxHeight)) {\n        return maxHeight;\n      } else {\n        var height = this.get(\"height\");\n\n        if ($type.isNumber(height)) {\n          return height;\n        }\n      }\n\n      var parent = this.parent;\n\n      if (parent) {\n        return parent.innerHeight();\n      }\n\n      return this._root.height();\n    }\n  });\n  /**\r\n   * Returns height of this element in pixels.\r\n   *\r\n   * @return Height (px)\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"height\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var height = this.get(\"height\");\n      var maxHeight = this.get(\"maxHeight\");\n      var minHeight = this.get(\"minHeight\");\n      var privateHeight = this.getPrivate(\"height\");\n      var h = 0;\n\n      if ($type.isNumber(privateHeight)) {\n        h = privateHeight;\n      } else {\n        if (height == null) {\n          if (this._adjustedLocalBounds) {\n            h = this._adjustedLocalBounds.bottom - this._adjustedLocalBounds.top;\n          }\n        } else {\n          if (height instanceof Percent) {\n            var parent_7 = this.parent;\n\n            if (parent_7) {\n              h = parent_7.innerHeight() * height.value;\n            } else {\n              h = this._root.height() * height.value;\n            }\n          } else if ($type.isNumber(height)) {\n            h = height;\n          }\n        }\n      }\n\n      if ($type.isNumber(minHeight)) {\n        h = Math.max(minHeight, h);\n      }\n\n      if ($type.isNumber(maxHeight)) {\n        h = Math.min(maxHeight, h);\n      }\n\n      return h;\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_findStaticTemplate\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (f) {\n      // templateField overrides template\n      if (this._templateField && f(this._templateField)) {\n        return this._templateField;\n      }\n\n      return _super.prototype._findStaticTemplate.call(this, f);\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_walkParents\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (f) {\n      if (this._parent) {\n        this._walkParent(f);\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_walkParent\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (f) {\n      if (this._parent) {\n        this._parent._walkParent(f);\n      }\n\n      f(this);\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"parent\", {\n    /**\r\n     * Parent [[Container]] of this element.\r\n     *\r\n     * @return Parent container\r\n     */\n    get: function () {\n      return this._parent;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Sprite.prototype, \"_setParent\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (parent, updateChildren) {\n      if (updateChildren === void 0) {\n        updateChildren = false;\n      }\n\n      var prevParent = this._parent;\n\n      if (parent !== prevParent) {\n        this.markDirtyBounds();\n        parent.markDirty();\n        this._parent = parent;\n\n        if (updateChildren) {\n          this._removeParent(prevParent);\n\n          if (parent) {\n            this._addPercentageSizeChildren();\n\n            this._addPercentagePositionChildren();\n          }\n        }\n\n        this.markDirtyPosition();\n\n        this._applyThemes();\n      }\n    }\n  });\n  /**\r\n   * Returns an instance of [[NumberFormatter]] used in this element.\r\n   *\r\n   * If this element does not have it set, global one form [[Root]] is used.\r\n   *\r\n   * @see {@link https://www.amcharts.com/docs/v5/concepts/using-formatters/} for more info\r\n   * @return NumberFormatter instace\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"getNumberFormatter\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return this.get(\"numberFormatter\", this._root.numberFormatter);\n    }\n  });\n  /**\r\n   * Returns an instance of [[DateFormatter]] used in this element.\r\n   *\r\n   * If this element does not have it set, global one form [[Root]] is used.\r\n   *\r\n   * @see {@link https://www.amcharts.com/docs/v5/concepts/using-formatters/} for more info\r\n   * @return DateFormatter instace\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"getDateFormatter\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return this.get(\"dateFormatter\", this._root.dateFormatter);\n    }\n  });\n  /**\r\n   * Returns an instance of [[DurationFormatter]] used in this element.\r\n   *\r\n   * If this element does not have it set, global one form [[Root]] is used.\r\n   *\r\n   * @see {@link https://www.amcharts.com/docs/v5/concepts/using-formatters/} for more info\r\n   * @return DurationFormatter instace\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"getDurationFormatter\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return this.get(\"durationFormatter\", this._root.durationFormatter);\n    }\n  });\n  /**\r\n   * Converts X/Y coordinate within this element to a global coordinate.\r\n   *\r\n   * @param  point  Local coordinate\r\n   * @return        Global coordinate\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"toGlobal\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (point) {\n      return this._display.toGlobal(point);\n    }\n  });\n  /**\r\n   * Converts global X/Y coordinate to a coordinate within this element.\r\n   *\r\n   * @param  point  Global coordinate\r\n   * @return        Local coordinate\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"toLocal\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (point) {\n      return this._display.toLocal(point);\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_getDownPoint\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var id = this._getDownPointId();\n\n      if (id) {\n        return this._downPoints[id];\n      }\n    }\n  });\n  Object.defineProperty(Sprite.prototype, \"_getDownPointId\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      if (this._downPoints) {\n        return $object.keysOrdered(this._downPoints, function (a, b) {\n          if (a > b) {\n            return 1;\n          }\n\n          if (a < b) {\n            return -1;\n          }\n\n          return 0;\n        })[0];\n      }\n    }\n  });\n  /**\r\n   * Moves sprite to the end of the parent's children array.\r\n   *\r\n   * Depending on `layout` setting of the parten container, it may effect the\r\n   * positioning or overlapping order of the elements.\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"toFront\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var parent = this.parent;\n\n      if (parent) {\n        parent.children.moveValue(this, parent.children.length - 1);\n      }\n    }\n  });\n  /**\r\n   * Moves sprite to the beginning of the parent's children array.\r\n   *\r\n   * Depending on `layout` setting of the parten container, it may effect the\r\n   * positioning or overlapping order of the elements.\r\n   */\n\n  Object.defineProperty(Sprite.prototype, \"toBack\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var parent = this.parent;\n\n      if (parent) {\n        parent.children.moveValue(this, 0);\n      }\n    }\n  });\n  Object.defineProperty(Sprite, \"className\", {\n    enumerable: true,\n    configurable: true,\n    writable: true,\n    value: \"Sprite\"\n  });\n  Object.defineProperty(Sprite, \"classNames\", {\n    enumerable: true,\n    configurable: true,\n    writable: true,\n    value: Entity.classNames.concat([Sprite.className])\n  });\n  return Sprite;\n}(Entity);\n\nexport { Sprite };","map":{"version":3,"mappings":"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","names":["Entity","Template","Percent","EventDispatcher","MultiDisposer","CounterDisposer","waitForAnimations","$utils","$array","$type","$object","$math","__extends","sprite","_super","Object","_this","_sprite","key","event","type","originalEvent","point","simulated","native","target","dispatch","set","_display","interactive","events","_rendererDisposers","undefined","disposer_1","on","e","call","dispose","increment","once","callback","context","shouldClone","info","_on","rendererEvent","SpriteEventDispatcher","RENDERER_EVENTS","disposer","_onRenderer","_dispatchParents","old","parent","dispatchParents","isEnabled","isDragging","_hasDown","_hasMoved","_makePointerEvent","left","right","top","bottom","setPrivateRaw","_afterNew","_markDirtyKey","markDirtyBounds","_addPercentagePositionChildren","markDirtyPosition","_markDirtyPrivateKey","_templateField","_removeObjectTemplate","template","field","get","dataItem","dataContext","new","_removeTemplateField","_setObjectTemplate","_applyTemplates","oldDataItem","_dataItem","_processTemplateField","eventType","newDataItem","Sprite","parent_1","_parent","value","_setDataItem","pushOne","_percentageSizeChildren","removeFirst","_percentagePositionChildren","_root","_addDirtyPosition","bounds","_localBounds","centerX","pivot","x","relativeToValue","centerY","y","_beforeChanged","_handleStates","isDirty","previous","_prevSettings","tooltip","setLayer","markDirtyLayer","tooltipMoveDp","_tooltipMoveDp","tooltipPointerDp","_tooltipPointerDp","showTooltip","_statesHandled","states","applyAnimate","isHidden","markDirtyAccessibility","_changed","display","draggable","_dragDp","ev","dragStart","dragMove","dragStop","tooltipText","_tooltipDp","hideTooltip","toggleKey_1","_toggleDp","_isDragging","alpha","Math","max","angle","scale","updatePivotPoint","isPrivateDirty","getPrivate","visible","_addPercentageSizeChildren","parent_2","markDirty","_prevWidth","_sizeDirty","_updateSize","wheelable","_registerTabindexOrder","_unregisterTabindexOrder","filter","cursorOverStyle","_focusDp","exportable","events_1","_hoverDp","isTouchEvent","setTimeout","_handleOver","_handleOut","_isDown","_handleUp","_handleDown","inactive","_dragEvent","stopParentDispatch","_dragPoint","lookup","isHover","_downPoint","pointerId","getPointerId","_downPoints","keys","length","downPoint","abs","dragEvent","parent_3","dragPoint","cos","sin","hypot","getLocalBounds","self","depth","_addDirtyBounds","isMeasured","invalidateBounds","parent_4","isFocus","_invalidateAccessibility","oldBounds","_adjustedLocalBounds","newBounds","_getBounds","_fixMinBounds","getAdjustedBounds","minWidth","minHeight","isNumber","privateWidth","privateHeight","children","removeValue","_clearDirty","getTooltip","tooltipPosition","tooltipTarget","_setMatrix","toGlobal","_getTooltipPoint","label","width","height","text","markDirtyText","promise","show","hide","parent_5","dx","dy","_x","xx","yy","position","innerWidth","_y","innerHeight","_dispose","_removeParent","_removeFocusElement","localBounds","p0","p1","p2","p3","min","_duration","duration","delay","_a","Promise","success","_error","_isShowing","_isHidden","_isHiding","_onShow","animations","state","create","_onHide","hovering","focused","isVisibleDeep","isVisible","maxWidth","w","parent_6","maxHeight","h","parent_7","f","_findStaticTemplate","_walkParent","updateChildren","prevParent","_applyThemes","numberFormatter","dateFormatter","durationFormatter","toLocal","id","_getDownPointId","keysOrdered","a","b","moveValue","classNames","concat","className"],"sourceRoot":"","sources":["../../../../../src/.internal/core/render/Sprite.ts"],"sourcesContent":["import type { IDisplayObject, IRendererEvents, IRendererEvent, IPointerEvent } from \"./backend/Renderer\";\nimport type { IBounds } from \"../util/IBounds\";\nimport type { Container } from \"./Container\";\nimport type { IAccessibilitySettings } from \"../util/Accessibility\";\nimport type { NumberFormatter } from \"../util/NumberFormatter\";\nimport type { DateFormatter } from \"../util/DateFormatter\";\nimport type { DurationFormatter } from \"../util/DurationFormatter\";\nimport type { DataItem, IComponentDataItem } from \"./Component\";\nimport type { Graphics } from \"./Graphics\";\nimport type { IPoint } from \"../util/IPoint\";\nimport type { ListTemplate } from \"../util/List\";\n\nimport type { Tooltip } from \"./Tooltip\";\nimport { Entity, IEntitySettings, IEntityPrivate, IEntityEvents } from \"../util/Entity\";\nimport { Template } from \"../util/Template\";\nimport { Percent } from \"../util/Percent\";\nimport { EventDispatcher, Events, EventListener } from \"../util/EventDispatcher\";\nimport { IDisposer, MultiDisposer, CounterDisposer } from \"../util/Disposer\";\nimport { waitForAnimations } from \"../util/Animation\";\n\nimport * as $utils from \"../util/Utils\";\nimport * as $array from \"../util/Array\";\nimport * as $type from \"../util/Type\";\nimport * as $object from \"../util/Object\";\nimport * as $math from \"../util/Math\";\n//import { populateString } from \"../util/PopulateString\";\n\n\n/**\n * An [[EventDispatcher]] for [[Sprite]].\n *\n * @see {@link https://www.amcharts.com/docs/v5/concepts/events/} for more info\n */\nclass SpriteEventDispatcher<Target, E extends Events<Target, ISpriteEvents>> extends EventDispatcher<E> {\n\tprotected static RENDERER_EVENTS: { [K in keyof IRendererEvents]?: <E extends Events<Sprite, ISpriteEvents>>(this: SpriteEventDispatcher<Sprite, E>, event: IRendererEvents[K]) => void } = {\n\t\t\"click\": function(event) {\n\t\t\tif (this.isEnabled(\"click\") && !this._sprite.isDragging() && this._sprite._hasDown() && !this._sprite._hasMoved(this._makePointerEvent(\"click\", event))) {\n\t\t\t\tthis.dispatch(\"click\", this._makePointerEvent(\"click\", event));\n\t\t\t}\n\t\t},\n\n\t\t\"rightclick\": function(event) {\n\t\t\tif (this.isEnabled(\"rightclick\")) {\n\t\t\t\tthis.dispatch(\"rightclick\", this._makePointerEvent(\"rightclick\", event));\n\t\t\t}\n\t\t},\n\n\t\t\"middleclick\": function(event) {\n\t\t\tif (this.isEnabled(\"middleclick\")) {\n\t\t\t\tthis.dispatch(\"middleclick\", this._makePointerEvent(\"middleclick\", event));\n\t\t\t}\n\t\t},\n\n\t\t\"dblclick\": function(event) {\n\t\t\tthis.dispatchParents(\"dblclick\", this._makePointerEvent(\"dblclick\", event));\n\t\t},\n\n\t\t\"pointerover\": function(event) {\n\t\t\tif (this.isEnabled(\"pointerover\")) {\n\t\t\t\tthis.dispatch(\"pointerover\", this._makePointerEvent(\"pointerover\", event));\n\t\t\t}\n\t\t},\n\n\t\t\"pointerout\": function(event) {\n\t\t\tif (this.isEnabled(\"pointerout\")) {\n\t\t\t\tthis.dispatch(\"pointerout\", this._makePointerEvent(\"pointerout\", event));\n\t\t\t}\n\t\t},\n\n\t\t\"pointerdown\": function(event) {\n\t\t\tthis.dispatchParents(\"pointerdown\", this._makePointerEvent(\"pointerdown\", event));\n\t\t},\n\n\t\t\"pointerup\": function(event) {\n\t\t\tif (this.isEnabled(\"pointerup\")) {\n\t\t\t\tthis.dispatch(\"pointerup\", this._makePointerEvent(\"pointerup\", event));\n\t\t\t}\n\t\t},\n\n\t\t\"globalpointerup\": function(event) {\n\t\t\tif (this.isEnabled(\"globalpointerup\")) {\n\t\t\t\tthis.dispatch(\"globalpointerup\", this._makePointerEvent(\"globalpointerup\", event));\n\t\t\t}\n\t\t},\n\n\t\t\"globalpointermove\": function(event) {\n\t\t\tif (this.isEnabled(\"globalpointermove\")) {\n\t\t\t\tthis.dispatch(\"globalpointermove\", this._makePointerEvent(\"globalpointermove\", event));\n\t\t\t}\n\t\t},\n\n\t\t\"wheel\": function(event) {\n\t\t\tthis.dispatchParents(\"wheel\", {\n\t\t\t\ttype: \"wheel\",\n\t\t\t\ttarget: this._sprite,\n\t\t\t\toriginalEvent: event.event,\n\t\t\t\tpoint: event.point,\n\t\t\t});\n\t\t},\n\t};\n\n\tprotected _sprite: Sprite;\n\n\tprotected _rendererDisposers: { [K in keyof IRendererEvents]?: CounterDisposer } = {};\n\n\tprotected _dispatchParents: boolean = true;\n\n\tconstructor(sprite: Sprite) {\n\t\tsuper();\n\t\tthis._sprite = sprite;\n\t}\n\n\tprotected _makePointerEvent<K extends keyof E>(key: K, event: IRendererEvent<IPointerEvent>): ISpritePointerEvent & { type: K } {\n\t\treturn {\n\t\t\ttype: key,\n\t\t\toriginalEvent: event.event,\n\t\t\tpoint: event.point,\n\t\t\tsimulated: event.simulated,\n\t\t\tnative: event.native,\n\t\t\ttarget: this._sprite\n\t\t};\n\t}\n\n\tprotected _onRenderer<Key extends keyof IRendererEvents>(key: Key, dispatch: (this: this, event: IRendererEvents[Key]) => void): IDisposer {\n\t\t// TODO: is this OK? it'd be good not to require to set this on each individual element\n\t\tthis._sprite.set(\"interactive\", true);\n\t\tthis._sprite._display.interactive = true;\n\n\t\tlet events = this._rendererDisposers[key];\n\n\t\tif (events === undefined) {\n\t\t\tconst disposer = this._sprite._display.on(key, (e) => {\n\t\t\t\tdispatch.call(this, e);\n\t\t\t});\n\n\t\t\tevents = this._rendererDisposers[key] = new CounterDisposer(() => {\n\t\t\t\tdelete this._rendererDisposers[key];\n\t\t\t\tdisposer.dispose();\n\t\t\t});\n\t\t}\n\n\t\treturn events.increment();\n\t}\n\n\tprotected _on<C, Key extends keyof E>(once: boolean, type: Key | null, callback: any, context: C, shouldClone: boolean, dispatch: (type: Key, event: E[Key]) => void): EventListener {\n\t\tconst info = super._on(once, type, callback, context, shouldClone, dispatch);\n\n\t\tconst rendererEvent = (SpriteEventDispatcher.RENDERER_EVENTS as any)[type];\n\t\tif (rendererEvent !== undefined) {\n\t\t\tinfo.disposer = new MultiDisposer([\n\t\t\t\tinfo.disposer,\n\t\t\t\tthis._onRenderer(type as any, rendererEvent),\n\t\t\t]);\n\t\t}\n\n\t\treturn info;\n\t}\n\n\t/**\n\t * Will stop any bubbling up of the event to element's parents.\n\t *\n\t * Should be called in an event handler, e.g.:\n\t *\n\t * ```TypeScript\n\t * element.events.on(\"pointerdown\", function(ev) {\n\t *   // Do something here and prevent from \"pointerdown\" bubbling up\n\t *   // ...\n\t *   ev.target.events.stopParentDispatch();\n\t * });\n\t * ```\n\t * ```JavaScript\n\t * element.events.on(\"pointerdown\", function(ev) {\n\t *   // Do something here and prevent from \"pointerdown\" bubbling up\n\t *   // ...\n\t *   ev.target.events.stopParentDispatch();\n\t * });\n\t * ```\n\t */\n\tpublic stopParentDispatch() {\n\t\tthis._dispatchParents = false;\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic dispatchParents<Key extends keyof E>(type: Key, event: E[Key]): void {\n\t\tconst old = this._dispatchParents;\n\n\t\tthis._dispatchParents = true;\n\n\t\ttry {\n\t\t\tthis.dispatch(type, event);\n\n\t\t\tif (this._dispatchParents && this._sprite.parent) {\n\t\t\t\tthis._sprite.parent.events.dispatchParents(type as any, event);\n\t\t\t}\n\n\t\t} finally {\n\t\t\tthis._dispatchParents = old;\n\t\t}\n\t}\n}\n\n\nexport interface ISpriteSettings extends IEntitySettings, IAccessibilitySettings {\n\n\t/**\n\t * X position relative to parent.\n\t */\n\tx?: number | Percent | null;\n\n\t/**\n\t * Y position relative to parent.\n\t */\n\ty?: number | Percent | null;\n\n\t/**\n\t * Element's absolute width in pixels (numeric value) or relative width to\n\t * parent ([[Percent]]);\n\t */\n\twidth?: number | Percent | null;\n\n\t/**\n\t * Element's absolute height in pixels (numeric value) or relative height to\n\t * parent ([[Percent]]);\n\t */\n\theight?: number | Percent | null;\n\n\t/**\n\t * Maximum allowed width in pixels.\n\t */\n\tmaxWidth?: number | null;\n\n\t/**\n\t * Maximum allowed height in pixels.\n\t */\n\tmaxHeight?: number | null;\n\n\t/**\n\t * Minimum allowed width in pixels.\n\t */\n\tminWidth?: number | null;\n\n\t/**\n\t * Minimum allowed height in pixels.\n\t */\n\tminHeight?: number | null;\n\n\t/**\n\t * Opacity. 0 - fully transparent; 1 - fully opaque.\n\t */\n\topacity?: number;\n\n\t/**\n\t * Rotation in degrees.\n\t */\n\trotation?: number;\n\n\t/**\n\t * Scale.\n\t *\n\t * Setting to a value less than 1 will shrink object.\n\t */\n\tscale?: number;\n\n\t/**\n\t * X coordinate of the center of the element relative to itself.\n\t *\n\t * Center coordinates will affect placement as well as rotation pivot point.\n\t */\n\tcenterX?: number | Percent;\n\n\t/**\n\t * Y coordinate of the center of the element relative to itself.\n\t *\n\t * Center coordinates will affect placement as well as rotation pivot point.\n\t */\n\tcenterY?: number | Percent;\n\n\t/**\n\t * Left margin in pixels.\n\t */\n\tmarginLeft?: number;\n\n\t/**\n\t * Right margin in pixels.\n\t */\n\tmarginRight?: number;\n\n\t/**\n\t * Top margin in pixels.\n\t */\n\tmarginTop?: number;\n\n\t/**\n\t * Bottom margin in pixels.\n\t */\n\tmarginBottom?: number;\n\n\t/**\n\t * Is element visible?\n\t */\n\tvisible?: boolean;\n\n\t/**\n\t * Positioning of the element.\n\t *\n\t * `\"absolute\"` means element will not participate in parent layout scheme,\n\t * and will be positioned solely accoridng its `x` and `y` settings.\n\t */\n\tposition?: \"absolute\" | \"relative\";\n\n\t/**\n\t * Horizontal shift in pixels. Can be negative to shift leftward.\n\t */\n\tdx?: number;\n\n\t/**\n\t * Vertical shift in pixels. Can be negative to shift upward.\n\t */\n\tdy?: number;\n\n\t/**\n\t * Should this element accept user interaction events?\n\t */\n\tinteractive?: boolean;\n\n\t/**\n\t * Text to show in a tooltip when hovered.\n\t */\n\ttooltipText?: string;\n\n\t/**\n\t * Tooltip pointer X coordinate relative to the element itself.\n\t */\n\ttooltipX?: number | Percent;\n\n\t/**\n\t * Tooltip pointer Y coordinate relative to the element itself.\n\t */\n\ttooltipY?: number | Percent;\n\n\t/**\n\t * [[Tooltip]] instance.\n\t */\n\ttooltip?: Tooltip;\n\n\t/**\n\t * Tooltip position.\n\t */\n\ttooltipPosition?: \"fixed\" | \"pointer\";\n\n\t/**\n\t * If set to `false` element will not be measured and cannot participate in\n\t * layout schemes.\n\t */\n\tisMeasured?: boolean;\n\n\t/**\n\t * Allows binding element's settings to data.\n\t *\n\t * @see {@link https://www.amcharts.com/docs/v5/concepts/settings/template-fields/} for more info\n\t */\n\ttemplateField?: string;\n\n\t/**\n\t * If set to `true`, user will be able to drag this element. It will also\n\t * disable default drag events over the area of this element.\n\t */\n\tdraggable?: boolean;\n\n\t/**\n\t * If set to `true`, mouse wheel events will be triggered over the element. It\n\t * will also disable page scrolling using mouse wheel when pointer is over\n\t * the element.\n\t */\n\twheelable?: boolean;\n\n\t/**\n\t * An instance of [[NumberFormatter]] that should be used instead of global\n\t * formatter object.\n\t *\n\t * @see {@link https://www.amcharts.com/docs/v5/concepts/using-formatters/} for more info\n\t */\n\tnumberFormatter?: NumberFormatter | undefined;\n\n\t/**\n\t * An instance of [[DateFormatter]] that should be used instead of global\n\t * formatter object.\n\t *\n\t * @see {@link https://www.amcharts.com/docs/v5/concepts/using-formatters/} for more info\n\t */\n\tdateFormatter?: DateFormatter | undefined;\n\n\t/**\n\t * An instance of [[DurationFormatter]] that should be used instead of global\n\t * formatter object.\n\t *\n\t * @see {@link https://www.amcharts.com/docs/v5/concepts/using-formatters/} for more info\n\t */\n\tdurationFormatter?: DurationFormatter | undefined;\n\n\t/**\n\t * If set, element will toggle specified boolean setting between `true` and\n\t * `false` when clicked/touched.\n\t */\n\ttoggleKey?: \"disabled\" | \"active\" | \"none\" | undefined;\n\n\t/**\n\t * Indicates if element is currently active.\n\t */\n\tactive?: boolean;\n\n\t/**\n\t * Indicates if element is disabled.\n\t */\n\tdisabled?: boolean;\n\n\t/**\n\t * An SVG filter to apply to the element.\n\t *\n\t * IMPORTANT: SVG filters are not supported in some browsers, e.g. Safari.\n\t *\n\t * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/filter} for more info\n\t * @ignore todo: figure out if we still need this\n\t */\n\tfilter?: string;\n\n\t/**\n\t * A named mouse cursor style to show when hovering this element.\n\t *\n\t * @see {@link https://developer.mozilla.org/en-US/docs/Web/CSS/cursor} for more info\n\t */\n\tcursorOverStyle?: string;\n\n\t/**\n\t * If set to `false` this element will not appear in exported snapshots of\n\t * the chart.\n\t */\n\texportable?: boolean;\n\n\t/**\n\t * Numeric layer to put element in.\n\t *\n\t * Elements with higher number will appear in front of the ones with lower\n\t * numer.\n\t *\n\t * If not set, will inherit layer from its ascendants.\n\t */\n\tlayer?: number;\n\n\t/**\n\t * If set to `true` the element will be hidden regardless of `visible` or\n\t * even if `show()` is called.\n\t */\n\tforceHidden?: boolean;\n\n\t/**\n\t * If set to `true` the element will be inactive - absolutely oblivious\n\t * to all interactions, even if there are related events set, or\n\t * the `interactive: true` is set.\n\t *\n\t * @since 5.0.21\n\t */\n\tforceInactive?: boolean;\n\n\t/**\n\t * Defines when tooltip is shown over the element.\n\t *\n\t * Available options:\n\t * * `\"hover\"` (default) - tooltip is shown when element is hovered by a pointer or touched. It is hidden as soon as element is not hovered anymore, or touch occurs outside it.\n\t * * `\"always\"` - a tooltip will always be shown over the element, without any interactions. Please note that if you need to show tooltips for multiple elements at the same time, you need to explicitly create a `Tooltip` instance and set element's `tooltip` setting with it.\n\t *\n\t * @see {@link https://www.amcharts.com/docs/v5/concepts/common-elements/tooltips/#Sticky_tooltips} for more info\n\t * @default \"hover\"\n\t * @since 5.0.16\n\t */\n\tshowTooltipOn?: \"hover\" | \"always\";\n\n}\n\nexport interface ISpritePrivate extends IEntityPrivate {\n\t/**\n\t * @ignore\n\t */\n\tcustomData?: any;\n\n\t/**\n\t * @ignore\n\t */\n\tx?: number;\n\n\t/**\n\t * @ignore\n\t */\n\ty?: number;\n\n\t/**\n\t * @ignore\n\t */\n\twidth?: number;\n\n\t/**\n\t * @ignore\n\t */\n\theight?: number;\n\n\t/**\n\t * @ignore\n\t */\n\tvisible?: boolean;\n\n\t/**\n\t * Is element currently showing a tooltip?\n\t */\n\tshowingTooltip?: boolean;\n\n\t/**\n\t * @ignore\n\t */\n\ttouchHovering?: boolean;\n\n\t/**\n\t * @ignore\n\t */\n\tfocusElement?: {\n\t\tdom: HTMLDivElement,\n\t\tdisposers: Array<IDisposer>,\n\t};\n\n\t/**\n\t * An element tooltip should inherit its colors from.\n\t */\n\ttooltipTarget?: Graphics;\n\n\t/**\n\t * @ignore\n\t */\n\tlist?: ListTemplate<Sprite>;\n\n}\n\n/**\n * An interface defining event objects that originate from pinter interactions.\n */\nexport interface ISpritePointerEvent {\n\n\t/**\n\t * Original event object that caused the interaction, e.g. [[MouseEvent]].\n\t */\n\toriginalEvent: IPointerEvent;\n\n\t/**\n\t * A point where event originated.\n\t */\n\tpoint: IPoint;\n\n\t/**\n\t * Is it a simulated event, e.g. if the event was generated by code rather\n\t * then actual user interaction.\n\t */\n\tsimulated: boolean;\n\n\t/**\n\t * Whether event originated in chart's container or its children.\n\t */\n\tnative?: boolean;\n\n\t/**\n\t * The element on which the event occurred.\n\t */\n\ttarget: Sprite;\n\n}\n\nexport interface ISpriteEvents extends IEntityEvents {\n\n\t/**\n\t * Invoked when element's data item changes.\n\t */\n\tdataitemchanged: {\n\t\toldDataItem: DataItem<IComponentDataItem> | undefined,\n\t\tnewDataItem: DataItem<IComponentDataItem> | undefined\n\t};\n\n\t/**\n\t * Invoked when element's position (X/Y) changes.\n\t */\n\tpositionchanged: {};\n\n\t/**\n\t * Invoked when element's bounds change due to any manipulation to it.\n\t */\n\tboundschanged: {};\n\n\t/**\n\t * Invoked when element dragging starts.\n\t */\n\tdragstart: ISpritePointerEvent;\n\n\t/**\n\t * Invoked when element dragging stops.\n\t */\n\tdragstop: ISpritePointerEvent;\n\n\t/**\n\t * Invoked when element ois being dragged.\n\t */\n\tdragged: ISpritePointerEvent;\n\n\t/**\n\t * Invoked when element is clicked or tapped.\n\t */\n\tclick: ISpritePointerEvent;\n\n\t/**\n\t * Invoked when element is clicked width the right mouse button.\n\t */\n\trightclick: ISpritePointerEvent;\n\n\t/**\n\t * Invoked when element is clicked with the middle mouse button.\n\t */\n\tmiddleclick: ISpritePointerEvent;\n\n\t/**\n\t * Invoked when element is doubleclicked or tapped twice quickly.\n\t */\n\tdblclick: ISpritePointerEvent;\n\n\t/**\n\t * Invoked when pointer moves over the element.\n\t */\n\tpointerover: ISpritePointerEvent;\n\n\t/**\n\t * Invoked when pointer moves outside the element.\n\t */\n\tpointerout: ISpritePointerEvent;\n\n\t/**\n\t * Invoked when pointer button is pressed or touch starts over the element.\n\t */\n\tpointerdown: ISpritePointerEvent;\n\n\t/**\n\t * Invoked when pointer button is released or touch stops over the element.\n\t */\n\tpointerup: ISpritePointerEvent;\n\n\t/**\n\t * Invoked when pointer button is released or touch stops in the window, even\n\t * outside of the element or even chart area.\n\t */\n\tglobalpointerup: ISpritePointerEvent;\n\n\t/**\n\t * Invoked when pointer is moving anywhere in the window, even outside of the\n\t * element or even chart area.\n\t */\n\tglobalpointermove: ISpritePointerEvent;\n\n\t/**\n\t * Invoked when mouse wheel is spinned while pointer is over the element.\n\t */\n\twheel: {\n\t\toriginalEvent: WheelEvent;\n\t\tpoint: IPoint;\n\t};\n\n\t/**\n\t * Invoked when element gains focus.\n\t */\n\tfocus: {\n\t\toriginalEvent: FocusEvent;\n\t\ttarget: Sprite;\n\t};\n\n\t/**\n\t * Invoked when element loses focus.\n\t */\n\tblur: {\n\t\toriginalEvent: FocusEvent;\n\t\ttarget: Sprite;\n\t};\n\n}\n\n/**\n * A base class for all visual elements.\n *\n * @important\n */\nexport abstract class Sprite extends Entity {\n\tdeclare public _settings: ISpriteSettings;\n\tdeclare public _privateSettings: ISpritePrivate;\n\tdeclare public _events: ISpriteEvents;\n\n\tdeclare public events: SpriteEventDispatcher<this, Events<this, this[\"_events\"]>>;\n\n\tpublic abstract _display: IDisplayObject;\n\n\tprotected _adjustedLocalBounds: IBounds = { left: 0, right: 0, top: 0, bottom: 0 };\n\n\tprotected _localBounds: IBounds = { left: 0, right: 0, top: 0, bottom: 0 };\n\n\tpublic static className: string = \"Sprite\";\n\tpublic static classNames: Array<string> = Entity.classNames.concat([Sprite.className]);\n\n\tpublic _parent: Container | undefined;\n\tprotected _dataItem: DataItem<IComponentDataItem> | undefined;\n\n\tprotected _templateField: Template<this> | undefined;\n\n\tprotected _sizeDirty: boolean = false;\n\n\t// Will be true only when dragging\n\tprotected _isDragging: boolean = false;\n\n\t// The event when the dragging starts\n\tprotected _dragEvent: ISpritePointerEvent | undefined;\n\n\t// The position when dragging starts\n\tprotected _dragPoint: IPoint | undefined;\n\n\tprotected _isHidden: boolean = false;\n\n\tprotected _isShowing: boolean = false;\n\n\tprotected _isHiding: boolean = false;\n\n\tprotected _isDown: boolean = false;\n\tprotected _downPoint: IPoint | undefined;\n\n\tpublic _downPoints: { [index: number]: IPoint } = {};\n\n\tpublic _toggleDp: IDisposer | undefined;\n\n\tprotected _dragDp: MultiDisposer | undefined;\n\n\tprotected _tooltipDp: MultiDisposer | undefined;\n\n\tprotected _hoverDp: MultiDisposer | undefined;\n\n\tprotected _focusDp: MultiDisposer | undefined;\n\n\tprotected _tooltipMoveDp: IDisposer | undefined;\n\n\tprotected _tooltipPointerDp: MultiDisposer | undefined;\n\n\tprotected _statesHandled: boolean = false;\n\n\tprotected _afterNew() {\n\t\tthis.setPrivateRaw(\"visible\", true);\n\t\tsuper._afterNew();\n\t}\n\n\tpublic _markDirtyKey<Key extends keyof this[\"_settings\"]>(key: Key) {\n\t\tsuper._markDirtyKey(key);\n\t\tif (key == \"x\" || key == \"y\" || key == \"dx\" || key == \"dy\") {\n\t\t\tthis.markDirtyBounds();\n\t\t\tthis._addPercentagePositionChildren();\n\t\t\tthis.markDirtyPosition();\n\t\t}\n\t}\n\n\tpublic _markDirtyPrivateKey<Key extends keyof this[\"_privateSettings\"]>(key: Key) {\n\t\tsuper._markDirtyPrivateKey(key);\n\t\tif (key == \"x\" || key == \"y\") {\n\t\t\tthis.markDirtyPosition();\n\t\t}\n\t}\n\n\tprotected _removeTemplateField(): void {\n\t\tif (this._templateField) {\n\t\t\tthis._templateField._removeObjectTemplate(this);\n\t\t}\n\t}\n\n\tprotected _createEvents(): SpriteEventDispatcher<this, Events<this, this[\"_events\"]>> {\n\t\treturn new SpriteEventDispatcher(this);\n\t}\n\n\tpublic _processTemplateField(): void {\n\t\tlet template;\n\n\t\tconst field = this.get(\"templateField\");\n\n\t\tif (field) {\n\t\t\tconst dataItem = this.dataItem;\n\t\t\tif (dataItem) {\n\t\t\t\tconst context = dataItem.dataContext;\n\t\t\t\tif (context) {\n\t\t\t\t\ttemplate = (context as any)[field];\n\n\t\t\t\t\tif (!(template instanceof Template) && template) {\n\t\t\t\t\t\ttemplate = Template.new(template);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this._templateField !== template) {\n\t\t\tthis._removeTemplateField();\n\n\t\t\tthis._templateField = template;\n\n\t\t\tif (template) {\n\t\t\t\ttemplate._setObjectTemplate(this);\n\t\t\t}\n\n\t\t\tthis._applyTemplates();\n\t\t}\n\t}\n\n\t// TODO change this to run before the element is added to the parent, so that way\n\t//      it doesn't need to apply the themes twice\n\tpublic _setDataItem(dataItem?: DataItem<IComponentDataItem>): void {\n\t\tconst oldDataItem = this._dataItem\n\t\tthis._dataItem = dataItem;\n\t\tthis._processTemplateField();\n\t\tconst eventType = \"dataitemchanged\";\n\t\tif (this.events.isEnabled(eventType)) {\n\t\t\tthis.events.dispatch(eventType, {\n\t\t\t\ttype: eventType,\n\t\t\t\ttarget: this,\n\t\t\t\toldDataItem: oldDataItem,\n\t\t\t\tnewDataItem: dataItem\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * A [[DataItem]] used for this element.\n\t *\n\t * NOTE: data item is being assigned automatically in most cases where it\n\t * matters. Use this accessor to set data item only if you know what you're\n\t * doing.\n\t *\n\t * @param  value  Data item\n\t */\n\tpublic set dataItem(value: DataItem<IComponentDataItem> | undefined) {\n\t\tthis._setDataItem(value);\n\t}\n\n\t/**\n\t * @return DataItem\n\t */\n\tpublic get dataItem(): DataItem<IComponentDataItem> | undefined {\n\t\tif (this._dataItem) {\n\t\t\treturn this._dataItem;\n\n\t\t} else {\n\t\t\tlet parent = this._parent;\n\n\t\t\twhile (parent) {\n\t\t\t\tif (parent._dataItem) {\n\t\t\t\t\treturn parent._dataItem;\n\n\t\t\t\t} else {\n\t\t\t\t\tparent = parent._parent;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected _addPercentageSizeChildren() {\n\t\tlet parent = this.parent;\n\t\tif (parent) {\n\t\t\tif (this.get(\"width\") instanceof Percent || this.get(\"height\") instanceof Percent) {\n\t\t\t\t$array.pushOne(parent._percentageSizeChildren, this);\n\t\t\t} else {\n\t\t\t\t$array.removeFirst(parent._percentageSizeChildren, this);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected _addPercentagePositionChildren() {\n\t\tlet parent = this.parent;\n\t\tif (parent) {\n\t\t\tif (this.get(\"x\") instanceof Percent || this.get(\"y\") instanceof Percent) {\n\t\t\t\t$array.pushOne(parent._percentagePositionChildren, this);\n\t\t\t} else {\n\t\t\t\t$array.removeFirst(parent._percentagePositionChildren, this);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic markDirtyPosition() {\n\t\tthis._root._addDirtyPosition(this);\n\t}\n\n\tprotected updatePivotPoint() {\n\t\tconst bounds = this._localBounds;\n\t\tif (bounds) {\n\t\t\tconst centerX = this.get(\"centerX\");\n\t\t\tif (centerX != null) {\n\t\t\t\tthis._display.pivot.x = bounds.left + $utils.relativeToValue(centerX!, bounds.right - bounds.left);\n\t\t\t}\n\n\t\t\tconst centerY = this.get(\"centerY\");\n\t\t\tif (centerY != null) {\n\t\t\t\tthis._display.pivot.y = bounds.top + $utils.relativeToValue(centerY!, bounds.bottom - bounds.top);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic _beforeChanged() {\n\t\tsuper._beforeChanged();\n\n\t\t// handling states in beforeChanged, otherwise states is not applied without animated theme\n\t\tthis._handleStates();\n\n\t\tif (this.isDirty(\"tooltip\")) {\n\t\t\tconst previous = this._prevSettings.tooltip;\n\t\t\tif (previous) {\n\t\t\t\tprevious.dispose();\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDirty(\"layer\")) {\n\t\t\tthis._display.setLayer(this.get(\"layer\"));\n\t\t\tthis.markDirtyLayer();\n\t\t}\n\n\t\tif (this.isDirty(\"tooltipPosition\")) {\n\t\t\tconst tooltipMoveDp = this._tooltipMoveDp;\n\t\t\tif (tooltipMoveDp) {\n\t\t\t\ttooltipMoveDp.dispose();\n\t\t\t\tthis._tooltipMoveDp = undefined;\n\t\t\t}\n\n\t\t\tconst tooltipPointerDp = this._tooltipPointerDp;\n\t\t\tif (tooltipPointerDp) {\n\t\t\t\ttooltipPointerDp.dispose();\n\t\t\t\tthis._tooltipPointerDp = undefined;\n\t\t\t}\n\n\t\t\tif (this.get(\"tooltipPosition\") == \"pointer\") {\n\t\t\t\tthis._tooltipPointerDp = new MultiDisposer([\n\t\t\t\t\tthis.events.on(\"pointerover\", () => {\n\t\t\t\t\t\tthis._tooltipMoveDp = this.events.on(\"globalpointermove\", (e) => {\n\t\t\t\t\t\t\tthis.showTooltip(e.point);\n\t\t\t\t\t\t})\n\t\t\t\t\t}),\n\n\t\t\t\t\tthis.events.on(\"pointerout\", () => {\n\t\t\t\t\t\tconst tooltipMoveDp = this._tooltipMoveDp;\n\t\t\t\t\t\tif (tooltipMoveDp) {\n\t\t\t\t\t\t\ttooltipMoveDp.dispose();\n\t\t\t\t\t\t\tthis._tooltipMoveDp = undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t})])\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected _handleStates() {\n\t\tif (!this._statesHandled) {\n\t\t\tif (this.isDirty(\"active\")) {\n\t\t\t\tif (this.get(\"active\")) {\n\t\t\t\t\tthis.states.applyAnimate(\"active\");\n\t\t\t\t\tthis.set(\"ariaChecked\", true);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (!this.isHidden()) {\n\t\t\t\t\t\tthis.states.applyAnimate(\"default\");\n\t\t\t\t\t}\n\t\t\t\t\tthis.set(\"ariaChecked\", false);\n\t\t\t\t}\n\t\t\t\tthis.markDirtyAccessibility();\n\t\t\t}\n\n\t\t\tif (this.isDirty(\"disabled\")) {\n\t\t\t\tif (this.get(\"disabled\")) {\n\t\t\t\t\tthis.states.applyAnimate(\"disabled\");\n\t\t\t\t\tthis.set(\"ariaChecked\", false);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (!this.isHidden()) {\n\t\t\t\t\t\tthis.states.applyAnimate(\"default\");\n\t\t\t\t\t}\n\t\t\t\t\tthis.set(\"ariaChecked\", true);\n\t\t\t\t}\n\t\t\t\tthis.markDirtyAccessibility();\n\t\t\t}\n\t\t\tthis._statesHandled = true;\n\t\t}\n\t}\n\n\tpublic _changed() {\n\t\tsuper._changed();\n\n\t\tconst display = this._display;\n\t\tconst events = this.events;\n\n\t\tif (this.isDirty(\"draggable\")) {\n\t\t\tconst draggable = this.get(\"draggable\");\n\t\t\tif (draggable) {\n\t\t\t\tthis.set(\"interactive\", true);\n\n\t\t\t\tthis._dragDp = new MultiDisposer([\n\t\t\t\t\tevents.on(\"pointerdown\", (ev) => {\n\t\t\t\t\t\tthis.dragStart(ev);\n\t\t\t\t\t}),\n\n\t\t\t\t\tevents.on(\"globalpointermove\", (ev) => {\n\t\t\t\t\t\tthis.dragMove(ev);\n\t\t\t\t\t}),\n\n\t\t\t\t\tevents.on(\"globalpointerup\", (ev) => {\n\t\t\t\t\t\tthis.dragStop(ev);\n\t\t\t\t\t})])\n\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (this._dragDp) {\n\t\t\t\t\tthis._dragDp.dispose();\n\t\t\t\t\tthis._dragDp = undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDirty(\"tooltipText\")) {\n\t\t\tconst tooltipText = this.get(\"tooltipText\");\n\t\t\tif (tooltipText) {\n\t\t\t\tthis._tooltipDp = new MultiDisposer([\n\t\t\t\t\tevents.on(\"pointerover\", () => {\n\t\t\t\t\t\tthis.showTooltip();\n\t\t\t\t\t}),\n\t\t\t\t\tevents.on(\"pointerout\", () => {\n\t\t\t\t\t\tif (this.get(\"showTooltipOn\") != \"always\") {\n\t\t\t\t\t\t\tthis.hideTooltip();\n\t\t\t\t\t\t}\n\t\t\t\t\t})])\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (this._tooltipDp) {\n\t\t\t\t\tthis._tooltipDp.dispose();\n\t\t\t\t\tthis._tooltipDp = undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDirty(\"toggleKey\")) {\n\t\t\tlet toggleKey = this.get(\"toggleKey\") as any;\n\t\t\tif (toggleKey && toggleKey != \"none\") {\n\t\t\t\tthis._toggleDp = events.on(\"click\", () => {\n\t\t\t\t\tif (!this._isDragging) {\n\t\t\t\t\t\tthis.set(toggleKey, !this.get(toggleKey));\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (this._toggleDp) {\n\t\t\t\t\tthis._toggleDp.dispose();\n\t\t\t\t\tthis._toggleDp = undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tif (this.isDirty(\"opacity\")) {\n\t\t\tdisplay.alpha = Math.max(0, this.get(\"opacity\", 1));\n\t\t}\n\n\t\tif (this.isDirty(\"rotation\")) {\n\t\t\tthis.markDirtyBounds();\n\t\t\tdisplay.angle = this.get(\"rotation\", 0);\n\t\t}\n\n\t\tif (this.isDirty(\"scale\")) {\n\t\t\tthis.markDirtyBounds();\n\t\t\tdisplay.scale = this.get(\"scale\", 0);\n\t\t}\n\n\t\tif (this.isDirty(\"centerX\") || this.isDirty(\"centerY\")) {\n\t\t\tthis.markDirtyBounds();\n\t\t\tthis.updatePivotPoint();\n\t\t}\n\n\t\tif (this.isDirty(\"visible\") || this.isPrivateDirty(\"visible\") || this.isDirty(\"forceHidden\")) {\n\t\t\tif (!this.get(\"visible\") || !this.getPrivate(\"visible\") || this.get(\"forceHidden\")) {\n\t\t\t\tdisplay.visible = false;\n\t\t\t\tthis.hideTooltip();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tdisplay.visible = true;\n\t\t\t}\n\n\t\t\tthis.markDirtyBounds();\n\t\t\tif (this.get(\"focusable\")) {\n\t\t\t\tthis.markDirtyAccessibility();\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDirty(\"width\") || this.isDirty(\"height\")) {\n\t\t\tthis.markDirtyBounds();\n\t\t\tthis._addPercentageSizeChildren();\n\n\t\t\tconst parent = this.parent;\n\t\t\tif (parent) {\n\t\t\t\tif ((this.isDirty(\"width\") && this.get(\"width\") instanceof Percent) || (this.isDirty(\"height\") && this.get(\"height\") instanceof Percent)) {\n\t\t\t\t\tparent.markDirty();\n\t\t\t\t\tparent._prevWidth = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._sizeDirty = true;\n\t\t}\n\n\t\tif (this.isDirty(\"maxWidth\") || this.isDirty(\"maxHeight\") || this.isPrivateDirty(\"width\") || this.isPrivateDirty(\"height\") || this.isDirty(\"minWidth\") || this.isDirty(\"minHeight\")) {\n\t\t\tthis.markDirtyBounds();\n\t\t\tthis._sizeDirty = true;\n\t\t}\n\n\t\tif (this._sizeDirty) {\n\t\t\tthis._updateSize();\n\t\t}\n\n\t\tif (this.isDirty(\"wheelable\")) {\n\t\t\tconst wheelable = this.get(\"wheelable\");\n\t\t\tif (wheelable) {\n\t\t\t\tthis.set(\"interactive\", true);\n\t\t\t}\n\t\t\tdisplay.wheelable = wheelable ? true : false;\n\t\t}\n\n\t\t// Accessibility\n\t\tif (this.isDirty(\"tabindexOrder\") || this.isDirty(\"focusableGroup\")) {\n\t\t\tif (this.get(\"focusable\")) {\n\t\t\t\tthis._root._registerTabindexOrder(this);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._root._unregisterTabindexOrder(this);\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDirty(\"filter\")) {\n\t\t\t//this.markDirtyBounds();\n\t\t\tdisplay.filter = this.get(\"filter\");\n\t\t}\n\n\t\tif (this.isDirty(\"cursorOverStyle\")) {\n\t\t\tdisplay.cursorOverStyle = this.get(\"cursorOverStyle\");\n\t\t}\n\n\t\tif (this.isDirty(\"hoverOnFocus\")) {\n\t\t\tif (this.get(\"hoverOnFocus\")) {\n\t\t\t\tthis._focusDp = new MultiDisposer([\n\t\t\t\t\tevents.on(\"focus\", () => {\n\t\t\t\t\t\t// TODO: proper hover, not just tooltip\n\t\t\t\t\t\tthis.showTooltip();\n\t\t\t\t\t}),\n\n\t\t\t\t\tevents.on(\"blur\", () => {\n\t\t\t\t\t\t// TODO: proper hover, not just tooltip\n\t\t\t\t\t\tthis.hideTooltip();\n\t\t\t\t\t})])\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (this._focusDp) {\n\t\t\t\t\tthis._focusDp.dispose();\n\t\t\t\t\tthis._focusDp = undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDirty(\"focusable\")) {\n\t\t\tif (this.get(\"focusable\")) {\n\t\t\t\tthis._root._registerTabindexOrder(this);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._root._unregisterTabindexOrder(this);\n\t\t\t}\n\t\t\tthis.markDirtyAccessibility();\n\t\t}\n\n\t\tif (this.isDirty(\"role\") || this.isDirty(\"ariaLive\") || this.isDirty(\"ariaChecked\") || this.isDirty(\"ariaHidden\") || this.isDirty(\"ariaOrientation\") || this.isDirty(\"ariaValueNow\") || this.isDirty(\"ariaValueMin\") || this.isDirty(\"ariaValueMax\") || this.isDirty(\"ariaValueText\") || this.isDirty(\"ariaLabel\") || this.isDirty(\"ariaControls\")) {\n\t\t\t// display.accessibility.ariaLabel = populateString(this, this.get(\"ariaLabel\", \"\"));\n\t\t\t// @todo make sure ariaLabel gets populated in Root\n\t\t\tthis.markDirtyAccessibility();\n\t\t}\n\n\t\tif (this.isDirty(\"exportable\")) {\n\t\t\tdisplay.exportable = this.get(\"exportable\");\n\t\t}\n\n\t\tif (this.isDirty(\"interactive\")) {\n\t\t\tconst events = this.events;\n\t\t\tif (this.get(\"interactive\")) {\n\t\t\t\tthis._hoverDp = new MultiDisposer([\n\t\t\t\t\tevents.on(\"click\", (ev) => {\n\t\t\t\t\t\tif ($utils.isTouchEvent(ev.originalEvent)) {\n\t\t\t\t\t\t\tif (!this.getPrivate(\"touchHovering\")) {\n\t\t\t\t\t\t\t\tthis.setTimeout(() => {\n\t\t\t\t\t\t\t\t\tthis._handleOver();\n\t\t\t\t\t\t\t\t\tif (this.get(\"tooltipText\")) {\n\t\t\t\t\t\t\t\t\t\tthis.showTooltip();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tthis.setPrivateRaw(\"touchHovering\", true);\n\t\t\t\t\t\t\t\t\tthis.events.dispatch(\"pointerover\", {\n\t\t\t\t\t\t\t\t\t\ttype: \"pointerover\",\n\t\t\t\t\t\t\t\t\t\ttarget: ev.target,\n\t\t\t\t\t\t\t\t\t\toriginalEvent: ev.originalEvent,\n\t\t\t\t\t\t\t\t\t\tpoint: ev.point,\n\t\t\t\t\t\t\t\t\t\tsimulated: ev.simulated\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}, 10)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\n\t\t\t\t\tevents.on(\"globalpointerup\", (ev) => {\n\t\t\t\t\t\tif ($utils.isTouchEvent(ev.originalEvent)) {\n\t\t\t\t\t\t\tif (this.getPrivate(\"touchHovering\")) {\n\t\t\t\t\t\t\t\tthis._handleOut();\n\t\t\t\t\t\t\t\tif (this.get(\"tooltipText\")) {\n\t\t\t\t\t\t\t\t\tthis.hideTooltip();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.setPrivateRaw(\"touchHovering\", false);\n\t\t\t\t\t\t\tthis.events.dispatch(\"pointerout\", {\n\t\t\t\t\t\t\t\ttype: \"pointerout\",\n\t\t\t\t\t\t\t\ttarget: ev.target,\n\t\t\t\t\t\t\t\toriginalEvent: ev.originalEvent,\n\t\t\t\t\t\t\t\tpoint: ev.point,\n\t\t\t\t\t\t\t\tsimulated: ev.simulated\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this._isDown) {\n\t\t\t\t\t\t\tthis._handleUp(ev);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//this._isDown = false;\n\t\t\t\t\t}),\n\n\t\t\t\t\tevents.on(\"pointerover\", () => {\n\t\t\t\t\t\tthis._handleOver();\n\t\t\t\t\t}),\n\n\t\t\t\t\tevents.on(\"pointerout\", () => {\n\t\t\t\t\t\tthis._handleOut();\n\t\t\t\t\t}),\n\n\t\t\t\t\tevents.on(\"pointerdown\", (e) => {\n\t\t\t\t\t\tthis._handleDown(e);\n\t\t\t\t\t})\n\t\t\t\t])\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._display.interactive = false;\n\t\t\t\tif (this._hoverDp) {\n\t\t\t\t\tthis._hoverDp.dispose();\n\t\t\t\t\tthis._hoverDp = undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDirty(\"forceInactive\")) {\n\t\t\tthis._display.inactive = this.get(\"forceInactive\", false);\n\t\t}\n\n\t\tif (this.get(\"showTooltipOn\") == \"always\" && this._display.visible) {\n\t\t\tthis.showTooltip();\n\t\t}\n\t}\n\n\t/**\n\t * @ignore\n\t * @todo should this be user-accessible?\n\t */\n\tpublic dragStart(e: ISpritePointerEvent) {\n\t\tthis._dragEvent = e;\n\t\tthis.events.stopParentDispatch();\n\t}\n\n\t/**\n\t * @ignore\n\t * @todo should this be user-accessible?\n\t */\n\tpublic dragStop(e: ISpritePointerEvent) {\n\t\tthis._dragEvent = undefined;\n\t\tthis._dragPoint = undefined;\n\t\tthis.events.stopParentDispatch();\n\n\t\tif (this._isDragging) {\n\t\t\tthis._isDragging = false;\n\n\t\t\tconst type = \"dragstop\";\n\t\t\tif (this.events.isEnabled(type)) {\n\t\t\t\tthis.events.dispatch(type, {\n\t\t\t\t\ttype: type,\n\t\t\t\t\ttarget: this,\n\t\t\t\t\toriginalEvent: e.originalEvent,\n\t\t\t\t\tpoint: e.point,\n\t\t\t\t\tsimulated: e.simulated,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected _handleOver() {\n\t\tif (!this.isHidden()) {\n\t\t\tif (this.get(\"active\") && this.states.lookup(\"hoverActive\")) {\n\t\t\t\tthis.states.applyAnimate(\"hoverActive\");\n\t\t\t}\n\t\t\telse if (this.get(\"disabled\") && this.states.lookup(\"hoverDisabled\")) {\n\t\t\t\tthis.states.applyAnimate(\"hoverDisabled\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.states.applyAnimate(\"hover\");\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected _handleOut() {\n\t\tif (!this.isHidden()) {\n\t\t\tif (this.get(\"active\") && this.states.lookup(\"active\")) {\n\t\t\t\tthis.states.applyAnimate(\"active\");\n\t\t\t}\n\t\t\telse if (this.get(\"disabled\") && this.states.lookup(\"disabled\")) {\n\t\t\t\tthis.states.applyAnimate(\"disabled\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (this.states.lookup(\"hover\") || this.states.lookup(\"hoverActive\")) {\n\t\t\t\t\tthis.states.applyAnimate(\"default\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected _handleUp(e: ISpritePointerEvent) {\n\t\tif (!this.isHidden()) {\n\t\t\tif (this.get(\"active\") && this.states.lookup(\"active\")) {\n\t\t\t\tthis.states.applyAnimate(\"active\");\n\t\t\t}\n\t\t\telse if (this.get(\"disabled\") && this.states.lookup(\"disabled\")) {\n\t\t\t\tthis.states.applyAnimate(\"disabled\");\n\t\t\t}\n\t\t\telse if (this.states.lookup(\"down\")) {\n\t\t\t\tif (this.isHover()) {\n\t\t\t\t\tthis.states.applyAnimate(\"hover\");\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.states.applyAnimate(\"default\");\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\t// @todo remove this once migrated to _downPoints\n\t\t\tthis._downPoint = undefined;\n\n\t\t\tconst pointerId = $utils.getPointerId(e.originalEvent);\n\t\t\tdelete this._downPoints[pointerId];\n\n\t\t\tif ($object.keys(this._downPoints).length == 0) {\n\t\t\t\tthis._isDown = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic _hasMoved(e: ISpritePointerEvent): boolean {\n\t\t// @todo remove this once migrated to _downPoints\n\t\t// if (this._downPoint) {\n\t\t// \tconst x = Math.abs(this._downPoint.x - e.point.x);\n\t\t// \tconst y = Math.abs(this._downPoint.y - e.point.y);\n\t\t// \treturn (x > 5) || (y > 5);\n\t\t// }\n\n\t\tconst pointerId = $utils.getPointerId(e.originalEvent);\n\t\tconst downPoint = this._downPoints[pointerId];\n\t\tif (downPoint) {\n\t\t\tconst x = Math.abs(downPoint.x - e.point.x);\n\t\t\tconst y = Math.abs(downPoint.y - e.point.y);\n\t\t\treturn (x > 5) || (y > 5);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tpublic _hasDown(): boolean {\n\t\treturn $object.keys(this._downPoints).length > 0;\n\t}\n\n\tprotected _handleDown(e: ISpritePointerEvent) {\n\n\t\tconst parent = this.parent;\n\t\tif (parent && !this.get(\"draggable\")) {\n\t\t\tparent._handleDown(e);\n\t\t}\n\n\t\tif (this.get(\"interactive\") && !this.isHidden()) {\n\t\t\tif (this.states.lookup(\"down\")) {\n\t\t\t\tthis.states.applyAnimate(\"down\");\n\t\t\t}\n\t\t\tthis._downPoint = {\n\t\t\t\tx: e.point.x,\n\t\t\t\ty: e.point.y\n\t\t\t};\n\n\n\t\t\t// @todo remove this once migrated to _downPoints\n\t\t\tthis._isDown = true;\n\n\t\t\tconst pointerId = $utils.getPointerId(e.originalEvent);\n\t\t\tthis._downPoints[pointerId] = {\n\t\t\t\tx: e.point.x,\n\t\t\t\ty: e.point.y\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * @ignore\n\t * @todo should this be user-accessible?\n\t */\n\tpublic dragMove(e: ISpritePointerEvent) {\n\t\tlet dragEvent = this._dragEvent;\n\n\t\tif (dragEvent) {\n\t\t\tlet angle = 0;\n\n\t\t\tlet parent = this.parent;\n\t\t\twhile (parent != null) {\n\t\t\t\tangle += parent.get(\"rotation\", 0);\n\t\t\t\tparent = parent.parent;\n\t\t\t}\n\n\t\t\tlet x = e.point.x - dragEvent.point.x;\n\t\t\tlet y = e.point.y - dragEvent.point.y;\n\n\t\t\tconst events = this.events;\n\n\t\t\tif (dragEvent.simulated && !this._isDragging) {\n\t\t\t\tthis._isDragging = true;\n\t\t\t\tthis._dragEvent = e;\n\n\t\t\t\tthis._dragPoint = {\n\t\t\t\t\tx: this.x(),\n\t\t\t\t\ty: this.y()\n\t\t\t\t};\n\n\t\t\t\tconst type = \"dragstart\";\n\t\t\t\tif (events.isEnabled(type)) {\n\t\t\t\t\tevents.dispatch(type, {\n\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\ttarget: this,\n\t\t\t\t\t\toriginalEvent: e.originalEvent,\n\t\t\t\t\t\tpoint: e.point,\n\t\t\t\t\t\tsimulated: e.simulated,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this._isDragging) {\n\t\t\t\tlet dragPoint = this._dragPoint!;\n\n\t\t\t\tthis.set(\"x\", dragPoint.x + x * $math.cos(angle) + y * $math.sin(angle));\n\t\t\t\tthis.set(\"y\", dragPoint.y + y * $math.cos(angle) - x * $math.sin(angle));\n\n\t\t\t\tconst type = \"dragged\";\n\t\t\t\tif (events.isEnabled(type)) {\n\t\t\t\t\tevents.dispatch(type, {\n\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\ttarget: this,\n\t\t\t\t\t\toriginalEvent: e.originalEvent,\n\t\t\t\t\t\tpoint: e.point,\n\t\t\t\t\t\tsimulated: e.simulated,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tif (Math.hypot(x, y) > 5) {\n\t\t\t\t\tthis._isDragging = true;\n\t\t\t\t\tthis._dragEvent = e;\n\n\t\t\t\t\tthis._dragPoint = {\n\t\t\t\t\t\tx: this.x(),\n\t\t\t\t\t\ty: this.y()\n\t\t\t\t\t};\n\n\t\t\t\t\tconst type = \"dragstart\";\n\t\t\t\t\tif (events.isEnabled(type)) {\n\t\t\t\t\t\tevents.dispatch(type, {\n\t\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\t\ttarget: this,\n\t\t\t\t\t\t\toriginalEvent: e.originalEvent,\n\t\t\t\t\t\t\tpoint: e.point,\n\t\t\t\t\t\t\tsimulated: e.simulated\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic _updateSize() {\n\n\t}\n\n\tprotected _getBounds() {\n\t\tthis._localBounds = this._display.getLocalBounds();\n\t}\n\n\t/**\n\t * Returns depth (how deep in the hierachy of the content tree) of this\n\t * element.\n\t *\n\t * @return Depth\n\t */\n\tpublic depth(): number {\n\t\tlet self: Container | undefined = this.parent;\n\t\tlet depth = 0;\n\n\t\twhile (true) {\n\t\t\tif (self) {\n\t\t\t\t++depth;\n\t\t\t\tself = self.parent;\n\n\t\t\t} else {\n\t\t\t\treturn depth;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic markDirtySize(): void {\n\t\tthis._sizeDirty = true;\n\t\tthis.markDirty();\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic markDirtyBounds(): void {\n\t\tconst display = this._display;\n\t\tif (this.get(\"isMeasured\")) {\n\t\t\tthis._root._addDirtyBounds(this);\n\t\t\tdisplay.isMeasured = true;\n\t\t\tdisplay.invalidateBounds();\n\n\t\t\tconst parent = this.parent;\n\n\t\t\tif (parent && this.get(\"position\") != \"absolute\") {\n\t\t\t\tif (parent.get(\"width\") == null || parent.get(\"height\") == null || parent.get(\"layout\")) {\n\t\t\t\t\tparent.markDirtyBounds();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.get(\"focusable\") && this.isFocus()) {\n\t\t\t\tthis.markDirtyAccessibility();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic markDirtyAccessibility(): void {\n\t\t//if (this._root.focused(this)) {\n\t\tthis._root._invalidateAccessibility(this);\n\t\t//}\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic markDirtyLayer() {\n\t\t//this._display.markDirtyLayer(this.isDirty(\"opacity\") || this.isDirty(\"visible\")); https://codepen.io/team/amcharts/pen/gOWZPmP <- problems\n\t\tthis._display.markDirtyLayer(true);\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic markDirty() {\n\t\tsuper.markDirty();\n\t\tthis.markDirtyLayer();\n\t}\n\n\tpublic _updateBounds() {\n\t\tconst oldBounds = this._adjustedLocalBounds;\n\n\t\tlet newBounds: IBounds;\n\n\t\t// if display.visible == false, it still returns bounds\n\t\tif (!this.get(\"visible\") || !this.getPrivate(\"visible\") || this.get(\"forceHidden\")) {\n\t\t\tnewBounds = {\n\t\t\t\tleft: 0,\n\t\t\t\tright: 0,\n\t\t\t\ttop: 0,\n\t\t\t\tbottom: 0\n\t\t\t};\n\t\t\tthis._localBounds = newBounds;\n\t\t\tthis._adjustedLocalBounds = newBounds;\n\t\t}\n\t\telse {\n\t\t\tthis._getBounds();\n\t\t\tthis._fixMinBounds(this._localBounds);\n\t\t\tthis.updatePivotPoint();\n\t\t\tthis._adjustedLocalBounds = this._display.getAdjustedBounds(this._localBounds);\n\t\t\tnewBounds = this._adjustedLocalBounds!;\n\t\t}\n\n\t\tif (!oldBounds || (oldBounds.left !== newBounds.left || oldBounds.top !== newBounds.top || oldBounds.right !== newBounds.right || oldBounds.bottom !== newBounds.bottom)) {\n\t\t\tconst eventType = \"boundschanged\";\n\t\t\tif (this.events.isEnabled(eventType)) {\n\t\t\t\tthis.events.dispatch(eventType, { type: eventType, target: this });\n\t\t\t}\n\t\t\tif (this.parent) {\n\t\t\t\tthis.parent.markDirty();\n\t\t\t\tthis.parent.markDirtyBounds();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic _fixMinBounds(bounds: IBounds) {\n\t\tlet minWidth = this.get(\"minWidth\");\n\t\tlet minHeight = this.get(\"minHeight\");\n\n\t\tif ($type.isNumber(minWidth)) {\n\t\t\tif (bounds.right - bounds.left < minWidth) {\n\t\t\t\tbounds.right = bounds.left + minWidth;\n\t\t\t}\n\t\t}\n\n\t\tif ($type.isNumber(minHeight)) {\n\t\t\tif (bounds.bottom - bounds.top < minHeight) {\n\t\t\t\tbounds.bottom = bounds.top + minHeight;\n\t\t\t}\n\t\t}\n\n\t\tlet privateWidth = this.getPrivate(\"width\");\n\t\tlet privateHeight = this.getPrivate(\"height\");\n\n\t\tif ($type.isNumber(privateWidth)) {\n\t\t\tbounds.right = bounds.left + privateWidth;\n\t\t}\n\n\t\tif ($type.isNumber(privateHeight)) {\n\t\t\tbounds.bottom = bounds.top + privateHeight;\n\t\t}\n\t}\n\n\tprotected _removeParent(parent: Container | undefined) {\n\t\tif (parent) {\n\t\t\tparent.children.removeValue(this);\n\t\t\t$array.removeFirst(parent._percentageSizeChildren, this);\n\t\t\t$array.removeFirst(parent._percentagePositionChildren, this);\n\t\t}\n\t}\n\n\tpublic _clearDirty() {\n\t\tsuper._clearDirty();\n\t\tthis._sizeDirty = false;\n\t\tthis._statesHandled = false;\n\t}\n\n\t/**\n\t * Simulate hover over element.\n\t */\n\tpublic hover() {\n\t\tthis.showTooltip();\n\t\tthis._handleOver();\n\t}\n\n\t/**\n\t * Simulate unhover over element.\n\t */\n\tpublic unhover(): void {\n\t\tthis.hideTooltip();\n\t\tthis._handleOut();\n\t}\n\n\t/**\n\t * Shows element's [[Tooltip]].\n\t */\n\tpublic showTooltip(point?: IPoint): Promise<void> | undefined {\n\t\tconst tooltip = this.getTooltip();\n\t\tconst tooltipText = this.get(\"tooltipText\");\n\n\t\tif (tooltipText && tooltip) {\n\t\t\tconst tooltipPosition = this.get(\"tooltipPosition\");\n\t\t\tconst tooltipTarget = this.getPrivate(\"tooltipTarget\", this);\n\n\t\t\tif (tooltipPosition == \"fixed\" || !point) {\n\t\t\t\tthis._display._setMatrix();\n\t\t\t\tpoint = this.toGlobal(tooltipTarget._getTooltipPoint());\n\t\t\t}\n\n\t\t\ttooltip.set(\"pointTo\", point);\n\t\t\ttooltip.set(\"tooltipTarget\", tooltipTarget);\n\n\t\t\tif (!tooltip.get(\"x\")) {\n\t\t\t\ttooltip.set(\"x\", point.x);\n\t\t\t}\n\t\t\tif (!tooltip.get(\"y\")) {\n\t\t\t\ttooltip.set(\"y\", point.y);\n\t\t\t}\n\n\t\t\ttooltip.label.set(\"text\", tooltipText);\n\t\t\tconst dataItem = this.dataItem;\n\t\t\tif (dataItem) {\n\t\t\t\ttooltip.label._setDataItem(dataItem);\n\t\t\t}\n\n\t\t\tif (this.get(\"showTooltipOn\") == \"always\" && (point.x < 0 || point.x > this._root.width() || point.y < 0 || point.y > this._root.height())) {\n\t\t\t\tthis.hideTooltip();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttooltip.label.text.markDirtyText();\n\t\t\tconst promise = tooltip.show();\n\t\t\tthis.setPrivateRaw(\"showingTooltip\", true);\n\t\t\treturn promise;\n\t\t}\n\t}\n\n\t/**\n\t * Hides element's [[Tooltip]].\n\t */\n\tpublic hideTooltip(): Promise<void> | undefined {\n\t\tconst tooltip = this.getTooltip();\n\t\tif (tooltip) {\n\t\t\tconst promise = tooltip.hide();\n\t\t\tthis.setPrivateRaw(\"showingTooltip\", false);\n\t\t\treturn promise;\n\t\t}\n\t}\n\n\tpublic _getTooltipPoint(): IPoint {\n\t\tconst bounds = this._localBounds!;\n\n\t\tif (bounds) {\n\t\t\tlet x = 0;\n\t\t\tlet y = 0;\n\n\t\t\tif (!this.get(\"isMeasured\")) {\n\t\t\t\tx = $utils.relativeToValue(this.get(\"tooltipX\", 0), this.width());\n\t\t\t\ty = $utils.relativeToValue(this.get(\"tooltipY\", 0), this.height());\n\t\t\t}\n\t\t\telse {\n\t\t\t\tx = bounds.left + $utils.relativeToValue(this.get(\"tooltipX\", 0), bounds.right - bounds.left);\n\t\t\t\ty = bounds.top + $utils.relativeToValue(this.get(\"tooltipY\", 0), bounds.bottom - bounds.top);\n\t\t\t}\n\n\t\t\treturn { x, y };\n\t\t}\n\t\treturn { x: 0, y: 0 };\n\t}\n\n\t/**\n\t * Returns [[Tooltip]] used for this element.\n\t *\n\t * @return Tooltip\n\t */\n\tpublic getTooltip(): Tooltip | undefined {\n\t\tlet tooltip = this.get(\"tooltip\");\n\t\tif (!tooltip) {\n\t\t\tlet parent = this.parent;\n\t\t\tif (parent) {\n\t\t\t\treturn parent.getTooltip();\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\treturn tooltip;\n\t\t}\n\t}\n\n\tpublic _updatePosition() {\n\n\t\tconst parent = this.parent;\n\n\t\tlet dx = this.get(\"dx\", 0);\n\t\tlet dy = this.get(\"dy\", 0);\n\n\t\tlet x = this.get(\"x\");\n\t\tlet _x = this.getPrivate(\"x\");\n\n\t\tlet xx = 0;\n\t\tlet yy = 0;\n\n\t\tconst position = this.get(\"position\");\n\n\t\tif (x instanceof Percent) {\n\t\t\tif (parent) {\n\t\t\t\tx = parent.innerWidth() * x.value + parent.get(\"paddingLeft\", 0);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tx = 0;\n\t\t\t}\n\t\t}\n\t\tif ($type.isNumber(x)) {\n\t\t\txx = x + dx;\n\t\t}\n\t\telse {\n\t\t\tif (_x != null) {\n\t\t\t\txx = _x;\n\t\t\t}\n\t\t\telse if (parent) {\n\t\t\t\tif (position == \"relative\") {\n\t\t\t\t\txx = parent.get(\"paddingLeft\", 0) + dx;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tlet y = this.get(\"y\");\n\t\tlet _y = this.getPrivate(\"y\");\n\n\t\tif (y instanceof Percent) {\n\t\t\tif (parent) {\n\t\t\t\ty = parent.innerHeight() * y.value + parent.get(\"paddingTop\", 0);\n\t\t\t}\n\t\t\telse {\n\t\t\t\ty = 0;\n\t\t\t}\n\t\t}\n\t\tif ($type.isNumber(y)) {\n\t\t\tyy = y + dy;\n\t\t}\n\t\telse {\n\t\t\tif (_y != null) {\n\t\t\t\tyy = _y;\n\t\t\t}\n\t\t\telse if (parent) {\n\t\t\t\tif (position == \"relative\") {\n\t\t\t\t\tyy = parent.get(\"paddingTop\", 0) + dy;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst display = this._display;\n\n\t\tif (display.x != xx || display.y != yy) {\n\t\t\tdisplay.invalidateBounds();\n\t\t\tdisplay.x = xx;\n\t\t\tdisplay.y = yy;\n\n\t\t\tconst eventType = \"positionchanged\";\n\t\t\tif (this.events.isEnabled(eventType)) {\n\t\t\t\tthis.events.dispatch(eventType, { type: eventType, target: this });\n\t\t\t}\n\t\t}\n\n\t\t// Update tooltip position together with the Sprite\n\t\tif (this.getPrivate(\"showingTooltip\")) {\n\t\t\tthis.showTooltip();\n\t\t}\n\t}\n\n\t/**\n\t * Returns element's actual X position in pixels.\n\t *\n\t * @return X (px)\n\t */\n\tpublic x(): number {\n\t\tlet x = this.get(\"x\");\n\t\tlet _x = this.getPrivate(\"x\");\n\n\t\tconst parent = this.parent;\n\t\tif (parent) {\n\t\t\tif (x instanceof Percent) {\n\t\t\t\treturn $utils.relativeToValue(x, parent.innerWidth()) + parent.get(\"paddingLeft\", 0);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (!$type.isNumber(x)) {\n\t\t\t\t\tif (_x != null) {\n\t\t\t\t\t\treturn _x;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\treturn parent.get(\"paddingLeft\", this._display.x)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn x;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this._display.x;\n\t}\n\n\t/**\n\t * Returns element's actual Y position in pixels.\n\t *\n\t * @return Y (px)\n\t */\n\tpublic y(): number {\n\n\t\tlet _y = this.getPrivate(\"y\");\n\n\t\tif (_y != null) {\n\t\t\treturn _y;\n\t\t}\n\n\t\tlet y = this.get(\"y\");\n\t\tconst parent = this.parent;\n\n\t\tif (parent) {\n\t\t\tif (y instanceof Percent) {\n\t\t\t\treturn $utils.relativeToValue(y, parent.innerHeight()) + parent.get(\"paddingTop\", 0);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (!$type.isNumber(y)) {\n\t\t\t\t\tif (_y != null) {\n\t\t\t\t\t\treturn _y;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\treturn parent.get(\"paddingTop\", this._display.y)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn y;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this._display.y;\n\t}\n\n\tprotected _dispose() {\n\t\tsuper._dispose();\n\t\tthis._display.dispose();\n\t\tthis._removeTemplateField();\n\t\tthis._removeParent(this.parent);\n\t\tthis._root._removeFocusElement(this);\n\n\t\tconst tooltip = this.get(\"tooltip\");\n\t\tif (tooltip) {\n\t\t\ttooltip.dispose();\n\t\t}\n\n\t\tthis.markDirty();\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic adjustedLocalBounds(): IBounds {\n\t\tthis._fixMinBounds(this._adjustedLocalBounds);\n\t\treturn this._adjustedLocalBounds;\n\t}\n\n\t/**\n\t * Returns local coordinates of the element's bounds.\n\t *\n\t * @ignore\n\t * @return Global bounds\n\t */\n\tpublic localBounds(): IBounds {\n\t\treturn this._localBounds;\n\t}\n\n\t/**\n\t * Returns adjusted local coordinates of the element's bounds.\n\t *\n\t * @ignore\n\t * @return Global bounds\n\t */\n\tpublic bounds(): IBounds {\n\t\tconst bounds = this._adjustedLocalBounds;\n\t\tconst x = this.x();\n\t\tconst y = this.y();\n\t\treturn { left: bounds.left + x, right: bounds.right + x, top: bounds.top + y, bottom: bounds.bottom + y };\n\t}\n\n\t/**\n\t * Returns global coordinates of the element's bounds.\n\t *\n\t * @ignore\n\t * @return Global bounds\n\t */\n\tpublic globalBounds(): IBounds {\n\t\tconst bounds = this.localBounds();\n\n\t\tconst p0 = this.toGlobal({ x: bounds.left, y: bounds.top });\n\t\tconst p1 = this.toGlobal({ x: bounds.right, y: bounds.top });\n\t\tconst p2 = this.toGlobal({ x: bounds.right, y: bounds.bottom });\n\t\tconst p3 = this.toGlobal({ x: bounds.left, y: bounds.bottom });\n\n\t\treturn {\n\t\t\tleft: Math.min(p0.x, p1.x, p2.x, p3.x),\n\t\t\ttop: Math.min(p0.y, p1.y, p2.y, p3.y),\n\t\t\tright: Math.max(p0.x, p1.x, p2.x, p3.x),\n\t\t\tbottom: Math.max(p0.y, p1.y, p2.y, p3.y)\n\t\t}\n\t}\n\n\tprotected _onShow(_duration?: number) {\n\n\t}\n\n\tprotected _onHide(_duration?: number) {\n\n\t}\n\n\t/**\n\t * Plays initial reveal animation regardless if element is currently hidden\n\t * or visible.\n\t *\n\t * @param   duration  Duration of the animation in milliseconds\n\t * @param   delay     Delay showing of the element by X milliseconds\n\t * @return            Promise\n\t */\n\tpublic async appear(duration?: number, delay?: number): Promise<void> {\n\t\tawait this.hide(0);\n\t\tif (delay) {\n\t\t\treturn new Promise<void>((success, _error) => {\n\t\t\t\tthis.setTimeout(() => {\n\t\t\t\t\tsuccess(this.show(duration));\n\t\t\t\t}, delay);\n\t\t\t});\n\n\t\t}\n\t\telse {\n\t\t\treturn this.show(duration);\n\t\t}\n\t}\n\n\t/**\n\t * Shows currently hidden element and returns a `Promise` which completes\n\t * when all showing animations are finished.\n\t *\n\t * ```TypeScript\n\t * series.show().then(function(ev) {\n\t *   console.log(\"Series is now fully visible\");\n\t * })\n\t * ```\n\t * ```JavaScript\n\t * series.show().then(function(ev) {\n\t *   console.log(\"Series is now fully visible\");\n\t * })\n\t * ```\n\t *\n\t * @return Promise\n\t */\n\tpublic async show(duration?: number): Promise<void> {\n\t\tif (!this._isShowing) {\n\t\t\tthis._isHidden = false;\n\t\t\tthis._isShowing = true;\n\t\t\tthis._isHiding = false;\n\n\t\t\tif (this.states.lookup(\"default\")!.get(\"visible\")) {\n\t\t\t\tthis.set(\"visible\", true);\n\t\t\t}\n\t\t\tthis._onShow(duration);\n\n\t\t\tconst animations = this.states.applyAnimate(\"default\", duration);\n\t\t\tawait waitForAnimations(animations);\n\n\t\t\tthis._isShowing = false;\n\t\t}\n\t}\n\n\t/**\n\t * Hides the element and returns a `Promise` which completes when all hiding\n\t * animations are finished.\n\t *\n\t * ```TypeScript\n\t * series.hide().then(function(ev) {\n\t *   console.log(\"Series finished hiding\");\n\t * })\n\t * ```\n\t * ```JavaScript\n\t * series.hide().then(function(ev) {\n\t *   console.log(\"Series finished hiding\");\n\t * })\n\t * ```\n\t *\n\t * @return Promise\n\t */\n\tpublic async hide(duration?: number): Promise<void> {\n\t\tif (!this._isHiding && !this._isHidden) {\n\t\t\tthis._isHiding = true;\n\t\t\tthis._isShowing = false;\n\t\t\tlet state = this.states.lookup(\"hidden\");\n\t\t\tif (!state) {\n\t\t\t\tstate = this.states.create(\"hidden\", {\n\t\t\t\t\t\"opacity\": 0,\n\t\t\t\t\t\"visible\": false\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis._isHidden = true;\n\t\t\tthis._onHide(duration);\n\n\t\t\tconst animations = this.states.applyAnimate(\"hidden\", duration);\n\n\t\t\tawait waitForAnimations(animations);\n\n\t\t\tthis._isHiding = false;\n\t\t}\n\t}\n\n\t/**\n\t * Returns `true` if this element is currently hidden.\n\t *\n\t * @return Is hidden?\n\t */\n\tpublic isHidden(): boolean {\n\t\treturn this._isHidden;\n\t}\n\n\t/**\n\t * Returns `true` if this element is currently animating to a default state.\n\t *\n\t * @return Is showing?\n\t */\n\tpublic isShowing(): boolean {\n\t\treturn this._isShowing;\n\t}\n\n\t/**\n\t * Returns `true` if this element is currently animating to a hidden state.\n\t *\n\t * @return Is hiding?\n\t */\n\tpublic isHiding(): boolean {\n\t\treturn this._isHiding;\n\t}\n\n\t/**\n\t * Returns `true` if this element is currently hovered by a pointer.\n\t *\n\t * @return Is hovered?\n\t */\n\tpublic isHover(): boolean {\n\t\treturn this._display.hovering();\n\t}\n\n\t/**\n\t * Returns `true` if this element does currently have focus.\n\t *\n\t * @return Is focused?\n\t */\n\tpublic isFocus(): boolean {\n\t\treturn this._root.focused(this);\n\t}\n\n\t/**\n\t * Returns `true` if this element is currently being dragged.\n\t *\n\t * @return Is dragged?\n\t */\n\tpublic isDragging(): boolean {\n\t\treturn this._isDragging;\n\t}\n\n\t/**\n\t * Returns `false` if if either public or private setting `visible` is set\n\t * to `false`, or `forceHidden` is set to `true`.\n\t * \n\t * @return Visible?\n\t */\n\tpublic isVisible(): boolean {\n\t\tif (this.get(\"visible\") && this.getPrivate(\"visible\") && !this.get(\"forceHidden\")) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Same as `isVisible()`, except it checks all ascendants, too.\n\t *\n\t * @since 5.2.7\n\t * @return Visible?\n\t */\n\tpublic isVisibleDeep(): boolean {\n\t\treturn this._parent ? (this._parent.isVisibleDeep() && this.isVisible()) : this.isVisible();\n\t}\n\n\t/**\n\t * Returns width of this element in pixels.\n\t *\n\t * @return Width (px)\n\t */\n\tpublic width(): number {\n\t\tlet width = this.get(\"width\");\n\t\tlet maxWidth = this.get(\"maxWidth\");\n\t\tlet minWidth = this.get(\"minWidth\");\n\t\tlet privateWidth = this.getPrivate(\"width\");\n\t\tlet w = 0;\n\n\t\tif ($type.isNumber(privateWidth)) {\n\t\t\tw = privateWidth;\n\t\t}\n\t\telse {\n\t\t\tif (width == null) {\n\t\t\t\tif (this._adjustedLocalBounds) {\n\t\t\t\t\tw = this._adjustedLocalBounds.right - this._adjustedLocalBounds.left;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (width instanceof Percent) {\n\t\t\t\t\tconst parent = this.parent;\n\t\t\t\t\tif (parent) {\n\t\t\t\t\t\tw = parent.innerWidth() * width.value;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tw = this._root.width() * width.value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if ($type.isNumber(width)) {\n\t\t\t\t\tw = width;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ($type.isNumber(minWidth)) {\n\t\t\tw = Math.max(minWidth, w);\n\t\t}\n\t\tif ($type.isNumber(maxWidth)) {\n\t\t\tw = Math.min(maxWidth, w);\n\t\t}\n\n\t\treturn w;\n\t}\n\n\t/**\n\t * Returns maximum allowed width of this element in pixels.\n\t *\n\t * @return Maximum width (px)\n\t */\n\tpublic maxWidth(): number {\n\t\tlet maxWidth = this.get(\"maxWidth\");\n\t\tif ($type.isNumber(maxWidth)) {\n\t\t\treturn maxWidth;\n\t\t}\n\t\telse {\n\t\t\tlet width = this.get(\"width\")\n\t\t\tif ($type.isNumber(width)) {\n\t\t\t\treturn width;\n\t\t\t}\n\t\t}\n\t\tconst parent = this.parent;\n\t\tif (parent) {\n\t\t\treturn parent.innerWidth();\n\t\t}\n\t\treturn this._root.width();\n\t}\n\n\t/**\n\t * Returns maximum allowed height of this element in pixels.\n\t *\n\t * @return Maximum height (px)\n\t */\n\tpublic maxHeight(): number {\n\t\tlet maxHeight = this.get(\"maxHeight\");\n\t\tif ($type.isNumber(maxHeight)) {\n\t\t\treturn maxHeight;\n\t\t}\n\t\telse {\n\t\t\tlet height = this.get(\"height\")\n\t\t\tif ($type.isNumber(height)) {\n\t\t\t\treturn height;\n\t\t\t}\n\t\t}\n\t\tconst parent = this.parent;\n\t\tif (parent) {\n\t\t\treturn parent.innerHeight();\n\t\t}\n\t\treturn this._root.height();\n\t}\n\n\t/**\n\t * Returns height of this element in pixels.\n\t *\n\t * @return Height (px)\n\t */\n\tpublic height(): number {\n\t\tlet height = this.get(\"height\");\n\t\tlet maxHeight = this.get(\"maxHeight\");\n\t\tlet minHeight = this.get(\"minHeight\");\n\t\tlet privateHeight = this.getPrivate(\"height\");\n\t\tlet h = 0;\n\n\t\tif ($type.isNumber(privateHeight)) {\n\t\t\th = privateHeight;\n\t\t}\n\t\telse {\n\t\t\tif (height == null) {\n\t\t\t\tif (this._adjustedLocalBounds) {\n\t\t\t\t\th = this._adjustedLocalBounds.bottom - this._adjustedLocalBounds.top;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (height instanceof Percent) {\n\t\t\t\t\tconst parent = this.parent;\n\t\t\t\t\tif (parent) {\n\t\t\t\t\t\th = parent.innerHeight() * height.value;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\th = this._root.height() * height.value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if ($type.isNumber(height)) {\n\t\t\t\t\th = height;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ($type.isNumber(minHeight)) {\n\t\t\th = Math.max(minHeight, h);\n\t\t}\n\t\tif ($type.isNumber(maxHeight)) {\n\t\t\th = Math.min(maxHeight, h);\n\t\t}\n\n\t\treturn h;\n\t}\n\n\tprotected _findStaticTemplate(f: (template: Template<this>) => boolean): Template<this> | undefined {\n\t\t// templateField overrides template\n\t\tif (this._templateField && f(this._templateField)) {\n\t\t\treturn this._templateField;\n\t\t}\n\n\t\treturn super._findStaticTemplate(f);\n\t}\n\n\tprotected _walkParents(f: (parent: Sprite) => void): void {\n\t\tif (this._parent) {\n\t\t\tthis._walkParent(f);\n\t\t}\n\t}\n\n\tprotected _walkParent(f: (parent: Sprite) => void): void {\n\t\tif (this._parent) {\n\t\t\tthis._parent._walkParent(f);\n\t\t}\n\n\t\tf(this);\n\t}\n\n\t/**\n\t * Parent [[Container]] of this element.\n\t *\n\t * @return Parent container\n\t */\n\tpublic get parent(): Container | undefined {\n\t\treturn this._parent;\n\t}\n\n\tpublic _setParent(parent: Container, updateChildren: boolean = false) {\n\t\tconst prevParent = this._parent;\n\t\tif (parent !== prevParent) {\n\t\t\tthis.markDirtyBounds();\n\n\t\t\tparent.markDirty();\n\n\t\t\tthis._parent = parent;\n\n\t\t\tif (updateChildren) {\n\t\t\t\tthis._removeParent(prevParent);\n\n\t\t\t\tif (parent) {\n\t\t\t\t\tthis._addPercentageSizeChildren();\n\t\t\t\t\tthis._addPercentagePositionChildren();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.markDirtyPosition();\n\t\t\tthis._applyThemes();\n\t\t}\n\t}\n\n\t/**\n\t * Returns an instance of [[NumberFormatter]] used in this element.\n\t *\n\t * If this element does not have it set, global one form [[Root]] is used.\n\t *\n\t * @see {@link https://www.amcharts.com/docs/v5/concepts/using-formatters/} for more info\n\t * @return NumberFormatter instace\n\t */\n\tpublic getNumberFormatter(): NumberFormatter {\n\t\treturn this.get(\"numberFormatter\", this._root.numberFormatter);\n\t}\n\n\t/**\n\t * Returns an instance of [[DateFormatter]] used in this element.\n\t *\n\t * If this element does not have it set, global one form [[Root]] is used.\n\t *\n\t * @see {@link https://www.amcharts.com/docs/v5/concepts/using-formatters/} for more info\n\t * @return DateFormatter instace\n\t */\n\tpublic getDateFormatter(): DateFormatter {\n\t\treturn this.get(\"dateFormatter\", this._root.dateFormatter);\n\t}\n\n\t/**\n\t * Returns an instance of [[DurationFormatter]] used in this element.\n\t *\n\t * If this element does not have it set, global one form [[Root]] is used.\n\t *\n\t * @see {@link https://www.amcharts.com/docs/v5/concepts/using-formatters/} for more info\n\t * @return DurationFormatter instace\n\t */\n\tpublic getDurationFormatter(): DurationFormatter {\n\t\treturn this.get(\"durationFormatter\", this._root.durationFormatter);\n\t}\n\n\t/**\n\t * Converts X/Y coordinate within this element to a global coordinate.\n\t *\n\t * @param  point  Local coordinate\n\t * @return        Global coordinate\n\t */\n\tpublic toGlobal(point: IPoint): IPoint {\n\t\treturn this._display.toGlobal(point);\n\t}\n\n\t/**\n\t * Converts global X/Y coordinate to a coordinate within this element.\n\t *\n\t * @param  point  Global coordinate\n\t * @return        Local coordinate\n\t */\n\tpublic toLocal(point: IPoint): IPoint {\n\t\treturn this._display.toLocal(point);\n\t}\n\n\tpublic _getDownPoint(): IPoint | undefined {\n\t\tconst id = this._getDownPointId();\n\t\tif (id) {\n\t\t\treturn this._downPoints[id];\n\t\t}\n\n\t}\n\n\tpublic _getDownPointId(): number | undefined {\n\t\tif (this._downPoints) {\n\t\t\treturn $object.keysOrdered(this._downPoints, (a, b) => {\n\t\t\t\tif (a > b) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t\tif (a < b) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t})[0];\n\t\t}\n\t}\n\n\t/**\n\t * Moves sprite to the end of the parent's children array.\n\t *\n\t * Depending on `layout` setting of the parten container, it may effect the\n\t * positioning or overlapping order of the elements.\n\t */\n\tpublic toFront() {\n\t\tconst parent = this.parent;\n\t\tif (parent) {\n\t\t\tparent.children.moveValue(this, parent.children.length - 1);\n\t\t}\n\t}\n\n\t/**\n\t * Moves sprite to the beginning of the parent's children array.\n\t *\n\t * Depending on `layout` setting of the parten container, it may effect the\n\t * positioning or overlapping order of the elements.\n\t */\n\tpublic toBack() {\n\t\tconst parent = this.parent;\n\t\tif (parent) {\n\t\t\tparent.children.moveValue(this, 0);\n\t\t}\n\t}\n\n}\n"]},"metadata":{},"sourceType":"module"}