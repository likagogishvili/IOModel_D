{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { Entity } from \"./Entity\";\nimport { Color } from \"./Color\";\nimport * as $type from \"./Type\";\nimport * as $object from \"./Object\";\nimport * as $array from \"./Array\";\n/**\r\n * A tool that can process the data before it is being used in charts.\r\n *\r\n * @see {@link https://www.amcharts.com/docs/v5/concepts/data/#Pre_processing_data} for more info\r\n * @important\r\n */\n\nvar DataProcessor =\n/** @class */\nfunction (_super) {\n  __extends(DataProcessor, _super);\n\n  function DataProcessor() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    Object.defineProperty(_this, \"_checkDates\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: false\n    });\n    Object.defineProperty(_this, \"_checkNumbers\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: false\n    });\n    Object.defineProperty(_this, \"_checkColors\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: false\n    });\n    Object.defineProperty(_this, \"_checkEmpty\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: false\n    });\n    Object.defineProperty(_this, \"_checkDeep\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: false\n    });\n    return _this;\n  }\n\n  Object.defineProperty(DataProcessor.prototype, \"_afterNew\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var _this = this;\n\n      _super.prototype._afterNew.call(this);\n\n      this._checkFeatures();\n\n      this.on(\"dateFields\", function () {\n        return _this._checkFeatures();\n      });\n      this.on(\"dateFormat\", function () {\n        return _this._checkFeatures();\n      });\n      this.on(\"numericFields\", function () {\n        return _this._checkFeatures();\n      });\n      this.on(\"colorFields\", function () {\n        return _this._checkFeatures();\n      });\n      this.on(\"emptyAs\", function () {\n        return _this._checkFeatures();\n      });\n    }\n  });\n  Object.defineProperty(DataProcessor.prototype, \"_checkFeatures\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      if (this.isDirty(\"dateFields\") || this.isDirty(\"dateFormat\")) {\n        this._checkDates = this.get(\"dateFields\") && this.get(\"dateFields\").length > 0;\n      }\n\n      if (this.isDirty(\"numericFields\")) {\n        this._checkNumbers = this.get(\"numericFields\") && this.get(\"numericFields\").length > 0;\n      }\n\n      if (this.isDirty(\"colorFields\")) {\n        this._checkColors = this.get(\"colorFields\") && this.get(\"colorFields\").length > 0;\n      }\n\n      if (this.isDirty(\"emptyAs\")) {\n        this._checkEmpty = this.get(\"emptyAs\") != null;\n      }\n\n      this._checkDeepFeatures();\n    }\n  });\n  Object.defineProperty(DataProcessor.prototype, \"_checkDeepFeatures\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var _this = this;\n\n      var deepFields = [];\n      $array.each([\"dateFields\", \"numericFields\", \"colorFields\"], function (where) {\n        $array.each(_this.get(where, []), function (field) {\n          var steps = field.split(\".\");\n          steps.pop();\n\n          while (steps.length > 0) {\n            deepFields.push(steps.join(\".\"));\n            steps.pop();\n          }\n        });\n      });\n      this._checkDeep = deepFields.length > 0;\n      this.setPrivate(\"deepFields\", deepFields);\n    }\n  });\n  /**\r\n   * Processess entire array of data.\r\n   *\r\n   * NOTE: calling this will modify original array!\r\n   */\n\n  Object.defineProperty(DataProcessor.prototype, \"processMany\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (data) {\n      var _this = this;\n\n      if ($type.isArray(data) && (this._checkDates || this._checkNumbers || this._checkColors || this._checkEmpty)) {\n        $array.each(data, function (row) {\n          _this.processRow(row);\n        });\n      }\n    }\n  });\n  /**\r\n   * Processes a row (object) of data.\r\n   *\r\n   * NOTE: calling this will modify values of the original object!\r\n   */\n\n  Object.defineProperty(DataProcessor.prototype, \"processRow\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (row, prefix) {\n      var _this = this;\n\n      if (prefix === void 0) {\n        prefix = \"\";\n      }\n\n      $object.each(row, function (key, _value) {\n        var lookupKey = prefix + key;\n\n        if (_this._checkEmpty) {\n          row[key] = _this._maybeToEmpty(row[key]);\n        }\n\n        if (_this._checkNumbers) {\n          row[key] = _this._maybeToNumber(lookupKey, row[key]);\n        }\n\n        if (_this._checkDates) {\n          row[key] = _this._maybeToDate(lookupKey, row[key]);\n        }\n\n        if (_this._checkColors) {\n          row[key] = _this._maybeToColor(lookupKey, row[key]);\n        }\n\n        if (_this._checkDeep && _this.getPrivate(\"deepFields\", []).indexOf(lookupKey) !== -1 && $type.isObject(row[key])) {\n          _this.processRow(row[key], lookupKey + \".\");\n        }\n      });\n    }\n  });\n  Object.defineProperty(DataProcessor.prototype, \"_maybeToNumber\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (field, value) {\n      if (this.get(\"numericFields\").indexOf(field) !== -1) {\n        return $type.toNumber(value);\n      }\n\n      return value;\n    }\n  });\n  Object.defineProperty(DataProcessor.prototype, \"_maybeToDate\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (field, value) {\n      if (this.get(\"dateFields\").indexOf(field) !== -1) {\n        return this._root.dateFormatter.parse(value, this.get(\"dateFormat\", \"\")).getTime();\n      }\n\n      return value;\n    }\n  });\n  Object.defineProperty(DataProcessor.prototype, \"_maybeToEmpty\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (value) {\n      if ((value == null || value == \"\") && this.get(\"emptyAs\") != null) {\n        return this.get(\"emptyAs\");\n      }\n\n      return value;\n    }\n  });\n  Object.defineProperty(DataProcessor.prototype, \"_maybeToColor\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (field, value) {\n      if (this.get(\"colorFields\").indexOf(field) !== -1) {\n        return Color.fromAny(value);\n      }\n\n      return value;\n    }\n  });\n  return DataProcessor;\n}(Entity);\n\nexport { DataProcessor };","map":{"version":3,"mappings":"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","names":["Entity","Color","$type","$object","$array","__extends","Object","_super","_afterNew","call","_checkFeatures","on","isDirty","_checkDates","get","length","_checkNumbers","_checkColors","_checkEmpty","_checkDeepFeatures","deepFields","each","where","_this","field","steps","split","pop","push","join","_checkDeep","setPrivate","data","isArray","row","processRow","prefix","key","_value","lookupKey","_maybeToEmpty","_maybeToNumber","_maybeToDate","_maybeToColor","getPrivate","indexOf","isObject","value","toNumber","_root","dateFormatter","parse","getTime","fromAny"],"sourceRoot":"","sources":["../../../../../src/.internal/core/util/DataProcessor.ts"],"sourcesContent":["import { Entity, IEntitySettings, IEntityPrivate, IEntityEvents } from \"./Entity\"\nimport { Color } from \"./Color\"\nimport * as $type from \"./Type\"\nimport * as $object from \"./Object\"\nimport * as $array from \"./Array\"\n\n\nexport interface IDataProcessorSettings extends IEntitySettings {\n\n\t/**\n\t * Date format used for parsing string-based dates.\n\t */\n\tdateFormat?: string;\n\n\t/**\n\t * A list of fields in data that need to be converted to tiemstamps.\n\t */\n\tdateFields?: string[];\n\n\t/**\n\t * A list of fields in data that need to be converted to numbers.\n\t */\n\tnumericFields?: string[];\n\n\t/**\n\t * A list of fields in data that need to be converted to [[Color]] objects.\n\t */\n\tcolorFields?: string[];\n\n\t/**\n\t * Replace empty values with this.\n\t */\n\temptyAs?: any;\n\n}\n\nexport interface IDataProcessorPrivate extends IEntityPrivate {\n\n\t/**\n\t * @ignore\n\t */\n\tdeepFields?: string[];\n}\n\nexport interface IDataProcessorEvents extends IEntityEvents {\n}\n\n/**\n * A tool that can process the data before it is being used in charts.\n *\n * @see {@link https://www.amcharts.com/docs/v5/concepts/data/#Pre_processing_data} for more info\n * @important\n */\nexport class DataProcessor extends Entity {\n\tdeclare public _settings: IDataProcessorSettings;\n\tdeclare public _privateSettings: IDataProcessorPrivate;\n\n\tprotected _checkDates: boolean = false;\n\tprotected _checkNumbers: boolean = false;\n\tprotected _checkColors: boolean = false;\n\tprotected _checkEmpty: boolean = false;\n\tprotected _checkDeep: boolean = false;\n\n\tprotected _afterNew() {\n\t\tsuper._afterNew();\n\t\tthis._checkFeatures();\n\t\tthis.on(\"dateFields\", () => this._checkFeatures());\n\t\tthis.on(\"dateFormat\", () => this._checkFeatures());\n\t\tthis.on(\"numericFields\", () => this._checkFeatures());\n\t\tthis.on(\"colorFields\", () => this._checkFeatures());\n\t\tthis.on(\"emptyAs\", () => this._checkFeatures());\n\t}\n\n\tprotected _checkFeatures(): void {\n\t\tif (this.isDirty(\"dateFields\") || this.isDirty(\"dateFormat\")) {\n\t\t\tthis._checkDates = this.get(\"dateFields\") && (this.get(\"dateFields\")!.length > 0);\n\t\t}\n\t\tif (this.isDirty(\"numericFields\")) {\n\t\t\tthis._checkNumbers = this.get(\"numericFields\") && (this.get(\"numericFields\")!.length > 0);\n\t\t}\n\t\tif (this.isDirty(\"colorFields\")) {\n\t\t\tthis._checkColors = this.get(\"colorFields\") && (this.get(\"colorFields\")!.length > 0);\n\t\t}\n\t\tif (this.isDirty(\"emptyAs\")) {\n\t\t\tthis._checkEmpty = this.get(\"emptyAs\") != null;\n\t\t}\n\t\tthis._checkDeepFeatures();\n\t}\n\n\tprotected _checkDeepFeatures(): void {\n\t\tconst deepFields: string[] = [];\n\t\t$array.each([\"dateFields\", \"numericFields\", \"colorFields\"], (where: any) => {\n\t\t\t$array.each(this.get(where, []), (field) => {\n\t\t\t\tconst steps = (<string>field).split(\".\");\n\t\t\t\tsteps.pop();\n\t\t\t\twhile (steps.length > 0) {\n\t\t\t\t\tdeepFields.push(steps.join(\".\"));\n\t\t\t\t\tsteps.pop();\n\t\t\t\t}\n\t\t\t});\n\t\t})\n\t\tthis._checkDeep = deepFields.length > 0;\n\t\tthis.setPrivate(\"deepFields\", deepFields);\n\t}\n\n\t/**\n\t * Processess entire array of data.\n\t *\n\t * NOTE: calling this will modify original array!\n\t */\n\tpublic processMany(data: { [index: string]: any }[]): void {\n\t\tif ($type.isArray(data) && (this._checkDates || this._checkNumbers || this._checkColors || this._checkEmpty)) {\n\t\t\t$array.each(data, (row) => {\n\t\t\t\tthis.processRow(row);\n\t\t\t})\n\t\t}\n\t}\n\n\t/**\n\t * Processes a row (object) of data.\n\t * \n\t * NOTE: calling this will modify values of the original object!\n\t */\n\tpublic processRow(row: { [index: string]: any }, prefix: string = \"\"): void {\n\t\t$object.each(row, (key: any, _value) => {\n\t\t\tconst lookupKey: string = prefix + key;\n\t\t\tif (this._checkEmpty) {\n\t\t\t\trow[key] = this._maybeToEmpty(row[key]);\n\t\t\t}\n\t\t\tif (this._checkNumbers) {\n\t\t\t\trow[key] = this._maybeToNumber(lookupKey, row[key]);\n\t\t\t}\n\t\t\tif (this._checkDates) {\n\t\t\t\trow[key] = this._maybeToDate(lookupKey, row[key]);\n\t\t\t}\n\t\t\tif (this._checkColors) {\n\t\t\t\trow[key] = this._maybeToColor(lookupKey, row[key]);\n\t\t\t}\n\t\t\tif (this._checkDeep && (<any>this).getPrivate(\"deepFields\", []).indexOf(lookupKey) !== -1 && $type.isObject(row[key])) {\n\t\t\t\tthis.processRow(row[key], lookupKey + \".\");\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected _maybeToNumber(field: string, value: any): any {\n\t\tif (this.get(\"numericFields\")!.indexOf(field) !== -1) {\n\t\t\treturn $type.toNumber(value);\n\t\t}\n\t\treturn value;\n\t}\n\n\tprotected _maybeToDate(field: string, value: any): any {\n\t\tif (this.get(\"dateFields\")!.indexOf(field) !== -1) {\n\t\t\treturn this._root.dateFormatter.parse(value, this.get(\"dateFormat\", \"\")).getTime();\n\t\t}\n\t\treturn value;\n\t}\n\n\tprotected _maybeToEmpty(value: any): any {\n\t\tif ((value == null || value == \"\") && this.get(\"emptyAs\") != null) {\n\t\t\treturn this.get(\"emptyAs\");\n\t\t}\n\t\treturn value;\n\t}\n\n\tprotected _maybeToColor(field: string, value: any): any {\n\t\tif (this.get(\"colorFields\")!.indexOf(field) !== -1) {\n\t\t\treturn Color.fromAny(value);\n\t\t}\n\t\treturn value;\n\t}\n\n}\n"]},"metadata":{},"sourceType":"module"}