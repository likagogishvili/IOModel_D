{"ast":null,"code":"/**\r\n * SankeyLink module\r\n */\nimport { __extends, __read } from \"tslib\";\nimport { FlowDiagramLink } from \"./FlowDiagramLink\";\nimport { registry } from \"../../core/Registry\";\nimport { Polyspline } from \"../../core/elements/Polyspline\";\nimport { InterfaceColorSet } from \"../../core/utils/InterfaceColorSet\";\nimport * as $math from \"../../core/utils/Math\";\nimport * as $type from \"../../core/utils/Type\";\nimport * as $smoothing from \"../../core/rendering/Smoothing\";\nimport * as $path from \"../../core/rendering/Path\";\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\n\n/**\r\n * This class creates a link (waved color-filled line) between two nodes in a\r\n * Sankey Diagram.\r\n *\r\n * @see {@link ISankeyLinkEvents} for a list of available events\r\n * @see {@link ISankeyLinkAdapters} for a list of available Adapters\r\n * @important\r\n */\n\nvar SankeyLink =\n/** @class */\nfunction (_super) {\n  __extends(SankeyLink, _super);\n  /**\r\n   * Constructor\r\n   */\n\n\n  function SankeyLink() {\n    var _this = _super.call(this) || this;\n\n    _this.className = \"SankeyLink\"; // TODO can this be removed ?\n\n    new InterfaceColorSet();\n    _this.tension = 0.8;\n    _this.controlPointDistance = 0.2;\n    _this.startAngle = 0;\n    _this.endAngle = 0;\n    _this.linkWidth = 0;\n    _this.startX = 0;\n    _this.endX = 0;\n    _this.startY = 0;\n    _this.endY = 0;\n    _this.middleLine = _this.createChild(Polyspline);\n    _this.middleLine.shouldClone = false;\n    _this.middleLine.strokeOpacity = 0;\n\n    _this.applyTheme();\n\n    return _this;\n  }\n\n  SankeyLink.prototype.makeBackwards = function () {\n    if (this.states.getKey(\"backwards\") != undefined) {\n      this.setState(\"backwards\");\n    }\n  };\n  /**\r\n   * (Re)validates (redraws) the link.\r\n   *\r\n   * @ignore Exclude from docs\r\n   */\n\n\n  SankeyLink.prototype.validate = function () {\n    var _a, _b, _c, _d;\n\n    _super.prototype.validate.call(this);\n\n    if (!this.isTemplate) {\n      var x0 = this.startX;\n      var y0 = this.startY;\n      var x1 = this.endX;\n      var y1 = this.endY;\n\n      if (this.states.getKey(\"backwards\")) {\n        this.setState(\"default\");\n      }\n\n      if (this.dataItem) {\n        var chart = this.dataItem.component;\n\n        if (chart) {\n          if (chart.orientation == \"horizontal\") {\n            if (x1 < x0) {\n              _a = __read([x1, x0], 2), x0 = _a[0], x1 = _a[1];\n              _b = __read([y1, y0], 2), y0 = _b[0], y1 = _b[1];\n              this.makeBackwards();\n            }\n          } else {\n            if (y1 < y0) {\n              _c = __read([y1, y0], 2), y0 = _c[0], y1 = _c[1];\n              _d = __read([x1, x0], 2), x0 = _d[0], x1 = _d[1];\n              this.makeBackwards();\n            }\n          }\n        }\n      }\n\n      if (!$type.isNumber(x1)) {\n        x1 = x0;\n      }\n\n      if (!$type.isNumber(y1)) {\n        y1 = y0;\n      }\n\n      var startAngle = this.startAngle;\n      var endAngle = this.endAngle;\n      var w = this.linkWidth;\n      var path = \"\";\n      var xt0 = x0;\n      var yt0 = y0;\n      var xt1 = x1;\n      var yt1 = y1;\n      var xb0 = x0 + w * $math.sin(startAngle);\n      var xb1 = x1 + w * $math.sin(endAngle);\n      var yb0 = y0 + w * $math.cos(startAngle);\n      var yb1 = y1 + w * $math.cos(endAngle);\n      var xm0 = x0 + w / 2 * $math.sin(startAngle);\n      var xm1 = x1 + w / 2 * $math.sin(endAngle);\n      var ym0 = y0 + w / 2 * $math.cos(startAngle);\n      var ym1 = y1 + w / 2 * $math.cos(endAngle);\n      this.zIndex = this.zIndex || this.dataItem.index;\n      var tensionX = this.tension + (1 - this.tension) * $math.sin(startAngle);\n      var tensionY = this.tension + (1 - this.tension) * $math.cos(startAngle);\n      this.middleLine.tensionX = tensionX;\n      this.middleLine.tensionY = tensionY;\n\n      if ($type.isNumber(w) && $type.isNumber(x0) && $type.isNumber(x1) && $type.isNumber(y0) && $type.isNumber(y1)) {\n        // solves issues with gradient fill of straight lines\n        if ($math.round(xt0, 3) == $math.round(xt1, 3)) {\n          xt1 += 0.01;\n        }\n\n        if ($math.round(yt0, 3) == $math.round(yt1, 3)) {\n          yt1 += 0.01;\n        }\n\n        if ($math.round(xb0, 3) == $math.round(xb1, 3)) {\n          xb1 += 0.01;\n        }\n\n        if ($math.round(yb0, 3) == $math.round(yb1, 3)) {\n          yb1 += 0.01;\n        }\n\n        var minX = Math.min(xb0, xb1, xt0, xt1);\n        var minY = Math.min(yb0, yb1, yt0, yt1);\n        var maxX = Math.max(xb0, xb1, xt0, xt1);\n        var maxY = Math.max(yb0, yb1, yt0, yt1);\n        this._bbox = {\n          x: minX,\n          y: minY,\n          width: maxX - minX,\n          height: maxY - minY\n        };\n        var cpd = this.controlPointDistance;\n        var kxt0 = xt0 + (xt1 - xt0) * cpd * $math.cos(startAngle);\n        var kyt0 = yt0 + (yt1 - yt0) * cpd * $math.sin(startAngle);\n        var kxt1 = xt1 - (xt1 - xt0) * cpd * $math.cos(endAngle);\n        var kyt1 = yt1 - (yt1 - yt0) * cpd * $math.sin(endAngle);\n        var kxm0 = xm0 + (xm1 - xm0) * cpd * $math.cos(startAngle);\n        var kym0 = ym0 + (ym1 - ym0) * cpd * $math.sin(startAngle);\n        var kxm1 = xm1 - (xm1 - xm0) * cpd * $math.cos(endAngle);\n        var kym1 = ym1 - (ym1 - ym0) * cpd * $math.sin(endAngle);\n        var angle = $math.getAngle({\n          x: kxt0,\n          y: kyt0\n        }, {\n          x: kxt1,\n          y: kyt1\n        });\n        var dx = (w / $math.cos(angle) - w) / $math.tan(angle) * $math.cos(startAngle);\n        var dy = (w / $math.sin(angle) - w) * $math.tan(angle) * $math.sin(startAngle);\n        var kxb0 = -dx / 2 + xb0 + (xb1 - xb0) * cpd * $math.cos(startAngle);\n        var kyb0 = -dy / 2 + yb0 + (yb1 - yb0) * cpd * $math.sin(startAngle);\n        var kxb1 = -dx / 2 + xb1 - (xb1 - xb0) * cpd * $math.cos(endAngle);\n        var kyb1 = -dy / 2 + yb1 - (yb1 - yb0) * cpd * $math.sin(endAngle);\n        this.middleLine.segments = [[{\n          x: xm0,\n          y: ym0\n        }, {\n          x: kxm0,\n          y: kym0\n        }, {\n          x: kxm1,\n          y: kym1\n        }, {\n          x: xm1,\n          y: ym1\n        }]];\n        kxt0 += dx / 2;\n        kyt0 += dy / 2;\n        kxt1 += dx / 2;\n        kyt1 += dy / 2;\n        path += $path.moveTo({\n          x: xt0,\n          y: yt0\n        });\n        path += new $smoothing.Tension(tensionX, tensionY).smooth([{\n          x: xt0,\n          y: yt0\n        }, {\n          x: kxt0,\n          y: kyt0\n        }, {\n          x: kxt1,\n          y: kyt1\n        }, {\n          x: xt1,\n          y: yt1\n        }]);\n        path += $path.lineTo({\n          x: xb1,\n          y: yb1\n        });\n        path += new $smoothing.Tension(tensionX, tensionY).smooth([{\n          x: xb1,\n          y: yb1\n        }, {\n          x: kxb1,\n          y: kyb1\n        }, {\n          x: kxb0,\n          y: kyb0\n        }, {\n          x: xb0,\n          y: yb0\n        }]);\n        path += $path.closePath();\n      }\n\n      this.link.path = path;\n\n      if (this.maskBullets) {\n        this.bulletsMask.path = path;\n        this.bulletsContainer.mask = this.bulletsMask;\n      }\n\n      this.positionBullets();\n    }\n  };\n\n  Object.defineProperty(SankeyLink.prototype, \"startX\", {\n    /**\r\n     * @return Start X\r\n     */\n    get: function () {\n      return this.getPropertyValue(\"startX\");\n    },\n\n    /**\r\n     * [startX description]\r\n     *\r\n     * @todo Description\r\n     * @param value  Start X\r\n     */\n    set: function (value) {\n      this.setPropertyValue(\"startX\", value, true);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SankeyLink.prototype, \"endX\", {\n    /**\r\n     * @return End X\r\n     */\n    get: function () {\n      return this.getPropertyValue(\"endX\");\n    },\n\n    /**\r\n     * [endX description]\r\n     *\r\n     * @todo Description\r\n     * @param value  End X\r\n     */\n    set: function (value) {\n      this.setPropertyValue(\"endX\", value, true);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SankeyLink.prototype, \"startY\", {\n    /**\r\n     * @return Start Y\r\n     */\n    get: function () {\n      return this.getPropertyValue(\"startY\");\n    },\n\n    /**\r\n     * [startY description]\r\n     *\r\n     * @todo Description\r\n     * @param value  Start Y\r\n     */\n    set: function (value) {\n      this.setPropertyValue(\"startY\", value, true);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SankeyLink.prototype, \"endY\", {\n    /**\r\n     * @return End Y\r\n     */\n    get: function () {\n      return this.getPropertyValue(\"endY\");\n    },\n\n    /**\r\n     * [endY description]\r\n     *\r\n     * @todo Description\r\n     * @param value End Y\r\n     */\n    set: function (value) {\n      this.setPropertyValue(\"endY\", value, true);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SankeyLink.prototype, \"linkWidth\", {\n    /**\r\n     * @return [description]\r\n     */\n    get: function () {\n      return this.getPropertyValue(\"linkWidth\");\n    },\n\n    /**\r\n     * [linkWidth description]\r\n     *\r\n     * @todo Description\r\n     * @param value [description]\r\n     */\n    set: function (value) {\n      this.setPropertyValue(\"linkWidth\", value, true);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SankeyLink.prototype, \"controlPointDistance\", {\n    /**\r\n     * @return relative control point distance\r\n     */\n    get: function () {\n      return this.getPropertyValue(\"controlPointDistance\");\n    },\n\n    /**\r\n     * Distance of control point of a link, defines relative distance from a node at which linke should bend\r\n     * @default 0.2\r\n     * @param value\r\n     */\n    set: function (value) {\n      this.setPropertyValue(\"controlPointDistance\", value, true);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(SankeyLink.prototype, \"tension\", {\n    /**\r\n     * @return tension value\r\n     */\n    get: function () {\n      return this.getPropertyValue(\"tension\");\n    },\n\n    /**\r\n     * Tension of a spline, 1 would make the link to have sharp edges\r\n     * @default 0.8\r\n     * @param value\r\n     */\n    set: function (value) {\n      this.setPropertyValue(\"tension\", value, true);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return SankeyLink;\n}(FlowDiagramLink);\n\nexport { SankeyLink };\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\n\nregistry.registeredClasses[\"SankeyLink\"] = SankeyLink;","map":{"version":3,"mappings":"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","names":["FlowDiagramLink","registry","Polyspline","InterfaceColorSet","$math","$type","$smoothing","$path","__extends","_super","_this","className","tension","controlPointDistance","startAngle","endAngle","linkWidth","startX","endX","startY","endY","middleLine","createChild","shouldClone","strokeOpacity","applyTheme","SankeyLink","states","getKey","undefined","setState","validate","call","isTemplate","x0","y0","x1","y1","dataItem","chart","component","orientation","_a","_b","makeBackwards","_c","_d","isNumber","w","path","xt0","yt0","xt1","yt1","xb0","sin","xb1","yb0","cos","yb1","xm0","xm1","ym0","ym1","zIndex","index","tensionX","tensionY","round","minX","Math","min","minY","maxX","max","maxY","_bbox","x","y","width","height","cpd","kxt0","kyt0","kxt1","kyt1","kxm0","kym0","kxm1","kym1","angle","getAngle","dx","tan","dy","kxb0","kyb0","kxb1","kyb1","segments","moveTo","Tension","smooth","lineTo","closePath","link","maskBullets","bulletsMask","bulletsContainer","mask","positionBullets","Object","getPropertyValue","value","setPropertyValue","registeredClasses"],"sourceRoot":"","sources":["../../../../../src/.internal/charts/elements/SankeyLink.ts"],"sourcesContent":["/**\r\n * SankeyLink module\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { SankeyDiagramDataItem, SankeyDiagram } from \"../types/SankeyDiagram\";\r\nimport { FlowDiagramLink, IFlowDiagramLinkAdapters, IFlowDiagramLinkEvents, IFlowDiagramLinkProperties } from \"./FlowDiagramLink\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport { Polyspline } from \"../../core/elements/Polyspline\";\r\nimport { InterfaceColorSet } from \"../../core/utils/InterfaceColorSet\";\r\nimport * as $math from \"../../core/utils/Math\";\r\nimport * as $type from \"../../core/utils/Type\";\r\nimport * as $smoothing from \"../../core/rendering/Smoothing\";\r\nimport * as $path from \"../../core/rendering/Path\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[SankeyLink]].\r\n */\r\nexport interface ISankeyLinkProperties extends IFlowDiagramLinkProperties {\r\n\r\n\t/**\r\n\t * [tension description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\ttension?: number;\r\n\r\n\t/**\r\n\t * [startX description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tstartX?: number;\r\n\r\n\t/**\r\n\t * [startY description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tstartY?: number;\r\n\r\n\t/**\r\n\t * [endX description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tendX?: number;\r\n\r\n\t/**\r\n\t * [endY description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tendY?: number;\r\n\r\n\t/**\r\n\t * [linkWidth description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tlinkWidth?: number;\r\n\r\n\t/**\r\n\t * [controlPointDistance description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tcontrolPointDistance?: number;\r\n}\r\n\r\n/**\r\n * Defines events for [[SankeyLink]].\r\n */\r\nexport interface ISankeyLinkEvents extends IFlowDiagramLinkEvents { }\r\n\r\n/**\r\n * Defines adapters for [[SankeyLink]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface ISankeyLinkAdapters extends IFlowDiagramLinkAdapters, ISankeyLinkProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * This class creates a link (waved color-filled line) between two nodes in a\r\n * Sankey Diagram.\r\n *\r\n * @see {@link ISankeyLinkEvents} for a list of available events\r\n * @see {@link ISankeyLinkAdapters} for a list of available Adapters\r\n * @important\r\n */\r\nexport class SankeyLink extends FlowDiagramLink {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: ISankeyLinkProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: ISankeyLinkAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: ISankeyLinkEvents;\r\n\r\n\t/**\r\n\t * Defines a type of data item used by this class.\r\n\t */\r\n\tpublic _dataItem: SankeyDiagramDataItem;\r\n\r\n\t/**\r\n\t * Spline which goes through the middle of a link, used to calculate bullet and tooltip positions, invisible by default\r\n\t */\r\n\tpublic middleLine: Polyspline;\r\n\r\n\tpublic chart: SankeyDiagram;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"SankeyLink\";\r\n\r\n\t\t// TODO can this be removed ?\r\n\t\tnew InterfaceColorSet();\r\n\r\n\t\tthis.tension = 0.8;\r\n\t\tthis.controlPointDistance = 0.2;\r\n\r\n\t\tthis.startAngle = 0;\r\n\t\tthis.endAngle = 0;\r\n\r\n\t\tthis.linkWidth = 0;\r\n\r\n\t\tthis.startX = 0;\r\n\t\tthis.endX = 0;\r\n\r\n\t\tthis.startY = 0;\r\n\t\tthis.endY = 0;\r\n\r\n\t\tthis.middleLine = this.createChild(Polyspline);\r\n\t\tthis.middleLine.shouldClone = false;\r\n\t\tthis.middleLine.strokeOpacity = 0;\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\tprotected makeBackwards() {\r\n\t\tif (this.states.getKey(\"backwards\") != undefined) {\r\n\t\t\tthis.setState(\"backwards\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)validates (redraws) the link.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validate() {\r\n\t\tsuper.validate();\r\n\r\n\t\tif (!this.isTemplate) {\r\n\r\n\t\t\tlet x0 = this.startX\r\n\t\t\tlet y0 = this.startY;\r\n\t\t\tlet x1 = this.endX;\r\n\t\t\tlet y1 = this.endY;\r\n\r\n\t\t\tif (this.states.getKey(\"backwards\")) {\r\n\t\t\t\tthis.setState(\"default\");\r\n\t\t\t}\r\n\r\n\t\t\tif (this.dataItem) {\r\n\t\t\t\tlet chart = this.dataItem.component;\r\n\r\n\t\t\t\tif (chart) {\r\n\t\t\t\t\tif (chart.orientation == \"horizontal\") {\r\n\t\t\t\t\t\tif (x1 < x0) {\r\n\t\t\t\t\t\t\t[x0, x1] = [x1, x0];\r\n\t\t\t\t\t\t\t[y0, y1] = [y1, y0];\r\n\t\t\t\t\t\t\tthis.makeBackwards();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (y1 < y0) {\r\n\t\t\t\t\t\t\t[y0, y1] = [y1, y0];\r\n\t\t\t\t\t\t\t[x0, x1] = [x1, x0];\r\n\t\t\t\t\t\t\tthis.makeBackwards();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!$type.isNumber(x1)) {\r\n\t\t\t\tx1 = x0;\r\n\t\t\t}\r\n\r\n\t\t\tif (!$type.isNumber(y1)) {\r\n\t\t\t\ty1 = y0;\r\n\t\t\t}\r\n\r\n\t\t\tlet startAngle = this.startAngle;\r\n\t\t\tlet endAngle = this.endAngle;\r\n\t\t\tlet w = this.linkWidth;\r\n\r\n\t\t\tlet path = \"\";\r\n\r\n\t\t\tlet xt0 = x0;\r\n\t\t\tlet yt0 = y0;\r\n\r\n\t\t\tlet xt1 = x1;\r\n\t\t\tlet yt1 = y1;\r\n\r\n\t\t\tlet xb0 = x0 + w * $math.sin(startAngle);\r\n\t\t\tlet xb1 = x1 + w * $math.sin(endAngle);\r\n\r\n\t\t\tlet yb0 = y0 + w * $math.cos(startAngle);\r\n\t\t\tlet yb1 = y1 + w * $math.cos(endAngle);\r\n\r\n\t\t\tlet xm0 = x0 + w / 2 * $math.sin(startAngle);\r\n\t\t\tlet xm1 = x1 + w / 2 * $math.sin(endAngle);\r\n\r\n\t\t\tlet ym0 = y0 + w / 2 * $math.cos(startAngle);\r\n\t\t\tlet ym1 = y1 + w / 2 * $math.cos(endAngle);\r\n\r\n\t\t\tthis.zIndex = this.zIndex || this.dataItem.index;\r\n\r\n\t\t\tlet tensionX = this.tension + (1 - this.tension) * $math.sin(startAngle);\r\n\t\t\tlet tensionY = this.tension + (1 - this.tension) * $math.cos(startAngle);\r\n\r\n\t\t\tthis.middleLine.tensionX = tensionX;\r\n\t\t\tthis.middleLine.tensionY = tensionY;\r\n\r\n\t\t\tif ($type.isNumber(w) && ($type.isNumber(x0) && $type.isNumber(x1) && $type.isNumber(y0) && $type.isNumber(y1))) {\r\n\r\n\t\t\t\t// solves issues with gradient fill of straight lines\r\n\t\t\t\tif ($math.round(xt0, 3) == $math.round(xt1, 3)) {\r\n\t\t\t\t\txt1 += 0.01;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($math.round(yt0, 3) == $math.round(yt1, 3)) {\r\n\t\t\t\t\tyt1 += 0.01;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($math.round(xb0, 3) == $math.round(xb1, 3)) {\r\n\t\t\t\t\txb1 += 0.01;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($math.round(yb0, 3) == $math.round(yb1, 3)) {\r\n\t\t\t\t\tyb1 += 0.01;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet minX = Math.min(xb0, xb1, xt0, xt1);\r\n\t\t\t\tlet minY = Math.min(yb0, yb1, yt0, yt1);\r\n\t\t\t\tlet maxX = Math.max(xb0, xb1, xt0, xt1);\r\n\t\t\t\tlet maxY = Math.max(yb0, yb1, yt0, yt1);\r\n\r\n\t\t\t\tthis._bbox = {\r\n\t\t\t\t\tx: minX,\r\n\t\t\t\t\ty: minY,\r\n\t\t\t\t\twidth: maxX - minX,\r\n\t\t\t\t\theight: maxY - minY\r\n\t\t\t\t};\r\n\r\n\t\t\t\tlet cpd = this.controlPointDistance;\r\n\r\n\t\t\t\tlet kxt0 = xt0 + (xt1 - xt0) * cpd * $math.cos(startAngle);\r\n\t\t\t\tlet kyt0 = yt0 + (yt1 - yt0) * cpd * $math.sin(startAngle);\r\n\r\n\t\t\t\tlet kxt1 = xt1 - (xt1 - xt0) * cpd * $math.cos(endAngle);\r\n\t\t\t\tlet kyt1 = yt1 - (yt1 - yt0) * cpd * $math.sin(endAngle);\r\n\r\n\t\t\t\tlet kxm0 = xm0 + (xm1 - xm0) * cpd * $math.cos(startAngle);\r\n\t\t\t\tlet kym0 = ym0 + (ym1 - ym0) * cpd * $math.sin(startAngle);\r\n\r\n\t\t\t\tlet kxm1 = xm1 - (xm1 - xm0) * cpd * $math.cos(endAngle);\r\n\t\t\t\tlet kym1 = ym1 - (ym1 - ym0) * cpd * $math.sin(endAngle);\r\n\r\n\t\t\t\tlet angle = $math.getAngle({ x: kxt0, y: kyt0 }, { x: kxt1, y: kyt1 });\r\n\r\n\t\t\t\tlet dx = (w / $math.cos(angle) - w) / $math.tan(angle) * $math.cos(startAngle);\r\n\t\t\t\tlet dy = (w / $math.sin(angle) - w) * $math.tan(angle) * $math.sin(startAngle);\r\n\r\n\t\t\t\tlet kxb0 = -dx / 2 + xb0 + (xb1 - xb0) * cpd * $math.cos(startAngle);\r\n\t\t\t\tlet kyb0 = -dy / 2 + yb0 + (yb1 - yb0) * cpd * $math.sin(startAngle);\r\n\r\n\t\t\t\tlet kxb1 = -dx / 2 + xb1 - (xb1 - xb0) * cpd * $math.cos(endAngle);\r\n\t\t\t\tlet kyb1 = -dy / 2 + yb1 - (yb1 - yb0) * cpd * $math.sin(endAngle);\r\n\r\n\r\n\t\t\t\tthis.middleLine.segments = [[{ x: xm0, y: ym0 }, { x: kxm0, y: kym0 }, { x: kxm1, y: kym1 }, { x: xm1, y: ym1 }]];\r\n\r\n\t\t\t\tkxt0 += dx / 2;\r\n\t\t\t\tkyt0 += dy / 2;\r\n\r\n\t\t\t\tkxt1 += dx / 2;\r\n\t\t\t\tkyt1 += dy / 2;\r\n\r\n\t\t\t\tpath += $path.moveTo({ x: xt0, y: yt0 });\r\n\t\t\t\tpath += new $smoothing.Tension(tensionX, tensionY).smooth([{ x: xt0, y: yt0 }, { x: kxt0, y: kyt0 }, { x: kxt1, y: kyt1 }, { x: xt1, y: yt1 }]);\r\n\t\t\t\tpath += $path.lineTo({ x: xb1, y: yb1 });\r\n\t\t\t\tpath += new $smoothing.Tension(tensionX, tensionY).smooth([{ x: xb1, y: yb1 }, { x: kxb1, y: kyb1 }, { x: kxb0, y: kyb0 }, { x: xb0, y: yb0 }]);\r\n\t\t\t\tpath += $path.closePath();\r\n\t\t\t}\r\n\r\n\t\t\tthis.link.path = path;\r\n\r\n\t\t\tif (this.maskBullets) {\r\n\t\t\t\tthis.bulletsMask.path = path;\r\n\t\t\t\tthis.bulletsContainer.mask = this.bulletsMask;\r\n\t\t\t}\r\n\t\t\tthis.positionBullets();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [startX description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param value  Start X\r\n\t */\r\n\tpublic set startX(value: number) {\r\n\t\tthis.setPropertyValue(\"startX\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Start X\r\n\t */\r\n\tpublic get startX(): number {\r\n\t\treturn this.getPropertyValue(\"startX\");\r\n\t}\r\n\r\n\t/**\r\n\t * [endX description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param value  End X\r\n\t */\r\n\tpublic set endX(value: number) {\r\n\t\tthis.setPropertyValue(\"endX\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return End X\r\n\t */\r\n\tpublic get endX(): number {\r\n\t\treturn this.getPropertyValue(\"endX\");\r\n\t}\r\n\r\n\t/**\r\n\t * [startY description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param value  Start Y\r\n\t */\r\n\tpublic set startY(value: number) {\r\n\t\tthis.setPropertyValue(\"startY\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Start Y\r\n\t */\r\n\tpublic get startY(): number {\r\n\t\treturn this.getPropertyValue(\"startY\");\r\n\t}\r\n\r\n\t/**\r\n\t * [endY description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param value End Y\r\n\t */\r\n\tpublic set endY(value: number) {\r\n\t\tthis.setPropertyValue(\"endY\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return End Y\r\n\t */\r\n\tpublic get endY(): number {\r\n\t\treturn this.getPropertyValue(\"endY\");\r\n\t}\r\n\r\n\t/**\r\n\t * [linkWidth description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param value [description]\r\n\t */\r\n\tpublic set linkWidth(value: number) {\r\n\t\tthis.setPropertyValue(\"linkWidth\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return [description]\r\n\t */\r\n\tpublic get linkWidth(): number {\r\n\t\treturn this.getPropertyValue(\"linkWidth\");\r\n\t}\r\n\r\n\t/**\r\n\t * Distance of control point of a link, defines relative distance from a node at which linke should bend\r\n\t * @default 0.2\r\n\t * @param value\r\n\t */\r\n\tpublic set controlPointDistance(value: number) {\r\n\t\tthis.setPropertyValue(\"controlPointDistance\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return relative control point distance\r\n\t */\r\n\tpublic get controlPointDistance(): number {\r\n\t\treturn this.getPropertyValue(\"controlPointDistance\");\r\n\t}\r\n\r\n\t/**\r\n\t * Tension of a spline, 1 would make the link to have sharp edges\r\n\t * @default 0.8\r\n\t * @param value\r\n\t */\r\n\tpublic set tension(value: number) {\r\n\t\tthis.setPropertyValue(\"tension\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return tension value\r\n\t */\r\n\tpublic get tension(): number {\r\n\t\treturn this.getPropertyValue(\"tension\");\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"SankeyLink\"] = SankeyLink;\r\n"]},"metadata":{},"sourceType":"module"}